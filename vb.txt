Imports System.Data.SQLite
Imports System.Net
Imports CrystalDecisions.CrystalReports.Engine
Public Class New_Invoice
    Private WithEvents ec As DataGridViewTextBoxEditingControl
    Dim dr3 As SQLiteDataReader
    Private flag_cell_edited As Boolean
    Private currentRow As Integer
    Private currentColumn As Integer
    Public test As Boolean = False
    Public nofound As Boolean
    Public save As Boolean
    Public col_name As Boolean
    Dim dt As New DataTable("temp")
    Dim bill_no As Integer
    Dim grid_product As String
    Dim amt As Boolean = False
    Public outer_disc_rate As Boolean = False
    Public outer_disc_val As Boolean = False
    Public edit As Boolean = False
    Public up As Boolean = False
    Public ok As Boolean = False
    Public ky As Boolean = False
    Public Ref As Boolean = False
    Public remove_row As Boolean = False
    Public sale_l As Boolean = False
    Public sale_l2 As Boolean = False
    Public sale_l3 As Boolean = False
    Public bill_number As String
    Dim tax As String
    Dim pd As Boolean = False
    Dim pd2 As Boolean = False
    Dim test_product As String
    Public nxt As Boolean = False
    Public deli_status As Boolean = False
    Dim al_stock As String
    Dim pay_status As String
    Dim user As String
    Dim to_dz As String
    Dim A5_print As String
    Dim EWB_print As String

    Dim th_print As String

    Dim original_duplicate As String
    Dim client_contact As String
    Dim link As String
    Dim sms_setting As String
    Dim client_GSTIN As String = ""
    Dim company_GSTIN As String = ""
    Dim lbl_GSTINs As String
    Dim add_less As Boolean = False


    Public Sub New_Invoice_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        salesman.Text = ""
        Me.StartPosition = FormStartPosition.CenterParent
        Me.Size = New Size(1020, 650)
        user = Home.UserToolStripMenuItem.Text
        Module1.conn()
        '..............................SMS..................................................
        Dim cmda As SQLiteCommand
        cmda = New SQLiteCommand("select Enabled from SMS_Setting", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter3 As New SQLiteDataAdapter(cmda)
        Dim table4 As New DataTable()
        adapter3.Fill(table4)
        sms_setting = table4.Rows(0)(0).ToString()
        'MsgBox(sms_setting)
        '..................Tax............................................
        Dim cmd01 As SQLiteCommand
        cmd01 = New SQLiteCommand("select * from tax_setting", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter2 As New SQLiteDataAdapter(cmd01)
        Dim table2 As New DataTable()
        adapter2.Fill(table2)
        tax = table2.Rows(0)(0).ToString()
        '................................................................................
        Dim cmd02 As New SQLiteCommand("select Allow from allow_stock", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter5 As New SQLiteDataAdapter(cmd02)
        Dim table5 As New DataTable()
        adapter5.Fill(table5)
        al_stock = table5.Rows(0)(0).ToString()
        '........................................
        '................................................................................
        Dim cmd03 As New SQLiteCommand("select A5 from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter6 As New SQLiteDataAdapter(cmd03)
        Dim table6 As New DataTable()
        adapter6.Fill(table6)
        A5_print = table6.Rows(0)(0).ToString()
        '........................................
        Dim cmd03ew As New SQLiteCommand("select EWB_format from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter6ew As New SQLiteDataAdapter(cmd03ew)
        Dim table6ew As New DataTable()
        adapter6ew.Fill(table6ew)
        EWB_print = table6ew.Rows(0)(0).ToString()
        '........................................
        Dim cmd03w As New SQLiteCommand("select Thermal from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter6w As New SQLiteDataAdapter(cmd03w)
        Dim table6w As New DataTable()
        adapter6w.Fill(table6w)
        th_print = table6w.Rows(0)(0).ToString()
        '................................................................................
        Dim cmd04 As New SQLiteCommand("select original_n_duplicate from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter7 As New SQLiteDataAdapter(cmd04)
        Dim table7 As New DataTable()
        adapter7.Fill(table7)
        original_duplicate = table7.Rows(0)(0).ToString()
        'MsgBox(original_duplicate)
        '........................................
        'DataGridView1.in
        'DataGridView1.Width = 990
        'DataGridView1.Height = 255

        dt.Clear()
        Dim dar As New SQLiteDataAdapter
        dar = New SQLiteDataAdapter("select * from inner_sale where Bill_No ='" & TextBox2.Text & "' ", cn)
        dar.Fill(dt)
        DataGridView1.DataSource = dt
        DataGridView1.Columns("salesman").Visible = False
        DataGridView1.Columns("salesman_com").Visible = False
        DataGridView1.Columns("salesman_comp").Visible = False
        DataGridView1.Columns("Bal_Stock").Visible = False
        DataGridView1.Columns("FreeQTY").Visible = False
        DataGridView1.Columns("CESS").Visible = False
        DataGridView1.Columns("CESSVal").Visible = False
        dar.Dispose()


        Dim screenw As Integer = Screen.PrimaryScreen.Bounds.Width
        Dim screenh As Integer = Screen.PrimaryScreen.Bounds.Height
        If screenw = 1120 And screenh = 840 Or screenw = 1280 And screenh = 960 Or screenw = 1280 And screenh = 800 Or screenw = 1280 And screenh = 768 Or screenw = 1152 And screenh = 864 Or screenw = 1024 And screenh = 768 Then
            'MsgBox("true")
            Me.Width = 1020
        End If
        If screenw = 1280 And screenh = 720 Then
            Me.Width = 1020
            Me.Height = 614
        End If
        If screenw = 1024 And screenh = 819 Then
            Me.Width = 1020
        End If
        If screenw = 1280 And screenh = 600 Then
            Me.Width = 1020
            Me.AutoScroll = True
            Me.Location = New System.Drawing.Point(0, 0)
            Me.Height = 550
        End If
        If screenw = 800 And screenh = 600 Then
            'MsgBox("true")
            Me.Width = 1020
            Me.AutoScroll = True
            Me.Location = New System.Drawing.Point(0, 0)
            Me.Height = 550
        End If
        btn_add_less.Text = "Less"
        due_date.CustomFormat = "dd/MM/yyyy"
        bill_date.CustomFormat = "dd/MM/yyyy"
        Box16.CustomFormat = "dd/MM/yyyy"
        eway_date.CustomFormat = "dd/MM/yyyy"
        Box2.CustomFormat = "dd/MM/yyyy"
        Box4.CustomFormat = "dd/MM/yyyy"
        Box6.CustomFormat = "dd/MM/yyyy"
        Box8.CustomFormat = "dd/MM/yyyy"
        todays_date.CustomFormat = "dd/MM/yyyy"
        todays_date.Value = DateTime.Now
        Dim nz As String = Replace(todays_date.Text, "-", "")
        Dim mz As String = nz.Remove(0, 2)
        Dim ysz As String = mz.Remove(0, 2)
        Dim msz As String = mz.Substring(0, 2)
        Dim dz As String = nz.Substring(0, 2)
        to_dz = ysz + msz + dz
        todays_date.Visible = False
        btn_edit.Enabled = False
        btn_delete.Enabled = False
        btn_save.Enabled = False
        ' Button1.Enabled = False
        DataGridView1.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft
        DataGridView1.Columns(2).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft
        DataGridView1.Columns(7).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
        ProductID.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleLeft
        ProductName.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleLeft
        ProductName.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        ProductID.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        ProductID.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        HSN.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        HSN.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        DataGridView1.RowHeadersDefaultCellStyle.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        DataGridView1.RowHeadersDefaultCellStyle.ForeColor = System.Drawing.ColorTranslator.FromHtml("#ffffff")
        DataGridView1.ColumnHeadersDefaultCellStyle.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        ' DataGridView1.ColumnHeadersDefaultCellStyle.ForeColor = System.Drawing.ColorTranslator.FromHtml("#ffffff")
        DataGridView1.ColumnHeadersDefaultCellStyle.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        DataGridView1.EnableHeadersVisualStyles = False
        Bal_Stock.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        HSN.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Bal_Stock.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        QTY.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        QTY.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        'meters.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        'meters.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        FreeQTY.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        FreeQTY.HeaderCell.Style.Font = New Font("Segoe UI", 7, FontStyle.Regular)
        Unit.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Unit.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        MRP.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        MRP.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        Amount.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Amount.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        Rate.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Rate.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        DiscValue.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        DiscValue.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        'DiscValueDataGridViewTextBoxColumn.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        discount.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        discount.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        'ProductCodeDataGridViewTextBoxColumn.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        'ProductCodeDataGridViewTextBoxColumn.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        SGST.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        SGST.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        SGSTVal.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        SGSTVal.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        CGST.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        CGSTVal.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        CGSTVal.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        CGST.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        CESS.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        CESS.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        CESSVal.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        CESSVal.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        IGST.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        IGST.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        IGSTVal.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        IGSTVal.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        TotAmount.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        TotAmount.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        Rate.HeaderCell.Style.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Rate.HeaderCell.Style.Font = New Font("Segoe UI", 8.5, FontStyle.Regular)
        owntext.Enabled = True
        owntext.Visible = True
        Me.KeyPreview = False
        '....................................................................................................
        Module1.conn()
        '.........................................................................
        client_name.Items.Clear()
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim cmd As New SQLiteCommand("select name from client where Type='Recipient' ", cn)
        Dim da As New SQLiteDataAdapter(cmd)
        Dim ds As New DataSet
        da.Fill(ds, "List")
        Dim col As New AutoCompleteStringCollection ' From which our names will come
        Dim t As Integer
        For t = 0 To ds.Tables(0).Rows.Count - 1
            col.Add(ds.Tables(0).Rows(t)(0).ToString())
        Next
        'this is the main part 
        client_name.AutoCompleteSource = AutoCompleteSource.CustomSource
        client_name.AutoCompleteCustomSource = col
        client_name.AutoCompleteMode = AutoCompleteMode.SuggestAppend
        '........................................................................................
        Dim cmdzz As New SQLiteCommand("select Name from transporter", cn)
        Dim dazz As New SQLiteDataAdapter(cmdzz)
        Dim dszz As New DataSet
        dazz.Fill(dszz, "List")
        Dim colzz As New AutoCompleteStringCollection ' From which our names will come
        Dim tzz As Integer
        For tzz = 0 To dszz.Tables(0).Rows.Count - 1
            colzz.Add(dszz.Tables(0).Rows(tzz)(0).ToString())
        Next
        'this is the main part 
        Box10.AutoCompleteSource = AutoCompleteSource.CustomSource
        Box10.AutoCompleteCustomSource = colzz
        Box10.AutoCompleteMode = AutoCompleteMode.SuggestAppend
        '........................................................................................
        Box10.Items.Clear()
        Try
            Dim dr As SQLiteDataReader
            cmd = New SQLiteCommand("select Name from transporter", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr = cmd.ExecuteReader()
            If dr.HasRows = True Then
                While dr.Read()
                    Box10.Items.Add(dr(0).ToString())
                End While
                dr.Close()
            End If
            dr.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        Box10.Sorted = True
        '........................................................................................
        Dim cmdzzq As New SQLiteCommand("select name from city", cn)
        Dim dazzq As New SQLiteDataAdapter(cmdzzq)
        Dim dszzq As New DataSet
        dazzq.Fill(dszzq, "List")
        Dim colzzq As New AutoCompleteStringCollection ' From which our names will come
        Dim tzzq As Integer
        For tzzq = 0 To dszzq.Tables(0).Rows.Count - 1
            colzzq.Add(dszzq.Tables(0).Rows(tzzq)(0).ToString())
        Next
        'this is the main part 
        Box9.AutoCompleteSource = AutoCompleteSource.CustomSource
        Box9.AutoCompleteCustomSource = colzzq
        Box9.AutoCompleteMode = AutoCompleteMode.SuggestAppend
        '........................................................................................
        Box9.Items.Clear()
        Try
            Dim dr As SQLiteDataReader
            cmd = New SQLiteCommand("select name from city", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr = cmd.ExecuteReader()
            If dr.HasRows = True Then
                While dr.Read()
                    Box9.Items.Add(dr(0).ToString())
                End While
                dr.Close()
            End If
            dr.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        Box9.Sorted = True
        '........................................................................................
        btn_print.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_add_less.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_save_print.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Button2.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        Button3.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_save.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_delete.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_edit.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        btn_search.BackColor = System.Drawing.ColorTranslator.FromHtml("#187094")
        txt_qty.Enabled = False
        txt_free_qty.Enabled = False
        txt_gross.Enabled = False
        TextBox14.Enabled = False
        TextBox15.Enabled = False
        TextBox16.Enabled = False
        TextBox19.Enabled = False
        TextBox20.Enabled = False
        '----------------------------------------------------------------------------------------------------
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        '------------------------------------------------------------------------------------------
        Dim matches2() As Control
        For i As Integer = 1 To 18
            matches2 = Me.Controls.Find("Box" & i, True)
            If matches2.Length > 0 AndAlso TypeOf matches2(0) Is TextBox Then
                Dim cb As TextBox = DirectCast(matches2(0), TextBox)
                Dim dr As SQLiteDataReader
                Try
                    cmd = New SQLiteCommand("select * from outer_controls WHERE sr_no='" & i & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr = cmd.ExecuteReader()
                    If dr.HasRows = True Then
                        While dr.Read()
                            cb.Visible = dr(3)
                            If i = 14 Then
                                btn_add_less.Visible = dr(3)
                            End If
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                    cmd.Dispose()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
            End If
        Next
        '------------------------------------------------------------------------------------------------
        Dim matches23() As Control
        For i As Integer = 1 To 18
            matches23 = Me.Controls.Find("Box" & i, True)
            If matches23.Length > 0 AndAlso TypeOf matches23(0) Is ComboBox Then
                Dim cb As ComboBox = DirectCast(matches23(0), ComboBox)
                Dim dr As SQLiteDataReader
                Try
                    cmd = New SQLiteCommand("select * from outer_controls WHERE sr_no='" & i & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr = cmd.ExecuteReader()
                    If dr.HasRows = True Then
                        While dr.Read()
                            cb.Visible = dr(3)
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                    cmd.Dispose()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
            End If
        Next
        '-------------------------------------------------------------------------------------------------
        Dim matches02() As Control
        For i As Integer = 1 To 4
            matches02 = Me.Controls.Find("PictureBox" & i, True)
            If matches02.Length > 0 AndAlso TypeOf matches02(0) Is PictureBox Then
                Dim cb As PictureBox = DirectCast(matches02(0), PictureBox)
                Dim dr As SQLiteDataReader
                Try
                    cmd = New SQLiteCommand("select * from outer_controls WHERE sr_no='" & i & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr = cmd.ExecuteReader()
                    If dr.HasRows = True Then
                        While dr.Read()
                            cb.Visible = dr(3)
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                    cmd.Dispose()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
            End If
        Next
        '-------------------------------------------------------------------------------------------------
        '................................................................................................
        Dim matches3() As Control
        For i As Integer = 1 To 18
            matches3 = Me.Controls.Find("Box" & i, True)
            If matches3.Length > 0 AndAlso TypeOf matches3(0) Is DateTimePicker Then
                Dim cb As DateTimePicker = DirectCast(matches3(0), DateTimePicker)
                Dim dr As SQLiteDataReader
                Try
                    cmd = New SQLiteCommand("select * from outer_controls WHERE sr_no='" & i & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr = cmd.ExecuteReader()
                    If dr.HasRows = True Then
                        While dr.Read()
                            'MsgBox(dr(3))
                            cb.Visible = dr(3)
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                    cmd.Dispose()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
            End If
        Next
        '......................................................................................................................
        Dim matches() As Control
        For i As Integer = 1 To 18
            matches = Me.Controls.Find("labl" & i, True)
            If matches.Length > 0 AndAlso TypeOf matches(0) Is Label Then
                Dim cb As Label = DirectCast(matches(0), Label)
                Dim dr As SQLiteDataReader
                Try
                    cmd = New SQLiteCommand("select * from outer_controls WHERE sr_no='" & i & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr = cmd.ExecuteReader()
                    If dr.HasRows = True Then
                        While dr.Read()
                            'MsgBox(dr(3))
                            cb.Visible = dr(3)
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                    cmd.Dispose()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
            End If
        Next
        '...................................................................................................................................................
        Try
            Dim dr As SQLiteDataReader
            cmd = New SQLiteCommand("select name from client where Type='Recipient' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr = cmd.ExecuteReader()
            If dr.HasRows = True Then
                While dr.Read()
                    client_name.Items.Add(dr(0).ToString())
                End While
                dr.Close()
            End If
            dr.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        client_name.Sorted = True
        '.................................................................................................................................
        '--------------------------------------------------------------------------------

        Dim dr1z As SQLiteDataReader
        Try
            cmd = New SQLiteCommand("select value from outer_controls WHERE sr_no='" & 17 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr1z = cmd.ExecuteReader()
            If dr1z.HasRows = True Then
                While dr1z.Read()
                    'MsgBox(dr(3))
                    grpbox_eway.Visible = dr1z(0)
                End While
                dr1z.Close()
            End If
            dr1z.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '--------------------------------------------------------------------------------
        Dim dr1 As SQLiteDataReader
        Try
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 1 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr1 = cmd.ExecuteReader()
            If dr1.HasRows = True Then
                While dr1.Read()
                    'MsgBox(dr(3))
                    ProductID.Visible = dr1(0)
                End While
                dr1.Close()
            End If
            dr1.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Dim hsn1 As SQLiteDataReader
        Try
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 2 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            hsn1 = cmd.ExecuteReader()
            If hsn1.HasRows = True Then
                While hsn1.Read()
                    'MsgBox(dr(3))
                    HSN.Visible = hsn1(0)
                End While
                hsn1.Close()
            End If
            hsn1.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Dim dr2 As SQLiteDataReader
        Try
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 3 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr2 = cmd.ExecuteReader()
            If dr2.HasRows = True Then
                While dr2.Read()
                    'MsgBox(dr(3))
                    Bal_Stock.Visible = dr2(0)
                End While
                dr2.Close()
            End If
            dr2.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 4 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    FreeQTY.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 5 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    MRP.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 6 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    Unit.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 7 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    Amount.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 8 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    discount.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 9 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    DiscValue.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 10 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    SGST.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 11 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    SGSTVal.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 12 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    CGST.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 13 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    CGSTVal.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 14 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    CESS.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 15 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    CESSVal.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 16 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    IGST.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        Try
            Dim dr3 As SQLiteDataReader
            cmd = New SQLiteCommand("select value from Inner_controls WHERE sr_no='" & 17 & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                While dr3.Read()
                    'MsgBox(dr(3))
                    IGSTVal.Visible = dr3(0)
                End While
                dr3.Close()
            End If
            dr3.Close()
            cmd.Dispose()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        '-------------------------------------------------------------------------------------------------
        If sale_l = False Or sale_l2 = False Then
            Try
                Dim dr3 As SQLiteDataReader
                cmd = New SQLiteCommand("select max(Bill_No) from Outer_sale ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                dr3 = cmd.ExecuteReader()
                If dr3.HasRows = True Then
                    While dr3.Read()
                        'MsgBox(dr(3))
                        If IsDBNull(dr3(0)) Then
                            TextBox2.Text = 1
                            bill_no = 1
                        Else
                            TextBox2.Text = dr3(0) + 1
                            bill_no = dr3(0) + 1
                        End If
                    End While
                    dr3.Close()
                Else
                    TextBox2.Text = 1
                    dr3.Close()
                End If
                dr3.Close()
                cmd.Dispose()
            Catch ex As Exception
                MsgBox(ex.Message)
            Finally
                If cn.State = ConnectionState.Open Then
                    cn.Close()
                End If
            End Try
        End If
        '-------------------------------------------------------------------------------------------------
        If sale_l Or sale_l2 Or sale_l3 Then
            TextBox2.Text = bill_number
            TextBox2_Leave(e, e)
        End If
        Amount.ReadOnly = True
        Bal_Stock.ReadOnly = True
        TotAmount.ReadOnly = True
    End Sub
    Private Sub client_name_Leave(sender As Object, e As EventArgs) Handles client_name.Leave
        Try
            Dim balance As Double
            Dim cmdzs As New SQLiteCommand(" Select  max(sr_no) ,Balance from party_ledger  where  party_name ='" & client_name.Text & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapterzs As New SQLiteDataAdapter(cmdzs)
            Dim tablezs As New DataTable()
            adapterzs.Fill(tablezs)
            balance = tablezs.Rows(0)(1).ToString()
            ' MsgBox(balance)
            If balance >= 1 Then
                '...........................................
                Dim due_doc_date, days As Integer
                Dim cmdz As New SQLiteCommand("select max(due_doc_date)  from outer_sale where Client_Name='" & client_name.Text & "' and Payment_Mode='Credit' ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adapterz As New SQLiteDataAdapter(cmdz)
                Dim tablez As New DataTable()
                adapterz.Fill(tablez)
                Dim someStr As String = "Outstanding with " & client_name.Text & ". Do you want to continue?"
                due_doc_date = tablez.Rows(0)(0).ToString()
                'days = to_dz - due_doc_date
                'txt_remark.Text = to_dz & "" & due_doc_date
                If to_dz > due_doc_date Then
                    Dim yn As Integer
                    yn = MsgBox(someStr, MsgBoxStyle.YesNo)
                    If yn = 6 Then
                        TextBox2.Enabled = True
                        SendKeys.Send("+{tab}")
                        TextBox2.Enabled = True
                    Else
                        TextBox2.Enabled = True
                        client_name.Text = ""
                        owntext.Focus()
                        SendKeys.Send("+{tab}")
                        SendKeys.Send("+{tab}")
                        SendKeys.Send("+{tab}")
                        TextBox2.Enabled = True
                    End If
                End If
            End If
        Catch ex As System.InvalidCastException
        End Try
        If client_name.Text = "" Then
            TextBox2.Focus()
        Else
            Dim dr3 As SQLiteDataReader
            Try
                cmd = New SQLiteCommand("select * from client where name='" & client_name.Text & "'  ", cn)
                cn.Close()
                cn.Open()
                dr3 = cmd.ExecuteReader()
                If dr3.HasRows = False Then
                    'client_name.Focus()
                    client_master.c1.Text = client_name.Text
                    dr3.Close()
                    Home.Panel1.Visible = False
                    client_master.MdiParent = Me.MdiParent
                    If client_master.WindowState = FormWindowState.Minimized Then
                        client_master.WindowState = FormWindowState.Normal
                    End If
                    client_master.Show()
                    client_master.BringToFront()
                End If
                dr3.Close()
            Catch ex As Exception
                MsgBox(ex.Message)
            End Try
            cn.Close()
            Exit Sub
        End If
    End Sub
    Private Sub ctrl_KeyUp(sender As Object, e As KeyEventArgs) Handles TextBox2.KeyUp, owntext.KeyUp, due_days.KeyUp,
        due_date.KeyUp, Box8.KeyUp, Box7.KeyUp,
        Box6.KeyUp, Box5.KeyUp, Box4.KeyUp, Box3.KeyUp, Box2.KeyUp,
        Box1.KeyUp, bill_date.KeyUp, client_name.KeyUp, TextBox18.KeyUp, TextBox17.KeyUp, credit.KeyUp, cash.KeyUp, Box14.KeyUp, Box13.KeyUp, Box12.KeyUp, Box11.KeyUp, txt_remark.KeyUp, btn_delete.KeyUp, btn_search.KeyUp, btn_edit.KeyUp, btn_save.KeyUp, Button3.KeyUp, Button2.KeyUp, btn_save_print.KeyUp, btn_print.KeyUp
        If nxt Then
            nxt = False
        Else
            If e.KeyCode = Keys.Enter Then
                SendKeys.Send("{tab}")
                ' Me.SelectNextControl(sender, True, True, True, True)
            End If
        End If
        If e.KeyCode = Keys.Escape Then
            Me.Close()
        End If
        If e.KeyCode = Keys.E AndAlso e.Modifiers = Keys.Control Then
            If btn_edit.Enabled = True Then
                Button5_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.R AndAlso e.Modifiers = Keys.Control Then
            If btn_search.Enabled = True Then
                Button7_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.D AndAlso e.Modifiers = Keys.Control Then
            If btn_delete.Enabled = True Then
                Button8_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.V AndAlso e.Modifiers = Keys.Alt Then
            If btn_save.Enabled = True Then
                Button4_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.S AndAlso e.Modifiers = Keys.Control Then
            If btn_save_print.Enabled = True Then
                Button1_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.P AndAlso e.Modifiers = Keys.Control Then
            If btn_print.Enabled = True Then
                btn_print_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.N AndAlso e.Modifiers = Keys.Control Then
            If Button3.Enabled = True Then
                Button3_Click(e, e)
            End If
        End If
    End Sub
    Private Sub client_name_SelectedIndexChanged(sender As Object, e As EventArgs) Handles client_name.SelectedIndexChanged
        PopulateSalesman()
        Try
            cmd = New SQLiteCommand("select * from client where name='" & client_name.Text & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter As New SQLiteDataAdapter(cmd)
            Dim table As New DataTable()
            adapter.Fill(table)
            lbl_name.Text = table.Rows(0)(1).ToString()
            lbl_address.Text = table.Rows(0)(2).ToString() + " " + table.Rows(0)(4).ToString()
            'Label15.Text = table.Rows(0)(6).ToString() + "," + table.Rows(0)(7).ToString()
            lbl_contact.Text = table.Rows(0)(8).ToString() + " , " + table.Rows(0)(9).ToString()
            'Label16.Text = table.Rows(0)(13).ToString()
            client_contact = table.Rows(0)(8).ToString()
            lbl_GSTIN.Text = table.Rows(0)(13).ToString()
            lbl_GSTINs = table.Rows(0)(7).ToString()
            'c3.Text = table.Rows(0)(3).ToString()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
        Try
            cmd = New SQLiteCommand("select max(sr_no),Balance from party_ledger where party_name='" & client_name.Text & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter As New SQLiteDataAdapter(cmd)
            Dim table As New DataTable()
            adapter.Fill(table)
            If Not IsDBNull(table.Rows(0)(1).ToString()) Then
                bal.Text = "(BAL: " & table.Rows(0)(1).ToString() & " )"
            End If
            If table.Rows(0)(1).ToString() = "" Then
                bal.Text = "(BAL: " & "000" & " )"
            End If
        Catch ex As InvalidCastException
            bal.Text = "(BAL: " & "000" & " )"
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
    End Sub
    Private Sub DataGridView1_CellPainting(sender As Object, e As DataGridViewCellPaintingEventArgs) Handles DataGridView1.CellPainting
        If e.ColumnIndex = -1 AndAlso e.RowIndex > -1 AndAlso e.RowIndex < DataGridView1.Rows.Count - 1 Then
            Dim indexString As String = (e.RowIndex + 1).ToString
            Dim sz As SizeF = e.Graphics.MeasureString(indexString, DataGridView1.Font)
            Dim pt As New PointF(e.CellBounds.Width - sz.Width, e.CellBounds.Y + (e.CellBounds.Height / 2 - sz.Height / 2))
            e.Paint(e.ClipBounds, DataGridViewPaintParts.All)
            e.Graphics.DrawString(indexString, DataGridView1.Font, Brushes.White, pt)
            e.Handled = True
        End If
    End Sub
    Private Sub client_name_KeyPress(sender As Object, e As KeyPressEventArgs) Handles client_name.KeyPress
        client_name.DroppedDown = False
    End Sub
    Private Sub txtEdit_Keypress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyPressEventArgs)
        Dim index As Integer = DataGridView1.CurrentCell.ColumnIndex
        If index = 6 Or index = 9 Or index = 10 Or index = 12 Or index = 13 Or index = 14 Or index = 15 Or index = 16 Or index = 17 Or index = 18 Or index = 19 Or index = 20 Or index = 21 Then  'คอลัมที่ต้องการเช็ค
            If IsNumeric(e.KeyChar.ToString()) _
            Or e.KeyChar = ChrW(Keys.Back) _
            Or e.KeyChar = "." _
            Or e.KeyChar = "-" Then
                'MessageBox.Show("KeyPress number")
                e.Handled = False 'if numeric display
            Else
                'MessageBox.Show("enter numbers only")
                e.Handled = True  'if non numeric don't display
            End If
        End If
        If index = 5 Or index = 11 Or index = 22 Then
            e.Handled = True
        End If
    End Sub
    Private Sub DataGridView1_EditingControlShowing(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewEditingControlShowingEventArgs) Handles DataGridView1.EditingControlShowing
        Try
            Dim i As Integer
            i = DataGridView1.CurrentRow.Index
            'MsgBox(DataGridView1.Item("ProductName", i).Value)
            If ec Is Nothing Then
                ec = CType(e.Control, DataGridViewTextBoxEditingControl)
            End If
        Catch ex As Exception

        End Try

        Try
            Dim txtEdit As TextBox = CType(e.Control, TextBox)
            'remove any existing handler
            RemoveHandler txtEdit.KeyPress, AddressOf txtEdit_Keypress
            AddHandler txtEdit.KeyPress, AddressOf txtEdit_Keypress
        Catch ex As Exception
        End Try
        Try
            'MsgBox(e.Control.ToString)
            Dim header1 As String = DataGridView1.Columns(3).HeaderText
            If header1.Equals("Product Name") Then
                If DataGridView1.CurrentCell.ColumnIndex = 3 Then
                    Dim text As TextBox = TryCast(e.Control, TextBox)
                    If text IsNot Nothing Then
                        text.AutoCompleteMode = AutoCompleteMode.SuggestAppend
                        text.AutoCompleteSource = AutoCompleteSource.CustomSource
                        Dim data As AutoCompleteStringCollection = New AutoCompleteStringCollection()
                        add(data, DataGridView1.CurrentCellAddress.ToString)
                        text.AutoCompleteCustomSource = data
                    End If
                ElseIf TypeOf e.Control Is TextBox Then
                    Dim text As TextBox = TryCast(e.Control, TextBox)
                    text.AutoCompleteCustomSource = Nothing
                    text.AutoCompleteSource = AutoCompleteSource.None
                    text.AutoCompleteMode = AutoCompleteMode.None
                End If
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
        'Try
        '    MsgBox(DataGridView1.CurrentCell.ColumnIndex)
        '    Dim header2 As String = DataGridView1.Columns(8).HeaderText
        '    If header2.Equals("Unit") Then
        '        'Unit.Items.Add("asasss")
        '        Unit.Items.Clear()
        '        Dim dr As SQLiteDataReader
        '        cmd = New SQLiteCommand("select Unit_Name from Unit", cn)
        '        If cn.State = ConnectionState.Closed Then
        '            cn.Open()
        '        End If
        '        dr = cmd.ExecuteReader()
        '        If dr.HasRows = True Then
        '            While dr.Read()
        '                Unit.Items.Add(dr(0).ToString())
        '            End While
        '            dr.Close()
        '        End If
        '        dr.Close()
        '        cmd.Dispose()
        '        Unit.Sorted = True
        '    End If
        'Catch ex As Exception
        '    MsgBox(ex.Message)
        'End Try
    End Sub
    Public Sub add(ByVal data As AutoCompleteStringCollection, ByVal c As String)
        Dim dr As SQLiteDataReader
        Try
            cmd = New SQLiteCommand("select product_name from product_details where product_name Like '%" & grid_product & "%'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            dr = cmd.ExecuteReader()
            If dr.HasRows = True Then
                While dr.Read()
                    data.Add(dr(0).ToString())
                End While
                dr.Close()
            End If
            dr.Close()
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            If cn.State = ConnectionState.Open Then
                cn.Close()
            End If
        End Try
    End Sub
    Private Sub datagridview1_keydown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles DataGridView1.KeyDown
        If e.KeyCode = Keys.E AndAlso e.Modifiers = Keys.Control Then
            If btn_edit.Enabled = True Then
                Button5_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.R AndAlso e.Modifiers = Keys.Control Then
            If btn_search.Enabled = True Then
                Button7_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.D AndAlso e.Modifiers = Keys.Control Then
            If btn_delete.Enabled = True Then
                Button8_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.V AndAlso e.Modifiers = Keys.Alt Then
            If btn_save.Enabled = True Then
                Button4_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.S AndAlso e.Modifiers = Keys.Control Then
            If btn_save_print.Enabled = True Then
                Button1_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.P AndAlso e.Modifiers = Keys.Control Then
            If btn_print.Enabled = True Then
                btn_print_Click(e, e)
            End If
        End If
        If e.KeyCode = Keys.N AndAlso e.Modifiers = Keys.Control Then
            If Button3.Enabled = True Then
                Button3_Click(e, e)
            End If
        End If
        If ky Then
            If e.KeyCode = Keys.Enter Then
                ky = False
                Dim i As Integer
                i = DataGridView1.CurrentRow.Index
                DataGridView1.ClearSelection()
                DataGridView1.CurrentCell = DataGridView1.Item("ProductID", i)
                Me.SelectNextControl(DataGridView1, True, True, True, True)
                nxt = True
                Exit Sub
            End If
            ky = False
        End If
        'nxt:
        '        Ref = False
        If e.KeyCode = Keys.Up Then
            'MsgBox("1")
            up = True
            Exit Sub
        End If
        If ok Then
            ok = False
            Exit Sub
        End If
        If e.KeyCode = Keys.Enter Then
            If test = True Then
                SendKeys.Send("{enter}")
                test = False
            Else
                Dim c As DataGridViewCell = DataGridView1.CurrentCell
                If c.ColumnIndex = DataGridView1.ColumnCount - 1 And c.RowIndex < DataGridView1.RowCount - 1 Then
                    Try
                        DataGridView1.CurrentCell = DataGridView1.Rows(c.RowIndex + 1).Cells(0)
                    Catch ex As Exception
                        SendKeys.Send("{tab}")
                        'msgbox("first")
                        'me.selectnextcontrol(sender, true, true, true, true)
                    End Try
                ElseIf c.ColumnIndex < DataGridView1.ColumnCount - 1 Then
                    Try
                        DataGridView1.CurrentCell = DataGridView1.Rows(c.RowIndex).Cells(c.ColumnIndex + 1)
                    Catch ex As Exception
                        SendKeys.Send("{tab}")
                    End Try
                Else
                End If
                e.Handled = True
            End If
        End If
    End Sub
    'this will move To the Next cell If currently editing the cell And you press enter
    Private Sub ec_PreviewKeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.PreviewKeyDownEventArgs) Handles ec.PreviewKeyDown
        If ok Then
            ok = False
            Exit Sub
        End If
        If e.KeyCode = Keys.Up Then
            up = True
        End If
        If e.KeyCode = Keys.Enter Then
            If test = True Then
                SendKeys.Send("{enter}")
                test = False
            Else
                DataGridView1.EndEdit()
                Dim c As DataGridViewCell = DataGridView1.CurrentCell
                Try
                    If c.ColumnIndex = DataGridView1.ColumnCount - 1 And c.RowIndex < DataGridView1.RowCount - 1 Then
                        Try
                            DataGridView1.CurrentCell = DataGridView1.Rows(c.RowIndex + 1).Cells(0)
                        Catch ex As Exception
                            SendKeys.Send("{tab}")
                            'MsgBox("second")
                            'Me.SelectNextControl(sender, True, True, True, True)
                        End Try
                        'DataGridView1.CurrentCell = DataGridView1.Rows(c.RowIndex + 1).Cells(0)
                    ElseIf c.ColumnIndex < DataGridView1.ColumnCount - 1 Then
                        Try
                            DataGridView1.CurrentCell = DataGridView1.Rows(c.RowIndex).Cells(c.ColumnIndex + 1)
                        Catch ex As Exception
                            SendKeys.Send("{enter}")
                            'MsgBox("second")
                            'Me.SelectNextControl(sender, True, True, True, True)
                        End Try
                    End If
                Catch ex As Exception
                End Try
            End If
        End If
    End Sub
    Public Sub enable_cntrl()
        DataGridView1.ReadOnly = False
        '  DataGridView1.Enabled = True
        Dim matches2() As Control
        For i As Integer = 1 To 18
            matches2 = Me.Controls.Find("Box" & i, True)
            If matches2.Length > 0 AndAlso TypeOf matches2(0) Is TextBox Then
                Dim cb As TextBox = DirectCast(matches2(0), TextBox)
                cb.Enabled = True
            End If
        Next
        Dim matches3() As Control
        For i As Integer = 1 To 18
            matches3 = Me.Controls.Find("Box" & i, True)
            If matches3.Length > 0 AndAlso TypeOf matches3(0) Is DateTimePicker Then
                Dim cb As DateTimePicker = DirectCast(matches3(0), DateTimePicker)
                cb.Enabled = True
            End If
        Next
        client_name.Enabled = True
        salesman.Enabled = True
        comp.Enabled = True
        txt_com.Enabled = True
        profitp.Enabled = True
        profitamt.Enabled = True
        cash.Enabled = True
        credit.Enabled = True
        TextBox17.Enabled = True
        TextBox18.Enabled = True
        bill_date.Enabled = True
        due_date.Enabled = True
        due_days.Enabled = True
        btn_edit.Enabled = False
        btn_print.Enabled = False
        btn_search.Enabled = False
        btn_delete.Enabled = False
        btn_save.Enabled = True
        btn_save_print.Enabled = True
        owntext.Focus()
    End Sub
    Public Sub desable_cntrl()
        DataGridView1.ReadOnly = True
        DataGridView1.Enabled = False
        Dim matches2() As Control
        For i As Integer = 1 To 18
            matches2 = Me.Controls.Find("Box" & i, True)
            If matches2.Length > 0 AndAlso TypeOf matches2(0) Is TextBox Then
                Dim cb As TextBox = DirectCast(matches2(0), TextBox)
                cb.Enabled = False
            End If
        Next
        Dim matches3() As Control
        For i As Integer = 1 To 18
            matches3 = Me.Controls.Find("Box" & i, True)
            If matches3.Length > 0 AndAlso TypeOf matches3(0) Is DateTimePicker Then
                Dim cb As DateTimePicker = DirectCast(matches3(0), DateTimePicker)
                cb.Enabled = False
            End If
        Next
        client_name.Enabled = False
        salesman.Enabled = False
        comp.Enabled = False
        txt_com.Enabled = False
        profitp.Enabled = False
        profitamt.Enabled = False
        cash.Enabled = False
        credit.Enabled = False
        TextBox17.Enabled = False
        TextBox18.Enabled = False
        bill_date.Enabled = False
        due_date.Enabled = False
        due_days.Enabled = False
        btn_save_print.Enabled = False
        btn_edit.Enabled = True
        btn_print.Enabled = True
        btn_search.Enabled = True
        btn_delete.Enabled = True
        btn_save.Enabled = False
        txt_remark.Enabled = False
        'Button1.Enabled = False
    End Sub
    Private Sub remv(tot_qty As Integer)
        Dim i As Integer
        Dim source1 As String = "SALE"
        Dim pre_qty As String
        Dim pre_bal_qty As String
        Dim a As Integer
        For a = 0 To ComboBox4.Items.Count.ToString - 1
            'MsgBox("in remv")
            Dim cm1 As SQLiteCommand
            cm1 = New SQLiteCommand("select max(Sr_no),out_qty from stock_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and products='" & ComboBox4.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter1 As New SQLiteDataAdapter(cm1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)
            'MsgBox(table1.Rows(0)(1).ToString())
            pre_qty = table1.Rows(0)(1).ToString()
            'MsgBox(table1.Rows(0)(0).ToString())
            Dim sr_no As String = table1.Rows(0)(0).ToString()
            adapter1.Dispose()
            'MsgBox("get pre qty")
            '...............................................................................................
            ' pre_bal_qty'...
            Dim cm2 As SQLiteCommand
            cm2 = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where Sr_no<'" & sr_no & "'  AND  products='" & ComboBox4.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter2 As New SQLiteDataAdapter(cm2)
            Dim table2 As New DataTable()
            adapter2.Fill(table2)
            'MsgBox(table2.Rows(0)(1).ToString())
            pre_bal_qty = table2.Rows(0)(1).ToString()
            'MsgBox(pre_bal_qty)
            'MsgBox("get bal qty")
            If pre_bal_qty = "" Then
                pre_bal_qty = 0
            End If
            Dim abs As String = "/"
            Dim ns As String = Replace(bill_date.Text, abs, "")
            Dim my As String = ns.Remove(0, 2)
            Dim y As String = my.Remove(0, 2)
            Dim mn As String = my.Substring(0, 2)
            Dim day As String = ns.Substring(0, 2)
            Dim all As String = y + mn + day
            'MsgBox(all)
            Dim cm3 As SQLiteCommand
            cm3 = New SQLiteCommand("select count(*) from stock_ledger where date>='" & all & "' and Sr_no>'" & sr_no & "'  and products='" & ComboBox4.Items(a).ToString() & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter3 As New SQLiteDataAdapter(cm3)
            Dim table3 As New DataTable()
            adapter3.Fill(table3)
            Dim cnt As String
            If table3.Rows(0)(0).ToString() <> 0 Then
                cnt = table3.Rows(0)(0).ToString()
                Try
                    Dim cm4 As SQLiteCommand
                    cm4 = New SQLiteCommand("select date,sr_no from stock_ledger where date>='" & all & "'  and Sr_no>'" & sr_no & "' and products='" & ComboBox4.Items(a).ToString() & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim dr As SQLiteDataReader
                    dr = cm4.ExecuteReader()
                    ComboBox1.Items.Clear()
                    ComboBox2.Items.Clear()
                    If dr.HasRows = True Then
                        While dr.Read()
                            ComboBox1.Items.Add(dr(0).ToString())
                            ComboBox2.Items.Add(dr(1).ToString())
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
                For i = 0 To cnt - 1
                    cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty+'" & (pre_qty) & "'   where date='" & ComboBox1.Items(i).ToString() & "' and sr_no='" & ComboBox2.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and products='" & ComboBox4.Items(a).ToString() & "' ", cn)
                    cn.Close()
                    cn.Open()
                    'MsgBox(pre_qty)
                    cmd.ExecuteNonQuery()
                    'MsgBox("update other")
                    cn.Close()
                    cn.Open()
aa:
                Next i
            End If
            cmd = New SQLiteCommand("delete from stock_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and products='" & ComboBox4.Items(a).ToString() & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            cn.Open()
        Next
    End Sub
    Private Sub remove_accounting()
        Dim i As Integer
        Dim source1 As String = "SALE"
        Dim pre_qty As String
        Dim pre_bal_qty As String
        Dim a As Integer
        'Dim c As Integer
        'MsgBox("in remv")
        For a = 0 To ComboBox8.Items.Count.ToString - 1
            'MsgBox("in remv")
            Dim cm1 As SQLiteCommand
            cm1 = New SQLiteCommand("select max(Sr_no),Debit_amount from party_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and party_name='" & ComboBox8.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter1 As New SQLiteDataAdapter(cm1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)
            'MsgBox(table1.Rows(0)(1).ToString())
            pre_qty = table1.Rows(0)(1).ToString()
            'MsgBox(table1.Rows(0)(0).ToString())
            Dim sr_no As String = table1.Rows(0)(0).ToString()
            adapter1.Dispose()
            'MsgBox("get pre qty")
            '...............................................................................................
            ' pre_bal_qty'...
            Dim cm2 As SQLiteCommand
            cm2 = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where Sr_no<'" & sr_no & "'  AND  party_name='" & ComboBox8.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter2 As New SQLiteDataAdapter(cm2)
            Dim table2 As New DataTable()
            adapter2.Fill(table2)
            'MsgBox(table2.Rows(0)(1).ToString())
            pre_bal_qty = table2.Rows(0)(1).ToString()
            'MsgBox(pre_bal_qty)
            'MsgBox("get bal qty")
            If pre_bal_qty = "" Then
                pre_bal_qty = 0
            End If
            Dim abs As String = "-"
            Dim ns As String = Replace(bill_date.Text, abs, "")
            Dim my As String = ns.Remove(0, 2)
            Dim y As String = my.Remove(0, 2)
            Dim mn As String = my.Substring(0, 2)
            Dim day As String = ns.Substring(0, 2)
            Dim all As String = y + mn + day
            'MsgBox(all)
            Dim cm3 As SQLiteCommand
            cm3 = New SQLiteCommand("select count(*) from party_ledger where own_date>='" & all & "' and Sr_no>'" & sr_no & "'  and party_name='" & ComboBox8.Items(a).ToString() & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter3 As New SQLiteDataAdapter(cm3)
            Dim table3 As New DataTable()
            adapter3.Fill(table3)
            Dim cnt As String
            If table3.Rows(0)(0).ToString() <> 0 Then
                cnt = table3.Rows(0)(0).ToString()
                Try
                    Dim cm4 As SQLiteCommand
                    cm4 = New SQLiteCommand("select own_date,sr_no from party_ledger where own_date>='" & all & "'  and Sr_no>'" & sr_no & "' and party_name='" & ComboBox8.Items(a).ToString() & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim dr As SQLiteDataReader
                    dr = cm4.ExecuteReader()
                    ComboBox5.Items.Clear()
                    ComboBox6.Items.Clear()
                    If dr.HasRows = True Then
                        While dr.Read()
                            ComboBox5.Items.Add(dr(0).ToString())
                            ComboBox6.Items.Add(dr(1).ToString())
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try
                For i = 0 To cnt - 1
                    cmd = New SQLiteCommand("update party_ledger set Balance= Balance-'" & (pre_qty) & "',Status='Pending'   where own_date='" & ComboBox5.Items(i).ToString() & "'  and sr_no='" & ComboBox6.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and party_name='" & ComboBox8.Items(a).ToString() & "' ", cn)
                    cn.Close()
                    cn.Open()
                    'MsgBox(pre_qty)
                    cmd.ExecuteNonQuery()
                    'MsgBox("update other")
                    cn.Close()
                    cn.Open()
aa:
                Next i
            End If
            cmd = New SQLiteCommand("delete from party_ledger where  Bill_No='" & TextBox2.Text & "' AND Source='" & source1 & "' and party_name='" & ComboBox8.Items(a).ToString() & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            cn.Open()
        Next
    End Sub
    Private Sub remove_current_accounting()
        Dim i As Integer
        Dim source1 As String = "SALE"
        Dim pre_qty As String
        Dim pre_bal_qty As String
        Dim a As Integer
        'Dim c As Integer
        'MsgBox("in remv")
        For a = 0 To ComboBox9.Items.Count.ToString - 1
            'MsgBox("in remv")
            Dim cm1 As SQLiteCommand
            cm1 = New SQLiteCommand("select max(Sr_no),Debit_amount from party_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and party_name='" & ComboBox9.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter1 As New SQLiteDataAdapter(cm1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)
            'MsgBox(table1.Rows(0)(1).ToString())
            pre_qty = table1.Rows(0)(1).ToString()
            'MsgBox(table1.Rows(0)(0).ToString())
            Dim sr_no As String = table1.Rows(0)(0).ToString()
            adapter1.Dispose()
            'MsgBox("get pre qty")
            '...............................................................................................
            ' pre_bal_qty'...
            Dim cm2 As SQLiteCommand
            cm2 = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where Sr_no<'" & sr_no & "'  AND  party_name='" & ComboBox9.Items(a).ToString() & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter2 As New SQLiteDataAdapter(cm2)
            Dim table2 As New DataTable()
            adapter2.Fill(table2)
            'MsgBox(table2.Rows(0)(1).ToString())
            pre_bal_qty = table2.Rows(0)(1).ToString()
            'MsgBox(pre_bal_qty)
            'MsgBox("get bal qty")
            If pre_bal_qty = "" Then
                pre_bal_qty = 0
            End If
            Dim abs As String = "-"
            Dim ns As String = Replace(bill_date.Text, abs, "")
            Dim my As String = ns.Remove(0, 2)
            Dim y As String = my.Remove(0, 2)
            Dim mn As String = my.Substring(0, 2)
            Dim day As String = ns.Substring(0, 2)
            Dim all As String = y + mn + day
            'MsgBox(all)
            Dim cm3 As SQLiteCommand
            cm3 = New SQLiteCommand("select count(*) from party_ledger where own_date>='" & all & "' and Sr_no>'" & sr_no & "'  and party_name='" & ComboBox9.Items(a).ToString() & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter3 As New SQLiteDataAdapter(cm3)
            Dim table3 As New DataTable()
            adapter3.Fill(table3)
            Dim cnt As String
            If table3.Rows(0)(0).ToString() <> 0 Then
                cnt = table3.Rows(0)(0).ToString()
                Dim cm4 As SQLiteCommand
                cm4 = New SQLiteCommand("select own_date,sr_no from party_ledger where own_date>='" & all & "'  and Sr_no>'" & sr_no & "' and party_name='" & ComboBox9.Items(a).ToString() & "' ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim dr As SQLiteDataReader
                dr = cm4.ExecuteReader()
                ComboBox5.Items.Clear()
                ComboBox6.Items.Clear()
                If dr.HasRows = True Then
                    While dr.Read()
                        ComboBox5.Items.Add(dr(0).ToString())
                        ComboBox6.Items.Add(dr(1).ToString())
                    End While
                    dr.Close()
                End If
                dr.Close()
                If cn.State = ConnectionState.Open Then
                    cn.Close()
                End If
                For i = 0 To cnt - 1
                    cmd = New SQLiteCommand("update party_ledger set Balance= Balance-'" & (pre_qty) & "' ,Status='Pending'  where own_date='" & ComboBox5.Items(i).ToString() & "' and sr_no='" & ComboBox6.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and party_name='" & ComboBox9.Items(a).ToString() & "' ", cn)
                    cn.Close()
                    cn.Open()
                    'MsgBox(pre_qty)
                    cmd.ExecuteNonQuery()
                    'MsgBox("update other")
                    cn.Close()
                    cn.Open()
aa:
                Next i
            End If
            cmd = New SQLiteCommand("delete from party_ledger where  Bill_No='" & TextBox2.Text & "' AND Source='" & source1 & "' and party_name='" & ComboBox9.Items(a).ToString() & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            cn.Open()
        Next
    End Sub
    Private Sub grid(drrr As SQLiteDataReader, client As String, bill_no As String, dates As String, pro_id As String)
        If edit Then
            edit = False
            ' MsgBox("edit")
            ' Dim cons As String = cntr
            Dim Sr As Integer = 0
            drrr.Close()
            cmd = New SQLiteCommand("delete from inner_sale where Bill_No='" & TextBox2.Text & "'", cn)
            cn.Close()
            cn.Open()
            'If cn.State = ConnectionState.Closed Then
            '    cn.Open()
            'End If
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            cn.Open()
            '............................................................................................................................
            ComboBox3.Items.Clear()
            ComboBox4.Items.Clear()
            Dim source1 As String = "SALE"
            Dim a As Integer
            Dim c As Integer
            For Each row1 As DataGridViewRow In DataGridView1.Rows
                If IsDBNull(row1.Cells("ProductName").Value) Then
                    GoTo as1
                Else
                    If row1.Cells("ProductName").Value = "" Then
                        GoTo as1
                    End If
                End If
                ComboBox3.Items.Add(row1.Cells("ProductName").Value)
            Next
as1:
            For a = 0 To ComboBox3.Items.Count.ToString - 1
                Dim cm5 As SQLiteCommand
                'MsgBox(ComboBox3.Items(a).ToString())
                cm5 = New SQLiteCommand("select * from stock_ledger where Bill_No='" & TextBox2.Text & "'  and products<>'" & ComboBox3.Items(a).ToString() & "' AND source='" & source1 & "' ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim dr4 As SQLiteDataReader
                dr4 = cm5.ExecuteReader()
                If dr4.HasRows = True Then
                    While dr4.Read()
                        ComboBox4.Items.Add(dr4(5).ToString())
                        'MsgBox(dr4(4).ToString())
                    End While
                    'dr4.Close()
                Else
                    'dr4.Close()
                End If
            Next
            'MsgBox(ComboBox3.Items.Count.ToString)
            For Each row As DataGridViewRow In DataGridView1.Rows
                If IsDBNull(row.Cells("ProductName").Value) Then
                    Exit Sub
                Else
                    If row.Cells("ProductName").Value = "" Then
                        Exit Sub
                    End If
                    Sr = Sr + 1
                    drrr.Close()
                    Using cn As New SQLiteConnection(cntr)
                        Using cmd2 As New SQLiteCommand("INSERT INTO inner_sale (Bill_No,Sr,ProductId,ProductName,HSN,QTY,FreeQTY,Unit,Rate,MRP,Amount,disc,discvalue,SGST,SGSTVal,CGST,CGSTVal,CESS,CESSVal,IGST,IGSTVal,TotAmount,product_desc,salesman,salesman_com,salesman_comp) VALUES('" & TextBox2.Text & "','" & Sr & "',@prd_id,@prd_name,@HSN,@qty,@FreeQty,@unit,@rate,@mrp,@amount,@disc,@disc_val,@SGST,@SGST_val,@CGST,@CGST_val,@CESS,@CESS_val,@IGST,@IGSTVal,@tot_amt,@product_desc,'" & salesman.Text & "','" & txt_com.Text & "','" & comp.Text & "')", cn)
                            cmd2.Parameters.AddWithValue("@prd_id", row.Cells("ProductId").Value)
                            cmd2.Parameters.AddWithValue("@prd_name", row.Cells("ProductName").Value)
                            cmd2.Parameters.AddWithValue("@HSN", row.Cells("HSN").Value)
                            cmd2.Parameters.AddWithValue("@qty", row.Cells("QTY").Value)
                            cmd2.Parameters.AddWithValue("@FreeQty", row.Cells("FreeQTY").Value)
                            cmd2.Parameters.AddWithValue("@unit", row.Cells("Unit").Value)
                            cmd2.Parameters.AddWithValue("@rate", row.Cells("Rate").Value)
                            cmd2.Parameters.AddWithValue("@mrp", row.Cells("MRP").Value)
                            cmd2.Parameters.AddWithValue("@amount", row.Cells("Amount").Value)
                            cmd2.Parameters.AddWithValue("@disc", row.Cells("Discount").Value)
                            cmd2.Parameters.AddWithValue("@disc_val", row.Cells("DiscValue").Value)
                            cmd2.Parameters.AddWithValue("@SGST", row.Cells("SGST").Value)
                            cmd2.Parameters.AddWithValue("@SGST_val", row.Cells("SGSTVal").Value)
                            cmd2.Parameters.AddWithValue("@CGST", row.Cells("CGST").Value)
                            cmd2.Parameters.AddWithValue("@CGST_val", row.Cells("CGSTVal").Value)
                            cmd2.Parameters.AddWithValue("@CESS", row.Cells("CESS").Value)
                            cmd2.Parameters.AddWithValue("@CESS_val", row.Cells("CESSVal").Value)
                            cmd2.Parameters.AddWithValue("@IGST", row.Cells("IGST").Value)
                            cmd2.Parameters.AddWithValue("@IGSTVal", row.Cells("IGSTVal").Value)
                            cmd2.Parameters.AddWithValue("@tot_amt", row.Cells("TotAmount").Value)
                            cmd2.Parameters.AddWithValue("@product_desc", row.Cells("product_desc").Value)

                            cn.Open()
                            'MsgBox("k")
                            cmd2.ExecuteNonQuery()
                            'MsgBox("grid complete")
                            cmd2.Dispose()
                            cn.Close()
                            '..............................................................................................................................
                            ' pre_qty'...
                            Dim etc As Integer
                            Dim i As Integer
                            'Dim source1 As String = "SALE"
                            Dim pre_qty As String
                            Dim pre_bal_qty As String
                            'Dim a As Integer
                            'Dim c As Integer
                            For a = 0 To ComboBox3.Items.Count.ToString - 1
                                Try
                                    For c = 0 To ComboBox4.Items.Count.ToString - 1
                                        If ComboBox4.Items(c).ToString() = ComboBox3.Items(a).ToString() Then
                                            'MsgBox("found")
                                            'MsgBox(ComboBox4.Items(c).ToString())
                                            ComboBox4.Items.Remove(ComboBox4.Items(c))
                                        End If
                                    Next
                                Catch ex As Exception
                                End Try
                            Next
                            'MsgBox(ComboBox4.Items.Count.ToString)
                            For i = 0 To ComboBox4.Items.Count - 2
                                For j As Int16 = ComboBox4.Items.Count - 1 To i + 1 Step -1
                                    If ComboBox4.Items(i).ToString = ComboBox4.Items(j).ToString Then
                                        ComboBox4.Items.RemoveAt(j)
                                    End If
                                Next
                            Next
                            Dim qty As Integer = row.Cells("QTY").Value
                            Dim freeqty As Integer = row.Cells("FreeQTY").Value
                            Dim tot_qty As Integer = qty + freeqty
                            ComboBox1.Items.Clear()
                            ComboBox2.Items.Clear()
                            If ComboBox4.Items.Count >= 1 Then
                                remv(tot_qty)
                            End If
                            Dim cm1 As SQLiteCommand
                            cm1 = New SQLiteCommand("select max(Sr_no),out_qty from stock_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and products='" & row.Cells("ProductName").Value & "'", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter1 As New SQLiteDataAdapter(cm1)
                            Dim table1 As New DataTable()
                            adapter1.Fill(table1)
                            If table1.Rows(0)(1).ToString() = "" Then
                                'MsgBox("no previous record")
                                Dim cm As SQLiteCommand
                                cm = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where products='" & row.Cells("ProductName").Value & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter As New SQLiteDataAdapter(cm)
                                Dim table As New DataTable()
                                adapter.Fill(table)
                                Dim qty1 As Integer = row.Cells("QTY").Value
                                Dim bal_stk As Integer
                                Dim free_qty1 As Integer
                                If Not IsDBNull(row.Cells("QTY").Value) Then
                                    free_qty1 = row.Cells("FreeQTY").Value
                                Else
                                    free_qty1 = 0
                                End If
                                If table.Rows(0)(1).ToString() = "" Then
                                    bal_stk = 0
                                Else
                                    bal_stk = table.Rows(0)(1).ToString()
                                End If
                                Dim total_bal1 As Integer = bal_stk - (qty1 + free_qty1)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                'MsgBox("k")
                                Dim source As String = "SALE"
                                Dim abs1 As String = "/"
                                Dim ns1 As String = Replace(bill_date.Text, abs1, "")
                                Dim my1 As String = ns1.Remove(0, 2)
                                Dim y1 As String = my1.Remove(0, 2)
                                Dim mn1 As String = my1.Substring(0, 2)
                                Dim day1 As String = ns1.Substring(0, 2)
                                Dim all1 As String = y1 + mn1 + day1
                                cmd = New SQLiteCommand("insert into stock_ledger (Bill_No,party_name,Date,stock_date,products,source,out_qty,bal_qty,product_id) values ('" & bill_no & "','" & client & "','" & all1 & "','" & bill_date.Text & "','" & row.Cells("ProductName").Value & "','" & source & "','" & row.Cells("QTY").Value + free_qty1 & "','" & total_bal1 & "','" & row.Cells("ProductId").Value & "')", cn)
                                adapter.Dispose()
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                'MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
                                cn.Close()
                                GoTo abs
                            End If
                            'MsgBox(table1.Rows(0)(1).ToString())
                            pre_qty = table1.Rows(0)(1).ToString()
                            'MsgBox(table1.Rows(0)(0).ToString())
                            Dim sr_no As Integer = table1.Rows(0)(0).ToString()
                            adapter1.Dispose()
                            'MsgBox("get pre qty")
                            '...............................................................................................
                            qty = row.Cells("QTY").Value
                            'Dim bal_stk As Integer
                            Dim free_qty As Integer
                            If Not IsDBNull(row.Cells("QTY").Value) Then
                                free_qty = row.Cells("FreeQTY").Value
                            Else
                                free_qty = 0
                            End If
                            ' pre_bal_qty'...
                            Dim cm2 As SQLiteCommand
                            cm2 = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where Sr_no<'" & sr_no & "'  AND  products='" & row.Cells("ProductName").Value & "'", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter2 As New SQLiteDataAdapter(cm2)
                            Dim table2 As New DataTable()
                            adapter2.Fill(table2)
                            'MsgBox(table2.Rows(0)(1).ToString())
                            pre_bal_qty = table2.Rows(0)(1).ToString()
                            'MsgBox(pre_bal_qty)
                            'MsgBox("get bal qty")
                            If pre_bal_qty = "" Then
                                pre_bal_qty = 0
                            End If
                            'Label6.Text = table2.Rows(0)(1).ToString()
                            'adapter2.Dispose()
                            'MsgBox(pre_bal_qty)
                            Dim abs As String = "/"
                            Dim ns As String = Replace(bill_date.Text, abs, "")
                            Dim my As String = ns.Remove(0, 2)
                            Dim y As String = my.Remove(0, 2)
                            Dim mn As String = my.Substring(0, 2)
                            Dim day As String = ns.Substring(0, 2)
                            Dim all As String = y + mn + day
                            'MsgBox(all)
                            Dim cm3 As SQLiteCommand
                            cm3 = New SQLiteCommand("select count(*) from stock_ledger where date>='" & all & "' and Sr_no>'" & sr_no & "'  and products='" & row.Cells("ProductName").Value & "' ", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter3 As New SQLiteDataAdapter(cm3)
                            Dim table3 As New DataTable()
                            adapter3.Fill(table3)
                            Dim cnt As String
                            If table3.Rows(0)(0).ToString() <> 0 Then
                                cnt = table3.Rows(0)(0).ToString()
                                Dim cm4 As SQLiteCommand
                                cm4 = New SQLiteCommand("select date,sr_no from stock_ledger where date>='" & all & "'  and Sr_no>'" & sr_no & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim dr As SQLiteDataReader
                                dr = cm4.ExecuteReader()
                                ComboBox1.Items.Clear()
                                ComboBox2.Items.Clear()
                                If dr.HasRows = True Then
                                    While dr.Read()
                                        ComboBox1.Items.Add(dr(0).ToString())
                                        ComboBox2.Items.Add(dr(1).ToString())
                                    End While
                                    dr.Close()
                                End If
                                dr.Close()
                                If cn.State = ConnectionState.Open Then
                                    cn.Close()
                                End If
                                For i = 0 To cnt - 1
                                    'ComboBox1.Items(i).ToString()
                                    If pre_qty > (qty + free_qty) Then
                                        'MsgBox("1st block")
                                        etc = pre_qty - (qty + free_qty)
                                        'MsgBox(pre_qty)
                                        'MsgBox(etc)
                                        cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty+'" & (etc) & "'   where date='" & ComboBox1.Items(i).ToString() & "' and sr_no='" & ComboBox2.Items(i).ToString() & "'  and Sr_no>'" & sr_no & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                        'cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty-'" & etc & "'   where Bill_No='" & ComboBox1.Items(i).ToString() & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                    ElseIf pre_qty < (qty + free_qty) Then
                                        'MsgBox("2nd block")
                                        etc = (qty + free_qty) - pre_qty
                                        'MsgBox(pre_qty)
                                        'MsgBox(etc)
                                        'cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty+'" & etc & "'   where Bill_No='" & ComboBox1.Items(i).ToString() & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                        cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty-'" & (etc) & "'   where date='" & ComboBox1.Items(i).ToString() & "' and sr_no='" & ComboBox2.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                    Else
                                        'MsgBox("3rd block")
                                        GoTo aa
                                    End If
                                    cn.Close()
                                    cn.Open()
                                    'MsgBox(pre_qty)
                                    cmd.ExecuteNonQuery()
                                    'MsgBox("update other")
                                    cn.Close()
                                    cn.Open()
aa:
                                Next i
                            End If
                            If pre_bal_qty = "" Then
                                pre_bal_qty = 0
                            End If
                            Dim total_bal As Integer = -(qty + free_qty) + (pre_bal_qty)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            'MsgBox(total_bal)
                            cmd = New SQLiteCommand("update stock_ledger set out_qty='" & qty + free_qty & "', bal_qty= '" & total_bal & "' where Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and products='" & row.Cells("ProductName").Value & "'", cn)
                            cn.Close()
                            cn.Open()
                            cmd.ExecuteNonQuery()
                            cmd.Dispose()
                            cn.Close()
                            cn.Open()
                            cn.Close()
abs:
                        End Using
                    End Using
                End If
            Next
            MsgBox("record inserted")
            MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
        Else
            Try
                ' Dim cons As String = cntr
                Dim Sr As Integer = 0
                For Each row As DataGridViewRow In DataGridView1.Rows
                    If IsDBNull(row.Cells("ProductName").Value) Then
                        Exit Sub
                    Else
                        If row.Cells("ProductName").Value = "" Then
                            Exit Sub
                        End If
                        Sr = Sr + 1
                        'MsgBox(ss)
                        drrr.Close()
                        Using cn As New SQLiteConnection(cntr)
                            'Dim cmd2 As SQLiteCommand
                            Using cmd2 As New SQLiteCommand("INSERT INTO inner_sale (Bill_No,Sr,ProductId,ProductName,HSN,QTY,FreeQTY,Unit,Rate,MRP,Amount,disc,discvalue,SGST,SGSTVal,CGST,CGSTVal,CESS,CESSVal,IGST,IGSTVal,TotAmount,product_desc,salesman,salesman_com,salesman_comp) VALUES('" & TextBox2.Text & "','" & Sr & "',@prd_id,@prd_name,@HSN,@qty,@FreeQty,@unit,@rate,@mrp,@amount,@disc,@disc_val,@SGST,@SGST_val,@CGST,@CGST_val,@CESS,@CESS_val,@IGST,@IGSTVal,@tot_amt,@product_desc,'" & salesman.Text & "','" & txt_com.Text & "','" & comp.Text & "')", cn)
                                cmd2.Parameters.AddWithValue("@prd_id", row.Cells("ProductId").Value)
                                cmd2.Parameters.AddWithValue("@prd_name", row.Cells("ProductName").Value)
                                cmd2.Parameters.AddWithValue("@HSN", row.Cells("HSN").Value)
                                cmd2.Parameters.AddWithValue("@qty", row.Cells("QTY").Value)
                                cmd2.Parameters.AddWithValue("@FreeQty", row.Cells("FreeQTY").Value)
                                cmd2.Parameters.AddWithValue("@unit", row.Cells("Unit").Value)
                                cmd2.Parameters.AddWithValue("@rate", row.Cells("Rate").Value)
                                cmd2.Parameters.AddWithValue("@mrp", row.Cells("MRP").Value)
                                cmd2.Parameters.AddWithValue("@amount", row.Cells("Amount").Value)
                                cmd2.Parameters.AddWithValue("@disc", row.Cells("Discount").Value)
                                cmd2.Parameters.AddWithValue("@disc_val", row.Cells("DiscValue").Value)
                                cmd2.Parameters.AddWithValue("@SGST", row.Cells("SGST").Value)
                                cmd2.Parameters.AddWithValue("@SGST_val", row.Cells("SGSTVal").Value)
                                cmd2.Parameters.AddWithValue("@CGST", row.Cells("CGST").Value)
                                cmd2.Parameters.AddWithValue("@CGST_val", row.Cells("CGSTVal").Value)
                                cmd2.Parameters.AddWithValue("@CESS", row.Cells("CESS").Value)
                                cmd2.Parameters.AddWithValue("@CESS_val", row.Cells("CESSVal").Value)
                                cmd2.Parameters.AddWithValue("@IGST", row.Cells("IGST").Value)
                                cmd2.Parameters.AddWithValue("@IGSTVal", row.Cells("IGSTVal").Value)
                                cmd2.Parameters.AddWithValue("@tot_amt", row.Cells("TotAmount").Value)
                                cmd2.Parameters.AddWithValue("@product_desc", row.Cells("product_desc").Value)
                                'If row.Cells("TotAmount").Value = 0 Then
                                '    MsgBox("found")
                                'End If
                                Dim cm As SQLiteCommand
                                cm = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where products='" & row.Cells("ProductName").Value & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter As New SQLiteDataAdapter(cm)
                                Dim table As New DataTable()
                                adapter.Fill(table)
                                Dim qty As Integer = row.Cells("QTY").Value
                                Dim bal_stk As Integer
                                Dim free_qty As Integer
                                If Not IsDBNull(row.Cells("QTY").Value) Then
                                    free_qty = row.Cells("FreeQTY").Value
                                Else
                                    free_qty = 0
                                End If
                                If table.Rows(0)(1).ToString() = "" Then
                                    bal_stk = 0
                                Else
                                    bal_stk = table.Rows(0)(1).ToString()
                                End If
                                Dim total_bal As Integer = bal_stk - (qty + free_qty)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                'MsgBox("k")
                                Dim source As String = "SALE"
                                Dim abs As String = "/"
                                Dim ns As String = Replace(bill_date.Text, abs, "")
                                Dim my As String = ns.Remove(0, 2)
                                Dim y As String = my.Remove(0, 2)
                                Dim mn As String = my.Substring(0, 2)
                                Dim day As String = ns.Substring(0, 2)
                                Dim all As String = y + mn + day
                                cmd = New SQLiteCommand("insert into stock_ledger (Bill_No,party_name,Date,stock_date,products,source,out_qty,bal_qty,product_id) values ('" & bill_no & "','" & client & "','" & all & "','" & bill_date.Text & "','" & row.Cells("ProductName").Value & "','" & source & "','" & row.Cells("QTY").Value + free_qty & "','" & total_bal & "','" & row.Cells("ProductId").Value & "')", cn)
                                adapter.Dispose()
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                'MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
                                cmd2.ExecuteNonQuery()
                                cmd2.Dispose()
                                cn.Close()
                            End Using
                        End Using
                    End If
                Next
                MsgBox("record inserted")
                MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
            Catch ex As Exception
                MsgBox(ex.Message)
            Finally
                If cn.State = ConnectionState.Open Then
                End If
            End Try
        End If
    End Sub
    Public Sub Button4_Click(sender As Object, e As EventArgs) Handles btn_save.Click
        If cash.Checked = True Then
            pay_status = "Received"
        Else
            pay_status = "Pending"
        End If
        cn.Close()
        If TextBox16.Text = "" Then
            MsgBox("Total can't be 0", MsgBoxStyle.Exclamation)
            outer_disc_rate = False
            outer_disc_val = False
            Exit Sub
        End If
        If DataGridView1.Rows.Count.ToString() - 1 = 0 Then
            MsgBox("Please Select atleast one product ", MsgBoxStyle.Exclamation)
            DataGridView1.Focus()
            Exit Sub
        End If
        Dim number As Integer = 0
        Dim tot As Double
        number = DataGridView1.Rows.Count - 1
        Dim x As Integer
        For x = 0 To DataGridView1.Rows.Count - 2
            tot = Convert.ToDouble(DataGridView1.Rows(x).Cells("TotAmount").Value)
            If IsDBNull(DataGridView1.Rows(x).Cells("FreeQTY").Value) Then
                DataGridView1.Rows(x).Cells("FreeQTY").Value = 0
            End If
            'If Not IsDBNull(DataGridView1.Rows(i).Cells("FreeQTY").Value) Then
            Dim freeqty As Integer = DataGridView1.Rows(x).Cells("FreeQTY").Value
            'End If
            'MsgBox(tot)
            If tot = 0 And Not freeqty >= 1 Then
                number = number + 1
                MsgBox("Foud Some Product/Products with total amount ""0"" (Zero) ", MsgBoxStyle.Exclamation)
                Exit Sub
            Else
                'MsgBox("no found")
            End If
            If freeqty >= 1 And DataGridView1.Rows(x).Cells("Rate").Value = 0 Then
                DataGridView1.Rows(x).Cells("QTY").Value = 0
            End If
            'MsgBox(i)
        Next x
        'MsgBox(number)
        If TextBox20.Text = "" Or TextBox20.Text = 0 Or TextBox20.Text <= 0 Then
            MsgBox("Net amount can't be 0", MsgBoxStyle.Exclamation)
            DataGridView1.Focus()
            Exit Sub
        End If
        If client_name.Text = "" Then
            MsgBox("Please Enter Client Name", MsgBoxStyle.Exclamation)
            Me.SelectNextControl(owntext, False, False, True, True)
            owntext.Focus()
        Else
            Dim dates As String = bill_date.Text
            Dim dr3 As SQLiteDataReader
            Dim bill_no As String = TextBox2.Text
            Dim client As String = client_name.Text
            Dim assq As String = 0
            Try
                cmd = New SQLiteCommand("select * from client where name='" & client_name.Text & "' ", cn)
                cn.Close()
                cn.Open()
                dr3 = cmd.ExecuteReader()
                If dr3.HasRows = False Then
                    'client_name.Focus()
                    'client_master.c1.Text = client_name.Text
                    dr3.Close()
                    If client_master.WindowState = FormWindowState.Minimized Then
                        client_master.WindowState = FormWindowState.Normal
                    End If
                    Dim client_masterf As New client_master()
                    client_master.Show()

                    'client_master.Show()
                    client_master.BringToFront()
                Else
                    dr3.Close()
                    Dim payment As String
                    If cash.Checked = True Then
                        payment = "Cash"
                    Else
                        payment = "Credit"
                    End If
                    If edit Then
                        Try
                            'MsgBox("edit bill")
                            grid(dr3, client, bill_no, dates, assq)
                            'cmd = New SQLiteCommand("update product_details set main_name='" & main.Text & "',sub_name='" & sub_group.Text & "',product_name='" & Box1.Text & "',Description='" & podate & "',Product_ID='" & Box3.Text & "',HSN='" & rf_date & "',unit='" & unit.Text & "',sale_rate='" & Box5.Text & "',purchase_rate='" & qu_date & "',discount_percent='" & Box7.Text & "',MRP='" & dispa_date & "',SGST='" & Box9.Text & "',CGST='" & Box10.Text & "',IGST='" & Box11.Text & "',CESS='" & Box12.Text & "' where product_name='" & select_product.Text & "'", cn)
                            'dr3.Close()
                            '..............................main updating coding......................................................
                            ComboBox7.Items.Add(client_name.Text)
                            Dim source1 As String = "SALE"
                            Dim a As Integer
                            For a = 0 To ComboBox7.Items.Count.ToString - 1
                                Dim cm5 As SQLiteCommand
                                'MsgBox(ComboBox3.Items(a).ToString())
                                cm5 = New SQLiteCommand("select * from party_ledger where Bill_No='" & TextBox2.Text & "'  and party_name<>'" & client_name.Text & "' AND source='" & source1 & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim dr4 As SQLiteDataReader
                                dr4 = cm5.ExecuteReader()
                                If dr4.HasRows = True Then
                                    While dr4.Read()
                                        ComboBox8.Items.Add(dr4(2).ToString())
                                        'MsgBox(dr4(4).ToString())
                                    End While
                                    'dr4.Close()
                                Else
                                    'dr4.Close()
                                End If
                            Next
                            Dim etc As Integer
                            Dim i As Integer
                            'Dim source1 As String = "SALE"
                            Dim pre_qty As String
                            Dim pre_bal_qty As String
                            Dim qty As Integer = TextBox20.Text
                            Dim freeqty As Integer = 0
                            Dim tot_qty As Integer = qty + freeqty
                            ComboBox5.Items.Clear()
                            ComboBox6.Items.Clear()
                            If ComboBox8.Items.Count >= 1 Then
                                'MsgBox("calling removing accounting")
                                remove_accounting()
                            End If
                            Dim cm1 As SQLiteCommand
                            cm1 = New SQLiteCommand("select max(Sr_no),Debit_amount from party_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and party_name='" & client_name.Text & "'", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter1 As New SQLiteDataAdapter(cm1)
                            Dim table1 As New DataTable()
                            adapter1.Fill(table1)
                            ' MsgBox(table1.Rows(0)(1).ToString())
                            If table1.Rows(0)(1).ToString() = "" Then
                                'MsgBox("no previous record")
                                Dim cm As SQLiteCommand
                                cm = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where party_name='" & client_name.Text & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter As New SQLiteDataAdapter(cm)
                                Dim table As New DataTable()
                                adapter.Fill(table)
                                Dim qty1 As Integer = TextBox20.Text
                                Dim bal_stk As Integer
                                Dim free_qty1 As Integer = 0
                                If table.Rows(0)(1).ToString() = "" Then
                                    bal_stk = 0
                                Else
                                    bal_stk = table.Rows(0)(1).ToString()
                                End If
                                Dim total_bal1 As Integer = bal_stk - (qty1 + free_qty1)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                'MsgBox("k")
                                Dim tot1 As Double = bal_stk + TextBox20.Text
                                Dim source As String = "SALE"
                                Dim abs1 As String = "/"
                                Dim ns1 As String = Replace(bill_date.Text, abs1, "")
                                Dim my1 As String = ns1.Remove(0, 2)
                                Dim y1 As String = my1.Remove(0, 2)
                                Dim mn1 As String = my1.Substring(0, 2)
                                Dim day1 As String = ns1.Substring(0, 2)
                                Dim all1 As String = y1 + mn1 + day1
                                Dim sm As String = salesman.Text
                                Dim smc As Double = txt_com.Text
                                If credit.Checked Then
                                    cmd = New SQLiteCommand("insert into party_ledger (Bill_No,party_name,bill_date,own_date,Source,Debit_amount,Balance,Status) values ('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & all1 & "','" & source & "','" & TextBox20.Text & "','" & tot1 & "','Pending')", cn)
                                    Dim cmdsl As SQLiteCommand
                                    cmdsl = New SQLiteCommand("insert into salesman_ledger (Bill_No,party_name,bill_date,salesman_name,Debit_amount,Balance,salesman_com) values ('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & sm & "','" & TextBox20.Text & "','" & tot1 & "','" & smc & "')", cn)
                                    Dim cmdpl As SQLiteCommand
                                    cmdpl = New SQLiteCommand("insert into profit (bill_no,party_name,invoice_date,invoice_amt,profit_amt,salesman)values('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & TextBox20.Text & "','" & profitamt.Text & "','" & sm & "')", cn)
                                    adapter.Dispose()
                                    If cn.State = ConnectionState.Closed Then
                                        cn.Open()
                                    End If
                                    cmd.ExecuteNonQuery()
                                    cmdsl.ExecuteNonQuery()
                                    cmdpl.ExecuteNonQuery()
                                    cmd.Dispose()
                                    cn.Close()
                                End If
                                GoTo abs
                            End If
                            pre_qty = table1.Rows(0)(1).ToString()
                            Dim sr_no As Integer = table1.Rows(0)(0).ToString()
                            adapter1.Dispose()
                            '...............................................................................................
                            qty = TextBox20.Text
                            'Dim bal_stk As Integer
                            Dim free_qty As Integer = 0
                            ' pre_bal_qty'...
                            Dim cm2 As SQLiteCommand
                            cm2 = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where Sr_no<'" & sr_no & "'  AND  party_name='" & client_name.Text & "'", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter2 As New SQLiteDataAdapter(cm2)
                            Dim table2 As New DataTable()
                            adapter2.Fill(table2)
                            'MsgBox(table2.Rows(0)(1).ToString())
                            pre_bal_qty = table2.Rows(0)(1).ToString()
                            'MsgBox(pre_bal_qty)
                            'MsgBox("get bal qty")
                            If pre_bal_qty = "" Then
                                pre_bal_qty = 0
                            End If
                            'Label6.Text = table2.Rows(0)(1).ToString()
                            'adapter2.Dispose()
                            'MsgBox(pre_bal_qty)
                            Dim abs As String = "-"
                            Dim ns As String = Replace(bill_date.Text, abs, "")
                            Dim my As String = ns.Remove(0, 2)
                            Dim y As String = my.Remove(0, 2)
                            Dim mn As String = my.Substring(0, 2)
                            Dim day As String = ns.Substring(0, 2)
                            Dim all As String = y + mn + day
                            '''''''''''''''''''''if bill change from credit from cash ....................................... 
                            Dim cm6 As SQLiteCommand
                            'MsgBox(ComboBox3.Items(a).ToString())
                            cm6 = New SQLiteCommand("select * from party_ledger where Bill_No='" & TextBox2.Text & "'  and party_name='" & client_name.Text & "' AND Source='" & source1 & "'", cn)
                            'cm6 = New SQLiteCommand("select * from party_ledger where Bill_No=106  and party_name= ""patil dist.""  AND Source=""SALE""", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim dr5 As SQLiteDataReader
                            dr5 = cm6.ExecuteReader()
                            ComboBox9.Items.Clear()
                            If dr5.HasRows = True Then
                                'MsgBox("found previous record")
                                While dr5.Read()
                                    ComboBox9.Items.Add(dr5(2).ToString())
                                    'MsgBox(dr4(4).ToString())
                                End While
                                'dr4.Close()
                            Else
                                'dr4.Close()
                            End If
                            ''''''''''''''''''''' end retrive bill numbers .......................................
                            'MsgBox(all)
                            Dim cm3 As SQLiteCommand
                            cm3 = New SQLiteCommand("select count(*) from party_ledger where own_date>='" & all & "' and Sr_no>'" & sr_no & "'  and party_name='" & client_name.Text & "' ", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter3 As New SQLiteDataAdapter(cm3)
                            Dim table3 As New DataTable()
                            adapter3.Fill(table3)
                            Dim cnt As String
                            If table3.Rows(0)(0).ToString() <> 0 Then
                                cnt = table3.Rows(0)(0).ToString()
                                Try
                                    Dim cm4 As SQLiteCommand
                                    cm4 = New SQLiteCommand("select own_date,sr_no from party_ledger where own_date>='" & all & "'  and Sr_no>'" & sr_no & "' and party_name='" & client_name.Text & "' ", cn)
                                    If cn.State = ConnectionState.Closed Then
                                        cn.Open()
                                    End If
                                    Dim dr As SQLiteDataReader
                                    dr = cm4.ExecuteReader()
                                    ComboBox5.Items.Clear()
                                    ComboBox6.Items.Clear()
                                    If dr.HasRows = True Then
                                        While dr.Read()
                                            ComboBox5.Items.Add(dr(0).ToString())
                                            ComboBox6.Items.Add(dr(1).ToString())
                                        End While
                                        dr.Close()
                                    End If
                                    dr.Close()
                                Catch ex As Exception
                                    MsgBox(ex.Message)
                                Finally
                                    If cn.State = ConnectionState.Open Then
                                        cn.Close()
                                    End If
                                End Try
                                If credit.Checked = True Then
                                    For i = 0 To cnt - 1
                                        'ComboBox1.Items(i).ToString()
                                        If pre_qty > (qty + free_qty) Then
                                            'MsgBox("1st block")
                                            etc = pre_qty - (qty + free_qty)
                                            'MsgBox(pre_qty)
                                            'MsgBox(etc)
                                            cmd = New SQLiteCommand("update party_ledger set Balance= Balance-'" & (etc) & "' ,Status='Pending'  where own_date='" & ComboBox5.Items(i).ToString() & "' and sr_no='" & ComboBox6.Items(i).ToString() & "'  and Sr_no>'" & sr_no & "' and party_name='" & client_name.Text & "' '", cn)
                                            'cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty-'" & etc & "'   where Bill_No='" & ComboBox1.Items(i).ToString() & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                        ElseIf pre_qty < (qty + free_qty) Then
                                            'MsgBox("2nd block")
                                            etc = (qty + free_qty) - pre_qty
                                            'MsgBox(pre_qty)
                                            'MsgBox(etc)
                                            'cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty+'" & etc & "'   where Bill_No='" & ComboBox1.Items(i).ToString() & "' and products='" & row.Cells("ProductName").Value & "' ", cn)
                                            cmd = New SQLiteCommand("update party_ledger set Balance= Balance+'" & (etc) & "',Status='Pending'   where own_date='" & ComboBox5.Items(i).ToString() & "' and sr_no='" & ComboBox6.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and party_name='" & client_name.Text & "' ", cn)
                                        Else
                                            'MsgBox("3rd block")
                                            GoTo aa
                                        End If
                                        cn.Close()
                                        cn.Open()
                                        'MsgBox(pre_qty)
                                        cmd.ExecuteNonQuery()
                                        'MsgBox("update other")
                                        cn.Close()
                                        cn.Open()
aa:
                                    Next i
                                Else
                                    If ComboBox9.Items.Count >= 1 Then
                                        'MsgBox("in cash")
                                        remove_current_accounting()
                                    End If
                                End If
                            End If
                            If pre_bal_qty = "" Then
                                pre_bal_qty = 0
                            End If
                            Dim current_bal As Integer = TextBox20.Text
                            Dim total_bal As Integer = current_bal + (pre_bal_qty)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            'MsgBox(total_bal)
                            If credit.Checked = True Then
                                cmd = New SQLiteCommand("update party_ledger set Debit_amount='" & qty + free_qty & "', Balance= '" & total_bal & "',Status='Pending' where Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and party_name='" & client_name.Text & "'", cn)
                                cn.Close()
                                cn.Open()
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                            Else
                                If ComboBox9.Items.Count >= 1 Then
                                    remove_current_accounting()
                                End If
                            End If
                            cn.Close()
                            cn.Open()
                            cn.Close()
abs:
                            '............................................end updating party balance.............................
                            ''''''''''''''...................'''update cash record inserting......................................
                            If cash.Checked = True Then
                                Dim cm7 As SQLiteCommand
                                'MsgBox(ComboBox3.Items(a).ToString())
                                cm7 = New SQLiteCommand("select  Net_amount from outer_sale where Bill_No='" & TextBox2.Text & "' ", cn)
                                'cm6 = New SQLiteCommand("select * from party_ledger where Bill_No=106  and party_name= ""patil dist.""  AND Source=""SALE""", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter4 As New SQLiteDataAdapter(cm7)
                                Dim table4 As New DataTable()
                                adapter4.Fill(table4)
                                Dim pre_net As String
                                If table4.Rows(0)(0).ToString() = "" Then
                                    pre_net = 0
                                Else
                                    pre_net = table4.Rows(0)(0).ToString()
                                End If
                                adapter4.Dispose()
                                table4.Dispose()
                                cmd = New SQLiteCommand("update cash_account set balance=balance- '" & pre_net & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                cn.Close()
                                cmd = New SQLiteCommand("update cash_account set balance=balance+ '" & TextBox20.Text & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                cn.Close()
                            End If
                            '........................................end update cash record inserting.........................
                            Dim inn As Double
                            Dim out As Double
                            If TextBox14.Text = "" Then
                                inn = 0
                            Else
                                inn = TextBox14.Text
                            End If
                            If TextBox17.Text = "" Then
                                out = 0
                            Else
                                out = TextBox17.Text
                            End If
                            'MsgBox(tot_disc)
                            Dim ab As String = "/"
                            Dim n As String = Replace(bill_date.Text, ab, "")
                            Dim m As String = n.Remove(0, 2)
                            Dim y2 As String = m.Remove(0, 2)
                            Dim m11 As String = m.Substring(0, 2)
                            Dim da As String = n.Substring(0, 2)
                            Dim al As String = y2 + m11 + da
                            Dim tot_disc As Double = Math.Round(inn + out, 2)
                            '.......delivery status.............
                            cmd = New SQLiteCommand("select Ref_no from outer_sale where bill_no='" & TextBox2.Text & "' and deli_status='Completed' ", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            dr3 = cmd.ExecuteReader()
                            Dim deli_no As Integer
                            If dr3.HasRows = True Then
                                While dr3.Read
                                    deli_no = dr3(0)
                                End While
                                dr3.Close()
                                cn.Close()
                                cmd = New SQLiteCommand("update outer_delivery_note set Status='Pending' where Bill_no='" & deli_no & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                            End If
                            dr3.Close()
                            cn.Close()
                            '.....................................
                            If deli_status Then
                                cmd = New SQLiteCommand("update outer_delivery_note set Status='Completed' where Bill_no='" & Box3.Text & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                            End If
                            '.......................
                            Dim podate As String = ""
                            Dim rf_date As String = ""
                            Dim qu_date As String = ""
                            Dim dispa_date As String = ""
                            Dim lrdate As String = ""
                            Dim ew_date As String = ""

                            If Box2.Visible Then
                                podate = Box2.Text
                            End If
                            If Box4.Visible Then
                                rf_date = Box4.Text
                            End If
                            If Box6.Visible Then
                                qu_date = Box6.Text
                            End If
                            If Box8.Visible Then
                                dispa_date = Box8.Text
                            End If
                            If Box16.Visible Then
                                lrdate = Box16.Text
                            End If
                            If eway_date.Visible Then
                                ew_date = eway_date.Text
                            End If
                            Dim nz As String = Replace(due_date.Text, ab, "")
                            Dim mz As String = nz.Remove(0, 2)
                            Dim y2z As String = mz.Remove(0, 2)
                            Dim m11z As String = mz.Substring(0, 2)
                            Dim daz As String = nz.Substring(0, 2)
                            Dim due_doc As String = y2z + m11z + daz
                            Dim docs_dates As String = y2z & "/" & m11z & "/" & daz
                            '...................................
                            Dim fright As String
                            If add_less Then
                                fright = "to-Paid"
                            Else
                                fright = "Paid"
                            End If
                            '.................................
                            '...................................
                            Dim lr_doc As String
                            If lrdate <> "" Then
                                Dim nza As String = Replace(lrdate, ab, "")
                                Dim mza As String = nza.Remove(0, 2)
                                Dim y2za As String = mza.Remove(0, 2)
                                Dim m11za As String = mza.Substring(0, 2)
                                Dim daza As String = nza.Substring(0, 2)
                                lr_doc = y2za + m11za + daza
                            End If
                            'Dim lr_doc As String = y2za & "-" & m11za & "-" & daza
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            '......................................
                            Dim eway_doc As String
                            If ew_date <> "" Then
                                Dim nzaa As String = Replace(ew_date, ab, "")
                                Dim mzaa As String = nzaa.Remove(0, 2)
                                Dim y2zaa As String = mzaa.Remove(0, 2)
                                Dim m11zaa As String = mzaa.Substring(0, 2)
                                Dim dazaa As String = nzaa.Substring(0, 2)
                                eway_doc = y2zaa + m11zaa + dazaa
                            End If
                            'Dim lr_doc As String = y2zaa & "-" & m11zaa & "-" & dazaa
                            '......................................

                            If deli_status Then
                                cmd = New SQLiteCommand("update outer_sale set Bill_No= '" & TextBox2.Text & "',Client_Name='" & client_name.Text & "',salesman='" & salesman.Text & "',salesman_com='" & txt_com.Text & "',salesman_comp='" & comp.Text & "',Bill_date='" & bill_date.Text & "',Due_Days='" & due_days.Text & "',Due_Date='" & due_date.Text & "',PO_No='" & Box1.Text & "',PO_Date='" & podate & "',Ref_No='" & Box3.Text & "',Ref_Date='" & rf_date & "',quatation_no='" & Box5.Text & "',quatation_date='" & qu_date & "',Dispatch_Doc_No='" & Box7.Text & "',Dispatch_Date='" & dispa_date & "',Driver_Name='" & Box11.Text & "',Vehicle_No='" & Box12.Text & "',Destination='" & Box9.Text & "',Dispatch_Through='" & Box10.Text & "',Hamali='" & Box13.Text & "',Other='" & Box14.Text & "',Payment_Mode='" & payment & "',quantity ='" & txt_qty.Text & "',Free_Qty ='" & txt_free_qty.Text & "',Gross ='" & txt_gross.Text & "',inner_disc_val ='" & TextBox14.Text & "',outer_disc_rate= '" & TextBox18.Text & "',outer_disc_val ='" & TextBox17.Text & "', total_disc_val ='" & tot_disc & "', GST ='" & TextBox15.Text & "',Total ='" & TextBox16.Text & "',Rounding ='" & TextBox19.Text & "', Net_amount ='" & TextBox20.Text & "', doc_date='" & al & "', any_remark='" & txt_remark.Text & "',deli_status='Completed',payment_status='" & pay_status & "',due_doc_date='" & due_doc & "',user='" & user & "',docs_dates='" & docs_dates & "',tot_SGSTval='" & tot_SGSTval() & "',tot_CGSTval='" & tot_CGSTval() & "',tot_IGSTval='" & tot_IGSTval() & "',tot_CESSval='" & tot_CESSval() & "' where Bill_No='" & TextBox2.Text & "'", cn)
                            Else
                                cmd = New SQLiteCommand("update outer_sale set Bill_No= '" & TextBox2.Text & "',Client_Name='" & client_name.Text & "',salesman='" & salesman.Text & "',salesman_com='" & txt_com.Text & "',salesman_comp='" & comp.Text & "',Bill_date='" & bill_date.Text & "',Due_Days='" & due_days.Text & "',Due_Date='" & due_date.Text & "',PO_No='" & Box1.Text & "',PO_Date='" & podate & "',Ref_No='" & Box3.Text & "',Ref_Date='" & rf_date & "',quatation_no='" & Box5.Text & "',quatation_date='" & qu_date & "',Dispatch_Doc_No='" & Box7.Text & "',Dispatch_Date='" & dispa_date & "',Driver_Name='" & Box11.Text & "',Vehicle_No='" & Box12.Text & "',Destination='" & Box9.Text & "',Dispatch_Through='" & Box10.Text & "',Hamali='" & Box13.Text & "',Other='" & Box14.Text & "',Payment_Mode='" & payment & "',quantity ='" & txt_qty.Text & "',Free_Qty ='" & txt_free_qty.Text & "',Gross ='" & txt_gross.Text & "',inner_disc_val ='" & TextBox14.Text & "',outer_disc_rate= '" & TextBox18.Text & "',outer_disc_val ='" & TextBox17.Text & "', total_disc_val ='" & tot_disc & "', GST ='" & TextBox15.Text & "',Total ='" & TextBox16.Text & "',Rounding ='" & TextBox19.Text & "', Net_amount ='" & TextBox20.Text & "', doc_date='" & al & "', any_remark='" & txt_remark.Text & "',deli_status='Pending',payment_status='" & pay_status & "',due_doc_date='" & due_doc & "',user='" & user & "' ,docs_dates='" & docs_dates & "',lr_no='" & Box15.Text & "', lr_date='" & lrdate & "', lr_doc='" & lr_doc & "', weight='" & Box18.Text & "',eway_no='" & txt_eway_no.Text & "',eway_date='" & ew_date & "',eway_doc='" & eway_doc & "',fright_added= '" & fright & "'   ,tot_SGSTval='" & tot_SGSTval() & "',tot_CGSTval='" & tot_CGSTval() & "',tot_IGSTval='" & tot_IGSTval() & "',tot_CESSval='" & tot_CESSval() & "' where Bill_No='" & TextBox2.Text & "'", cn)
                            End If
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            cmd.ExecuteNonQuery()
                            LogDetails(Module1.User, "Update Sale No. " & TextBox2.Text & ". Amount " & lbl_old_amt.Text & " to " & TextBox20.Text & ".")
                            cmd.Dispose()
                            MsgBox("Successfully Updated", MsgBoxStyle.Information)
                            desable_cntrl()
                            pd2 = True
                        Catch ex As Exception
                            MsgBox(ex.Message)
                        Finally
                            If cn.State = ConnectionState.Open Then
                                cn.Close()
                            End If
                        End Try
                        dr3.Close()
                        cmd.Dispose()
                        Exit Sub
                    Else
                        Try
                            grid(dr3, client, bill_no, dates, assq)
                            Dim inn As Double
                            Dim out As Double
                            If TextBox14.Text = "" Then
                                inn = 0
                            Else
                                inn = TextBox14.Text
                            End If
                            If TextBox17.Text = "" Then
                                out = 0
                            Else
                                out = TextBox17.Text
                            End If
                            Dim podate As String = ""
                            Dim rf_date As String = ""
                            Dim qu_date As String = ""
                            Dim dispa_date As String = ""
                            Dim lrdate As String = ""
                            Dim ew_date As String = ""

                            If Box2.Visible Then
                                podate = Box2.Text
                            End If
                            If Box4.Visible Then
                                rf_date = Box4.Text
                            End If
                            If Box6.Visible Then
                                qu_date = Box6.Text
                            End If
                            If Box8.Visible Then
                                dispa_date = Box8.Text
                            End If
                            If Box16.Visible Then
                                lrdate = Box16.Text
                            End If
                            If eway_date.Visible Then
                                ew_date = eway_date.Text
                            End If
                            Dim ab As String = "/"
                            Dim n As String = Replace(bill_date.Text, ab, "")
                            Dim m As String = n.Remove(0, 2)
                            Dim y2 As String = m.Remove(0, 2)
                            Dim m11 As String = m.Substring(0, 2)
                            Dim da As String = n.Substring(0, 2)
                            Dim al As String = y2 + m11 + da
                            '.....................................
                            Dim nz As String = Replace(due_date.Text, ab, "")
                            Dim mz As String = nz.Remove(0, 2)
                            Dim y2z As String = mz.Remove(0, 2)
                            Dim m11z As String = mz.Substring(0, 2)
                            Dim daz As String = nz.Substring(0, 2)
                            Dim due_doc As String = y2z + m11z + daz
                            Dim docs_dates As String = y2z & "/" & m11z & "/" & daz
                            'MsgBox(docs_dates)
                            '...................................
                            Dim lr_doc As String = ""
                            If lrdate <> "" Then
                                Dim nza As String = Replace(lrdate, ab, "")
                                Dim mza As String = nza.Remove(0, 2)
                                Dim y2za As String = mza.Remove(0, 2)
                                Dim m11za As String = mza.Substring(0, 2)
                                Dim daza As String = nza.Substring(0, 2)
                                lr_doc = y2za + m11za + daza
                            End If
                            'Dim lr_doc As String = y2za & "-" & m11za & "-" & daza
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            'MsgBox()
                            '......................................
                            Dim eway_doc As String = ""
                            If ew_date <> "" Then
                                Dim nzaa As String = Replace(ew_date, ab, "")
                                Dim mzaa As String = nzaa.Remove(0, 2)
                                Dim y2zaa As String = mzaa.Remove(0, 2)
                                Dim m11zaa As String = mzaa.Substring(0, 2)
                                Dim dazaa As String = nzaa.Substring(0, 2)
                                eway_doc = y2zaa + m11zaa + dazaa

                                'Dim lr_doc As String = y2zaa & "-" & m11zaa & "-" & dazaa
                                '......................................
                            End If
                            Dim tot_disc As Double = Math.Round(inn + out, 2)
                            Dim fright As String
                            Dim sm As String = salesman.Text
                            Dim smc As Double = txt_com.Text
                            If add_less Then
                                fright = "To-Paid"
                            Else
                                fright = "Paid"
                            End If
                            Dim cmds As SQLiteCommand
                            Dim cmdp As SQLiteCommand
                            If deli_status Then
                                cmd = New SQLiteCommand("insert into outer_sale (Bill_No, client_name, bill_date, due_days, due_date, PO_No, PO_Date, Ref_No, Ref_Date, quatation_no, quatation_date, Dispatch_Doc_No, Dispatch_Date, Driver_Name, Vehicle_No, Destination, Dispatch_Through, Hamali, Other, Payment_Mode, quantity, free_qty, gross, inner_disc_val, outer_disc_rate, outer_disc_val, total_disc_val, GST, Total, Rounding, Net_amount, doc_date, any_remark, deli_status, payment_status, due_doc_date, user, docs_dates, lr_no, lr_date, lr_doc, weight, eway_no, eway_date, eway_doc, fright_added, tot_SGSTval, tot_CGSTval, tot_IGSTval, tot_CESSval, salesman, salesman_com,salesman_comp,profit_amt,profit_p) values ('" & TextBox2.Text & "','" & client_name.Text & "','" & bill_date.Text & "','" & due_days.Text & "','" & due_date.Text & "','" & Box1.Text & "','" & podate & "','" & Box3.Text & "','" & rf_date & "','" & Box5.Text & "','" & qu_date & "','" & Box7.Text & "','" & dispa_date & "','" & Box11.Text & "','" & Box12.Text & "','" & Box9.Text & "','" & Box10.Text & "','" & Box13.Text & "','" & Box14.Text & "','" & payment & "','" & txt_qty.Text & "','" & txt_free_qty.Text & "','" & txt_gross.Text & "','" & TextBox14.Text & "','" & TextBox18.Text & "','" & TextBox17.Text & "','" & tot_disc & "','" & TextBox15.Text & "','" & TextBox16.Text & "','" & TextBox19.Text & "','" & TextBox20.Text & "','" & al & "','" & txt_remark.Text & "','Completed','" & pay_status & "','" & due_doc & "','" & user & "','" & docs_dates & "','" & Box15.Text & "','" & lrdate & "','" & lr_doc & "','" & Box18.Text & "','" & txt_eway_no.Text & "','" & ew_date & "','" & eway_doc & "','" & fright & "','" & tot_SGSTval() & "','" & tot_CGSTval() & "','" & tot_IGSTval() & "','" & tot_CESSval() & "','" & salesman.Text & "','" & txt_com.Text & "','" & comp.Text & "','" & profitamt.Text & "','" & profitp.Text & "')", cn)

                                cmds = New SQLiteCommand("INSERT INTO salesman_ledger (Bill_No,party_name,bill_date,salesman_name,Debit_amount,Balance,salesman_com) values ('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & sm & "','" & TextBox20.Text & "','" & TextBox20.Text & "','" & smc & "')", cn)
                                cmdp = New SQLiteCommand("insert into profit (bill_no,party_name,invoice_date,invoice_amt,profit_amt,salesman)values('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & TextBox20.Text & "','" & profitamt.Text & "','" & sm & "')", cn)

                            Else
                                cmd = New SQLiteCommand("insert into outer_sale (Bill_No,Client_Name,Bill_date,Due_Days,Due_Date,PO_No,PO_Date,Ref_No,Ref_Date,quatation_no,quatation_date,Dispatch_Doc_No,Dispatch_Date,Driver_Name,Vehicle_No,Destination,Dispatch_Through,Hamali,Other,Payment_Mode,Quantity,Free_Qty,Gross,inner_disc_val,outer_disc_rate,outer_disc_val,total_disc_val,GST,Total,Rounding,Net_amount,doc_date,any_remark,deli_status,payment_status,due_doc_date,user,docs_dates,lr_no,lr_date,lr_doc,weight,eway_no,eway_date,eway_doc,fright_added,tot_SGSTval,tot_CGSTval,tot_IGSTval,tot_CESSval,salesman, salesman_com,salesman_comp,profit_amt,profit_p) values ('" & TextBox2.Text & "','" & client_name.Text & "','" & bill_date.Text & "','" & due_days.Text & "','" & due_date.Text & "','" & Box1.Text & "','" & podate & "','" & Box3.Text & "','" & rf_date & "','" & Box5.Text & "','" & qu_date & "','" & Box7.Text & "','" & dispa_date & "','" & Box11.Text & "','" & Box12.Text & "','" & Box9.Text & "','" & Box10.Text & "','" & Box13.Text & "','" & Box14.Text & "','" & payment & "','" & txt_qty.Text & "','" & txt_free_qty.Text & "','" & txt_gross.Text & "','" & TextBox14.Text & "','" & TextBox18.Text & "','" & TextBox17.Text & "','" & tot_disc & "','" & TextBox15.Text & "','" & TextBox16.Text & "','" & TextBox19.Text & "','" & TextBox20.Text & "','" & al & "','" & txt_remark.Text & "','Pending','" & pay_status & "','" & due_doc & "','" & user & "','" & docs_dates & "','" & Box15.Text & "','" & lrdate & "','" & lr_doc & "','" & Box18.Text & "','" & txt_eway_no.Text & "','" & ew_date & "','" & eway_doc & "','" & fright & "','" & tot_SGSTval() & "','" & tot_CGSTval() & "','" & tot_IGSTval() & "','" & tot_CESSval() & "','" & salesman.Text & "','" & txt_com.Text & "','" & comp.Text & "','" & profitamt.Text & "','" & profitp.Text & "')", cn)

                                cmds = New SQLiteCommand("INSERT INTO salesman_ledger (Bill_No,party_name,bill_date,salesman_name,Debit_amount,Balance,salesman_com) values ('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & sm & "','" & TextBox20.Text & "','" & TextBox20.Text & "','" & smc & "')", cn)

                                cmdp = New SQLiteCommand("insert into profit (bill_no,party_name,invoice_date,invoice_amt,profit_amt,salesman)values('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & TextBox20.Text & "','" & profitamt.Text & "','" & sm & "')", cn)

                            End If
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            cmd.ExecuteNonQuery()
                            cmds.ExecuteNonQuery()
                            cmdp.ExecuteNonQuery()


                            LogDetails(Module1.User, "Added Sale No. " & TextBox2.Text & ". Amount " & TextBox20.Text & ".")

                            cmd.Dispose()
                            '------------------------------------------------------------------
                            If deli_status Then
                                cmd = New SQLiteCommand("update outer_delivery_note set Status='Completed' where Bill_no='" & Box3.Text & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                            End If
                            '''''''''''''''''new party ledger record inserting......................................
                            Dim cm As SQLiteCommand
                            cm = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where party_name='" & client_name.Text & "' ", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter As New SQLiteDataAdapter(cm)
                            Dim table As New DataTable()
                            adapter.Fill(table)
                            Dim party_bal As Double
                            If table.Rows(0)(1).ToString() = "" Then
                                party_bal = 0
                            Else
                                party_bal = table.Rows(0)(1).ToString()
                            End If
                            Dim tot1 As Double = party_bal + TextBox20.Text
                            'MsgBox("k")
                            Dim source As String = "SALE"
                            Dim abs As String = "/"
                            Dim ns As String = Replace(bill_date.Text, abs, "")
                            Dim my As String = ns.Remove(0, 2)
                            Dim y As String = my.Remove(0, 2)
                            Dim mn As String = my.Substring(0, 2)
                            Dim day As String = ns.Substring(0, 2)
                            Dim all As String = y + mn + day
                            If credit.Checked = True Then
                                cmd = New SQLiteCommand("insert into party_ledger (Bill_No,party_name,bill_date,own_date,Source,Debit_amount,Balance,Status) values ('" & bill_no & "','" & client_name.Text & "','" & bill_date.Text & "','" & all & "','" & source & "','" & TextBox20.Text & "','" & tot1 & "','Pending')", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                'MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
                                cn.Close()
                            End If
                            '........................................end new party ledger record inserting.........................
                            ''''''''''''''...................'''new cash record inserting......................................
                            If cash.Checked = True Then
                                cmd = New SQLiteCommand("update cash_account set balance=balance+ '" & TextBox20.Text & "'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                cmd.ExecuteNonQuery()
                                cmd.Dispose()
                                cn.Close()
                            End If
                            '........................................end cash record inserting.........................
                            MsgBox("Sucessfully Saved", MsgBoxStyle.Information)
                            pd2 = True
                            desable_cntrl()
                        Catch ex As Exception
                            MsgBox(ex.Message)
                            dr3.Close()
                        Finally
                            If cn.State = ConnectionState.Open Then
                                cn.Close()
                            End If
                        End Try
                    End If
                End If
                dr3.Close()
            Catch ex As Exception
                MsgBox(ex.Message)
            End Try
            cn.Close()
        End If
        '..............................................................................................................................
        If sale_ledger.WindowState = FormWindowState.Minimized Or sale_ledger.WindowState = FormWindowState.Maximized Or sale_ledger.WindowState = FormWindowState.Normal Then
            'sale_ledger.sale_ledger_Load(e, e)
        End If
    End Sub
    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Module1.new_sale()
        'Me.Controls.Clear()
        'InitializeComponent()
        'New_Invoice_Load(e, e)
        ''Ref = True
        'client_name.Focus()
        'ok = False
        'test = False
        'ky = False
        'edit = False
        '......................
        ''reset_mode = True
        ''Me.Close()
        ''........................
        'Try
        '    For Each row As DataGridViewRow In DataGridView1.Rows
        '        DataGridView1.Rows.RemoveAt(0)
        '    Next
        'Catch ex As Exception
        'End Try
        'TextBox2.Text = ""
        'New_Invoice_Load(e, e)
        'client_name.Enabled = True
        'TextBox2.Enabled = True
        'TextBox20.Text = ""
        'TextBox19.Text = ""
        'Label24.Text = ""
        'Label13.Text = ""
        'Label11.Text = ""
        'due_days.Text = ""
        ''ComboBox9.Text = ""
        ''ComboBox8.Text = ""
        ''ComboBox7.Text = ""
        ''ComboBox6.Text = ""
        ''ComboBox5.Text = ""
        ''ComboBox4.Text = ""
        ''ComboBox3.Text = ""
        ''ComboBox2.Text = ""
        ''ComboBox1.Text = ""
        'client_name.Text = ""
        'Box9.Text = ""
        'Box7.Text = ""
        'Box5.Text = ""
        'Box3.Text = ""
        'Box12.Text = ""
        'Box11.Text = ""
        'Box10.Text = ""
        'Box1.Text = ""
        'TextBox18.Text = 0
        'TextBox17.Text = 0
        'TextBox16.Text = 0
        'TextBox15.Text = 0
        'TextBox14.Text = 0
        'TextBox13.Text = 0
        'TextBox12.Text = 0
        'TextBox11.Text = 0
        'Box14.Text = 0
        'Box13.Text = 0
        'Button5_Click(e, e)
        'edit = False
        'Button7.Enabled = True
        'Button4.Enabled = False
        'Button1.Enabled = False
        'btn_print.Enabled = False
        ''dt.Clear()
        ''da = New SQLiteDataAdapter("select * from inner_sale where Bill_No ='0' ", cn)
        ''da.Fill(dt)
        ''DataGridView1.DataSource = dt
        ''da.Dispose()
        '' DataGridView1.Refresh()
        'ComboBox9.Items.Clear()
        'ComboBox8.Items.Clear()
        'ComboBox7.Items.Clear()
        'ComboBox6.Items.Clear()
        'ComboBox5.Items.Clear()
        'ComboBox4.Items.Clear()
        'ComboBox3.Items.Clear()
        'ComboBox2.Items.Clear()
        'ComboBox1.Items.Clear()
        'ok = False
        'test = False
        'ky = False
        'edit = False
        'Try
        '    For Each row As DataGridViewRow In DataGridView1.Rows
        '        DataGridView1.Rows.RemoveAt(0)
        '    Next
        'Catch ex As Exception
        'End Try
        'DataGridView1.Refresh()
    End Sub
    Private Sub DataGridView1_CellLeave(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.CellLeave
        'End If
    End Sub
    Private Function Total() As Double
        Dim tot As Double = 0
        Dim i As Integer = 0
        For i = 0 To DataGridView1.Rows.Count - 1
            If IsDBNull(DataGridView1.Rows(i).Cells("TotAmount").Value) Then
                DataGridView1.Rows(i).Cells("TotAmount").Value = 0
            End If
            tot = tot + Convert.ToDouble(DataGridView1.Rows(i).Cells("TotAmount").Value)
        Next i
        Return tot
    End Function
    Private Function net() As Double
        Dim net_amt As Double = 0
        Dim i As Integer = 0
        For i = 0 To DataGridView1.Rows.Count - 1
            net_amt = net_amt + Convert.ToDouble(DataGridView1.Rows(i).Cells("TotAmount").Value)
        Next i
        Return net_amt
    End Function
    Private Function freeQtys() As Double
        Dim free_qty As Double = 0
        Dim i As Integer = 0
        For i = 0 To DataGridView1.Rows.Count - 1
            If IsDBNull(DataGridView1.Rows(i).Cells("FreeQty").Value) Then
                DataGridView1.Rows(i).Cells("FreeQty").Value = 0
            End If
            free_qty = free_qty + Convert.ToDouble(DataGridView1.Rows(i).Cells("FreeQty").Value)
        Next i
        'net_amt = Math.Round(net_amt, 2)
        'net_amt = Math.Round(net_amt, 0)
        'MsgBox(net_amt)
        Return free_qty
    End Function
    Private Function gross() As Double
        Dim gro As Double = 0
        Dim i As Integer = 0
        Try
            For i = 0 To DataGridView1.Rows.Count - 1
                gro = gro + Convert.ToDouble(DataGridView1.Rows(i).Cells("Amount").Value)
            Next i
        Catch ex As Exception
        End Try
        Return gro
    End Function
    Private Function quantity() As Double
        Dim qty As Double = 0
        Dim i As Integer = 0
        Try
            For i = 0 To DataGridView1.Rows.Count - 1
                qty = qty + Convert.ToDouble(DataGridView1.Rows(i).Cells("QTY").Value)
            Next i
        Catch ex As Exception
            Return 1
        End Try
        Return qty
    End Function
    Private Function disc() As Double
        Dim d As Double = 0
        Dim i As Integer = 0
        For i = 0 To DataGridView1.Rows.Count - 1
            d = d + Convert.ToDouble(DataGridView1.Rows(i).Cells("DiscValue").Value)
        Next i
        Return d
    End Function
    Private Function GST() As Double
        Dim tax As Double = 0
        Dim i As Integer = 0

        If IsDBNull(DataGridView1.Rows(i).Cells("SGSTVal").Value) Then
                DataGridView1.Rows(i).Cells("SGSTVal").Value = 0
            End If
            If IsDBNull(DataGridView1.Rows(i).Cells("CGSTVal").Value) Then
                DataGridView1.Rows(i).Cells("CGSTVal").Value = 0
            End If
            If IsDBNull(DataGridView1.Rows(i).Cells("CESSVal").Value) Then
                DataGridView1.Rows(i).Cells("CESSVal").Value = 0
            End If
            If IsDBNull(DataGridView1.Rows(i).Cells("IGSTVal").Value) Then
                DataGridView1.Rows(i).Cells("IGSTVal").Value = 0
            End If

        For i = 0 To DataGridView1.Rows.Count - 1
                tax = tax + Convert.ToDouble(DataGridView1.Rows(i).Cells("SGSTVal").Value) + Convert.ToDouble(DataGridView1.Rows(i).Cells("CGSTVal").Value) + Convert.ToDouble(DataGridView1.Rows(i).Cells("CESSVal").Value) + Convert.ToDouble(DataGridView1.Rows(i).Cells("IGSTVal").Value)
            Next i
        'GoTo st

st:
        Return Math.Round(tax, 2)
    End Function

    Private Function tot_SGSTval() As Double
        Dim tax As Double = 0
        Dim i As Integer = 0
        If IsDBNull(DataGridView1.Rows(i).Cells("SGSTVal").Value) Then
            DataGridView1.Rows(i).Cells("SGSTVal").Value = 0
        End If

        For i = 0 To DataGridView1.Rows.Count - 1
            tax = tax + Convert.ToDouble(DataGridView1.Rows(i).Cells("SGSTVal").Value)
        Next i
        Return Math.Round(tax, 2)
    End Function

    Private Function tot_CGSTval() As Double
        Dim tax As Double = 0
        Dim i As Integer = 0
        If IsDBNull(DataGridView1.Rows(i).Cells("CGSTVal").Value) Then
            DataGridView1.Rows(i).Cells("CGSTVal").Value = 0
        End If
        For i = 0 To DataGridView1.Rows.Count - 1
            tax = tax + Convert.ToDouble(DataGridView1.Rows(i).Cells("CGSTVal").Value)
        Next i
        Return Math.Round(tax, 2)
    End Function

    Private Function tot_IGSTval() As Double
        Dim tax As Double = 0
        Dim i As Integer = 0
        If IsDBNull(DataGridView1.Rows(i).Cells("IGSTVal").Value) Then
            DataGridView1.Rows(i).Cells("IGSTVal").Value = 0
        End If
        For i = 0 To DataGridView1.Rows.Count - 1
            tax = tax + Convert.ToDouble(DataGridView1.Rows(i).Cells("IGSTVal").Value)
        Next i
        Return Math.Round(tax, 2)
    End Function

    Private Function tot_CESSval() As Double
        Dim tax As Double = 0
        Dim i As Integer = 0
        If IsDBNull(DataGridView1.Rows(i).Cells("CESSVal").Value) Then
            DataGridView1.Rows(i).Cells("CESSVal").Value = 0
        End If
        For i = 0 To DataGridView1.Rows.Count - 1
            tax = tax + Convert.ToDouble(DataGridView1.Rows(i).Cells("CESSVal").Value)
        Next i
        Return Math.Round(tax, 2)
    End Function
    Function RemoveWhitespace(fullString As String) As String
        Return New String(fullString.Where(Function(x) Not Char.IsWhiteSpace(x)).ToArray())
    End Function

    Private Sub DataGridView1_CellEndEdit(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.CellEndEdit
        If client_name.Text = "" Then
            MsgBox("Please Select client first", MsgBoxStyle.Exclamation)
            Dim ind As Integer
            ind = DataGridView1.CurrentCell.RowIndex
            Try
                DataGridView1.Rows.RemoveAt(ind)
                'SendKeys.Send("{left}")
                'SendKeys.Send("{down}")
            Catch ex As Exception
            End Try
            'DataGridView1.CurrentCell = DataGridView1.Item("ProductName", ind)
            DataGridView1.ClearSelection()
            'DataGridView1.Rows(ind).Cells(3).Selected = True
            'DataGridView1.CurrentCell = DataGridView1(3, ind)
            'SendKeys.Send("{left}")
            'SendKeys.Send("{left}")
            'SendKeys.Send("{left}")
            'owntext.Focus()
            'DataGridView1.CurrentCell = DataGridView1(0, 0)
            'DataGridView1.CurrentCell.Selected = False
            Exit Sub
        Else
            If lbl_GSTINs <> "" Then
                client_GSTIN = lbl_GSTINs
            End If
        End If
        company.lbl_db_path.Text = "edit"
        company.company_Load(e, e)
        If company.c6.Text <> "" Then
            company_GSTIN = company.c6.Text
        End If
        'If company_GSTIN = client_GSTIN Then
        '    MsgBox("same GSTIN")
        'Else
        '    MsgBox("diff GSTIN")
        'End If
        Dim i As Integer
        i = DataGridView1.CurrentRow.Index
        If IsDBNull(DataGridView1.Item("ProductName", i).Value) Then
            DataGridView1.Item("ProductName", i).Value = " "
            remove_row = True
        End If
        If sender.columns(e.ColumnIndex).headercell.value = "Prod. ID" Then
            If Not IsDBNull(DataGridView1.Item("ProductID", i).Value) Then
                If Not DataGridView1.Item("ProductID", i).Value = "" Or Not DataGridView1.Item("ProductID", i).Value = " " Then
                    'MsgBox("hsn provide")
                    cmd = New SQLiteCommand("select * from product_details where Product_ID='" & DataGridView1.Item("ProductID", i).Value & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr3 = cmd.ExecuteReader()
                    If dr3.HasRows = False Then
                        dr3.Close()
                        MsgBox("Id not found")
                        Dim ind As Integer
                        ind = DataGridView1.CurrentCell.RowIndex
                        ok = True
                        Try
                            DataGridView1.Rows.RemoveAt(ind)
                        Catch ex As Exception
                        End Try
                        SendKeys.Send("{left}")
                        GoTo Init
                        Exit Sub
                    Else
                        dr3.Close()
                        Dim cm As SQLiteCommand
                        cm = New SQLiteCommand("select * from product_details where Product_ID='" & DataGridView1.Item("ProductID", i).Value & "'", cn)
                        If cn.State = ConnectionState.Closed Then
                            cn.Open()
                        End If
                        Dim adapter As New SQLiteDataAdapter(cm)
                        Dim table As New DataTable()
                        adapter.Fill(table)
                        DataGridView1.Item("ProductName", i).Value = table.Rows(0)(2).ToString()
                        DataGridView1.Item("ProductName", i).Value = table.Rows(0)(2).ToString()
                        DataGridView1.Item("Unit", i).Value = table.Rows(0)("unit").ToString()
                        Dim p_unit As String = DataGridView1.Item("Unit", i).Value.ToUpper
                        Dim disc_val As Double
                        Dim disc_rate As Double
                        Dim SGST_val As Double
                        Dim SGST_rate As Double
                        Dim CGST_val As Double
                        Dim CGST_rate As Double
                        Dim CESS_rate As Double
                        Dim CESS_val As Double
                        Dim IGST_rate As Double
                        Dim IGST_val As Double
                        If DataGridView1.Rows.Count > 2 Then
                            'MsgBox("call")
                            Dim ind As Integer
                            ind = DataGridView1.CurrentCell.RowIndex
                            Dim cnt As Integer = DataGridView1.Rows.Count - 3
                            Dim fr As Integer = -1
                            For t As Integer = 0 To cnt
                                If DataGridView1.Rows(t).Cells("ProductID").Value = DataGridView1.Item("ProductID", i).Value Then
                                    'MsgBox(p_unit)
                                    '..................................................................................
                                    'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
                                    '    DataGridView1.Rows(t).Cells("meters").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("meters").Value)
                                    'Else
                                    '    DataGridView1.Rows(t).Cells("QTY").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("QTY").Value)
                                    'End If
                                    'Dim InvoiceDetails1 As DataGridView = DirectCast(sender, DataGridView)
                                    'i = DataGridView1.CurrentRow.Index
                                    DataGridView1.Rows(t).Cells("QTY").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("QTY").Value)
                                    Dim qty As String
                                    'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
                                    '    qty = DataGridView1.Rows(t).Cells("meters").Value
                                    'Else
                                    '    qty = DataGridView1.Rows(t).Cells("QTY").Value
                                    'End If
                                    qty = DataGridView1.Rows(t).Cells("QTY").Value
                                    '..................................................................................
                                    Dim rate As String = DataGridView1.Rows(t).Cells("Rate").Value
                                    Dim disc_rate1 As String = DataGridView1.Rows(t).Cells("Discount").Value
                                    Dim disc_val1 As String = DataGridView1.Rows(t).Cells("DiscValue").Value
                                    Dim SGST_rate1 As Double
                                    Dim SGST_val1 As String
                                    Dim CGST_rate1 As Double
                                    Dim CESS_rate1 As Double
                                    Dim IGST_rate1 As Double
                                    If company_GSTIN = client_GSTIN Then
                                        SGST_rate1 = DataGridView1.Rows(t).Cells("SGST").Value
                                        CGST_rate1 = DataGridView1.Rows(t).Cells("CGST").Value
                                        IGST_rate1 = 0
                                    Else
                                        SGST_rate1 = 0
                                        CGST_rate1 = 0
                                        IGST_rate1 = DataGridView1.Rows(t).Cells("IGST").Value
                                    End If
                                    CESS_rate1 = DataGridView1.Rows(t).Cells("CESS").Value
                                    Dim after_disc1 As String
                                    If DiscValue.Visible = True And discount.Visible = False Then
                                        after_disc1 = qty * rate - disc_val1
                                        DataGridView1.Rows(t).Cells("DiscValue").Value = disc_val1
                                    Else
                                        after_disc1 = qty * rate - qty * rate / 100 * disc_rate1
                                        DataGridView1.Rows(t).Cells("DiscValue").Value = Math.Round(qty * rate / 100 * disc_rate1, 2)
                                    End If
                                    'Dim a As Double = qty * rate - qty * rate / 100 * disc_rate1 + qty * rate / 100 * SGST_rate1
                                    DataGridView1.Rows(t).Cells("Amount").Value = qty * rate
                                    If tax = "Inclusive" Then
                                        DataGridView1.Rows(t).Cells("TotAmount").Value = after_disc1
                                        Dim all As Double = after_disc1 * (SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1) / (100 + (SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1))
                                        Dim alltx As Double = SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1
                                        DataGridView1.Rows(t).Cells("Amount").Value = Math.Round(after_disc1 - all, 2)
                                        If SGST_rate1 > 0 Then
                                            DataGridView1.Rows(t).Cells("SGSTVal").Value = Math.Round((all * SGST_rate1 / alltx), 2)
                                            DataGridView1.Columns("IGST").Visible = False
                                            DataGridView1.Columns("IGSTVal").Visible = False
                                        End If
                                        If CGST_rate1 > 0 Then
                                            DataGridView1.Rows(t).Cells("CGSTVal").Value = Math.Round((all * CGST_rate1) / alltx, 2)
                                        End If
                                        If CESS_rate1 > 0 Then
                                            DataGridView1.Rows(t).Cells("CESSVal").Value = Math.Round((all * CESS_rate1) / alltx, 2)
                                        End If
                                        If IGST_rate1 > 0 Then
                                            DataGridView1.Rows(t).Cells("IGSTVal").Value = Math.Round((all * IGST_rate1) / alltx, 2)
                                        End If
                                    Else
                                        DataGridView1.Rows(t).Cells("TotAmount").Value = Math.Round(after_disc1 + after_disc1 / 100 * SGST_rate1 + after_disc1 / 100 * CGST_rate1 + after_disc1 / 100 * CESS_rate1 + after_disc1 / 100 * IGST_rate1, 2)
                                        If company_GSTIN = client_GSTIN Then
                                            DataGridView1.Rows(t).Cells("SGSTVal").Value = Math.Round(after_disc1 / 100 * SGST_rate1, 2)
                                            DataGridView1.Rows(t).Cells("CGSTVal").Value = Math.Round(after_disc1 / 100 * CGST_rate1, 2)
                                        Else
                                            DataGridView1.Rows(t).Cells("IGSTVal").Value = Math.Round(after_disc1 / 100 * IGST_rate1, 2)
                                            DataGridView1.Rows(t).Cells("SGSTVal").Value = 0
                                            DataGridView1.Rows(t).Cells("CGSTVal").Value = 0
                                        End If
                                    End If
                                    DataGridView1.Rows(t).Cells("CESSVal").Value = Math.Round(after_disc1 / 100 * CESS_rate1, 2)
                                    DataGridView1.Rows(t).Cells("DiscValue").Value = Math.Round(qty * rate / 100 * disc_rate1, 2)
                                    ok = True
                                    Try
                                        DataGridView1.Rows.RemoveAt(ind)
                                    Catch ex As Exception
                                    End Try
                                    SendKeys.Send("{down}")
                                    SendKeys.Send("{left}")
                                    GoTo Init
                                    Exit Sub
                                End If
                            Next t
                            'MsgBox(cnt)
                            'MsgBox(fr)
                        End If
                        Dim cm4 As SQLiteCommand
                        cm4 = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where products='" & DataGridView1.Item("ProductName", i).Value & "' ", cn)
                        If cn.State = ConnectionState.Closed Then
                            cn.Open()
                        End If
                        Dim adapter1 As New SQLiteDataAdapter(cm4)
                        Dim table1 As New DataTable()
                        adapter1.Fill(table1)
                        Dim bal_stk As Integer
                        If Not IsDBNull(table1.Rows(0)(1).ToString()) Then
                            If table1.Rows(0)(1).ToString() = "" Then
                                bal_stk = 0
                            Else
                                bal_stk = table1.Rows(0)(1).ToString()
                            End If
                        End If
                        DataGridView1.Item(5, i).Value = bal_stk
                        adapter1.Dispose()
                        table1.Dispose()
                        cm4.Dispose()
                        If bal_stk <= 0 Then
                            If al_stock = "No" Then
                                Dim ind As Integer
                                ind = DataGridView1.CurrentCell.RowIndex
                                Dim yn As Integer
                                yn = MsgBox("Out Of stock product.Did Still add it?", MsgBoxStyle.YesNo)
                                If yn = 6 Then
                                Else
                                    ok = True
                                    Try
                                        DataGridView1.Rows.RemoveAt(ind)
                                    Catch ex As Exception
                                    End Try
                                    SendKeys.Send("{down}")
                                    SendKeys.Send("{left}")
                                    GoTo Init
                                    Exit Sub
                                End If
                            End If
                        End If
                        'MsgBox(table.Rows(0)(6).ToString())
                        Dim enr_qty As Decimal = 1
                        DataGridView1.Item("HSN", i).Value = table.Rows(0)("HSN").ToString()
                        'MsgBox(p_unit)
                        DataGridView1.Item("QTY", i).Value = 1
                        'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
                        '    DataGridView1.Item("meters", i).Value = 1
                        'Else
                        '    DataGridView1.Item("QTY", i).Value = 1
                        'End If
                        'If (p_unit = "PCS" Or p_unit = "PC" Or p_unit = "PIECES" Or p_unit = "PIECE") Then
                        '    DataGridView1.Item("QTY", i).Value = 1
                        'Else
                        '    DataGridView1.Item("meters", i).Value = 1
                        'End If
                        DataGridView1.Item("ProductName", i).Value = table.Rows(0)("product_name").ToString()
                        DataGridView1.Item("Rate", i).Value = table.Rows(0)("sale_rate").ToString()
                        DataGridView1.Item("ProductID", i).Value = table.Rows(0)("Product_ID").ToString()
                        DataGridView1.Item("HSN", i).Value = table.Rows(0)("HSN").ToString()
                        DataGridView1.Item("MRP", i).Value = table.Rows(0)("MRP").ToString()
                        If discount.Visible = True Then
                            DataGridView1.Item("discount", i).Value = table.Rows(0)("discount_percent").ToString()
                            disc_rate = table.Rows(0)("discount_percent").ToString()
                        Else
                            DataGridView1.Item("discount", i).Value = 0
                            disc_rate = 0
                        End If
                        'MsgBox
                        If company_GSTIN = client_GSTIN Then
                            If SGST.Visible = True Then
                                DataGridView1.Item("SGST", i).Value = table.Rows(0)("SGST").ToString()
                                SGST_rate = table.Rows(0)("SGST").ToString()
                            Else
                                DataGridView1.Item("SGST", i).Value = 0
                                SGST_rate = 0
                            End If
                            If CGST.Visible = True Then
                                DataGridView1.Item("CGST", i).Value = table.Rows(0)("CGST").ToString()
                                CGST_rate = table.Rows(0)("CGST").ToString()
                            Else
                                DataGridView1.Item("CGST", i).Value = 0
                                CGST_rate = 0
                            End If
                            IGST_rate = 0
                            DataGridView1.Item("IGST", i).Value = 0
                        Else
                            CGST_rate = 0
                            DataGridView1.Item("CGST", i).Value = 0
                            DataGridView1.Item("SGST", i).Value = 0
                            SGST_rate = 0
                            If IGST.Visible Then
                                DataGridView1.Item("IGST", i).Value = table.Rows(0)("IGST").ToString()
                                IGST_rate = table.Rows(0)("IGST").ToString()
                            Else
                                DataGridView1.Item("IGST", i).Value = 0
                                IGST_rate = 0
                            End If
                        End If
                        If CESS.Visible = True Then
                            DataGridView1.Item("CESS", i).Value = table.Rows(0)("CESS").ToString()
                            CESS_rate = table.Rows(0)("CESS").ToString()
                        Else
                            DataGridView1.Item("CESS", i).Value = 0
                            CESS_rate = 0
                        End If
                        Dim after_disc As Double
                        DataGridView1.Item("Amount", i).Value = 1 * table.Rows(0)("sale_rate").ToString()
                        If DiscValue.Visible = True Then
                            DataGridView1.Item("DiscValue", i).Value = Math.Round(1 * table.Rows(0)("sale_rate").ToString() / 100 * table.Rows(0)("discount_percent").ToString(), 2)
                            after_disc = 1 * table.Rows(0)("sale_rate").ToString() - DataGridView1.Item("DiscValue", i).Value
                            disc_val = DataGridView1.Item("discount", i).Value
                            If company_GSTIN = client_GSTIN Then
                                DataGridView1.Item("SGSTVal", i).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                            Else
                                DataGridView1.Item("SGSTVal", i).Value = 0
                            End If
                        Else
                            after_disc = 1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate
                            'MsgBox(after_disc)
                            DataGridView1.Item("DiscValue", i).Value = 0
                            disc_val = 0
                        End If
                        'MsgBox(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate)
                        If SGSTVal.Visible = True Then
                            If company_GSTIN = client_GSTIN Then
                                DataGridView1.Item("SGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("SGST").ToString(), 2)
                                SGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("SGST").ToString(), 2)
                            Else
                                DataGridView1.Item("SGSTVal", i).Value = 0
                                SGST_val = 0
                            End If
                        Else
                            DataGridView1.Item("SGSTVal", i).Value = 0
                            SGST_val = 0
                        End If
                        If CGSTVal.Visible = True Then
                            If company_GSTIN = client_GSTIN Then
                                DataGridView1.Item("CGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CGST").ToString(), 2)
                                CGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CGST").ToString(), 2)
                            Else
                                DataGridView1.Item("CGSTVal", i).Value = 0
                                CGST_val = 0
                            End If
                            '....................................................................................
                            If CESSVal.Visible = True Then
                                DataGridView1.Item("CESSVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CESS").ToString(), 2)
                                CESS_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CESS").ToString(), 2)
                            Else
                                DataGridView1.Item("CESSVal", i).Value = 0
                                CESS_val = 0
                            End If
                            DataGridView1.Item("CESSVal", i).Value = 0
                            CESS_val = 0
                        End If
                        'DataGridView1.Item("IGST", i).Value.Value = IGST_rate
                        'DataGridView1.Item("IGSTVal", i).Value = 0
                        If IGSTVal.Visible = True Then
                            If company_GSTIN <> client_GSTIN Then
                                DataGridView1.Item("IGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("IGST").ToString(), 2)
                                IGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("IGST").ToString(), 2)
                            Else
                                DataGridView1.Item("IGSTVal", i).Value = 0
                                IGST_val = 0
                            End If
                        Else
                            DataGridView1.Item("IGSTVal", i).Value = 0
                            IGST_val = 0
                        End If
                        'MsgBox(CESS_rate)
                        If tax = "Inclusive" Then
                            DataGridView1.Item("TotAmount", i).Value = Math.Round(after_disc, 2)
                            Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                            Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                            DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                            If company_GSTIN = client_GSTIN Then
                                If SGST_rate > 0 Then
                                    DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                                End If
                                If CGST_rate > 0 Then
                                    DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                                End If
                            End If
                            If CESS_rate > 0 Then
                                DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                            End If
                            If company_GSTIN <> client_GSTIN Then
                                If IGST_rate > 0 Then
                                    DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                                End If
                            End If
                        Else
                            'DataGridView1.Item("TotAmount", i).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate, 2)
                            DataGridView1.Item("TotAmount", i).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                        End If
                        If IGST_rate = 0 Then
                            DataGridView1.Item("IGSTVal", i).Value = 0
                        End If
                        assign()
                        adapter.Dispose()
                        table.Dispose()
                        'c3.Text = table.Rows(0)(3).ToString()
                        cm.Dispose()
                        'Catch ex As Exception
                        '    MsgBox(ex.Message)
                        'Finally
                        If cn.State = ConnectionState.Open Then
                            cn.Close()
                        End If
                    End If
                Else
                    Exit Sub
                End If
            Else
                Exit Sub
            End If
        End If
        If sender.columns(e.ColumnIndex).headercell.value = "Product Name" Then
            col_name = True
        Else
            col_name = False
        End If
        If IsDBNull(DataGridView1.Item("ProductName", i).Value) And DataGridView1.Rows.Count = 1 And sender.columns(e.ColumnIndex).headercell.value <> "Bill_No" And sender.columns(e.ColumnIndex).headercell.value <> "Sr" And sender.columns(e.ColumnIndex).headercell.value <> "Prod. ID" Then
            flag_cell_edited = True
            currentColumn = e.ColumnIndex
            currentRow = e.RowIndex
            Me.SelectNextControl(DataGridView1, True, True, True, True)
        Else

            If IsDBNull(DataGridView1.Item("ProductName", i).Value) Then
                If sender.columns(e.ColumnIndex).headercell.value = "Product Name" Then
                    If IsDBNull(DataGridView1.Item("ProductName", i).Value) And DataGridView1.Rows.Count - 1 Then

                        flag_cell_edited = True
                        currentColumn = e.ColumnIndex
                        currentRow = e.RowIndex
                        Me.SelectNextControl(DataGridView1, True, True, True, True)
                    Else
                        MsgBox("please enter product name")
                        flag_cell_edited = True
                        currentColumn = e.ColumnIndex
                        currentRow = e.RowIndex
                        SendKeys.Send("{left}")
                    End If
                End If
            Else
                Try
                    If DataGridView1.Item("ProductName", i).Value = "" Or DataGridView1.Item("ProductName", i).Value = " " Or DataGridView1.Item("ProductName", i).Value = "  " Then
                        Dim ind As Integer
                        ind = DataGridView1.CurrentCell.RowIndex
                        ' MsgBox(ind)
                        DataGridView1.Rows.RemoveAt(ind)
                        SendKeys.Send("{left}")
                        SendKeys.Send("{down}")
                        GoTo Init
                        Exit Sub
                    End If
                Catch ex As System.InvalidOperationException
                End Try
                Try
                    cmd = New SQLiteCommand("select * from product_details where product_name Like '%" & DataGridView1.Item("ProductName", i).Value & "%' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    dr3 = cmd.ExecuteReader()
                    If dr3.HasRows = False Then
                        dr3.Close()
                        If remove_row Then
                            remove_row = False
                            Dim ind As Integer
                            ind = DataGridView1.CurrentCell.RowIndex
                            DataGridView1.Rows.RemoveAt(ind)
                            SendKeys.Send("{left}")
                            SendKeys.Send("{down}")
                            cmd.Dispose()
                            GoTo Init
                            Exit Sub
                        Else
                            If DataGridView1.Item("ProductName", i).Value = " " Then
                                Dim ind As Integer
                                ind = DataGridView1.CurrentCell.RowIndex
                                DataGridView1.Rows.RemoveAt(ind)
                                SendKeys.Send("{left}")
                                SendKeys.Send("{down}")
                                'dr3.Close()
                                cmd.Dispose()
                                GoTo Init
                                Exit Sub
                            Else
                                Dim someStr As String = "Product not found: " & DataGridView1.Item("ProductName", i).Value
                                Dim ind As Integer
                                ind = DataGridView1.CurrentCell.RowIndex
                                'MsgBox(ind)
                                ok = True
                                MsgBox(someStr)
                                products.Box1.Text = DataGridView1.Item("ProductName", i).Value
                                dr3.Close()
                                DataGridView1.Rows.RemoveAt(ind)
                                SendKeys.Send("{left}")
                                SendKeys.Send("{down}")
                                nofound = True
                                products.pro = True
                                save = True
                                Home.pro = True
                                Home.Panel1.Visible = False
                                products.MdiParent = Me.MdiParent
                                If products.WindowState = FormWindowState.Minimized Then
                                    products.WindowState = FormWindowState.Normal
                                End If
                                products.Show()
                                products.BringToFront()
                                'dr3.Close()
                                cmd.Dispose()
                                GoTo Init
                                'If table1.Rows(0)(1).ToString() = "" Then
                                'End If
                            End If
                            dr3.Close()
                            cmd.Dispose()
                        End If
                        dr3.Close()
                        cmd.Dispose()
                        GoTo Init
                        'Me.Close()
                        Exit Sub
                        flag_cell_edited = True
                        currentColumn = e.ColumnIndex
                        currentRow = e.RowIndex
                        test = True
                        ''DataGridView1.BeginEdit(True)
                    Else
                        Try
                            Dim count_row As Integer = DataGridView1.RowCount - 1
                            Dim a As String = DataGridView1.Item("ProductName", currentRow).Value
                            If sender.columns(e.ColumnIndex).headercell.value = "Product Name" And a <> "" Then
                                Dim cm As SQLiteCommand
                                cm = New SQLiteCommand("select * from product_details where product_name Like '%" & DataGridView1.Item("ProductName", i).Value & "%'", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter As New SQLiteDataAdapter(cm)
                                Dim table As New DataTable()
                                adapter.Fill(table)
                                DataGridView1.Item("ProductName", i).Value = table.Rows(0)(2).ToString()
                                DataGridView1.Item("ProductName", i).Value = table.Rows(0)(2).ToString()
                                DataGridView1.Item("Unit", i).Value = table.Rows(0)("unit").ToString()
                                Dim p_unit As String = DataGridView1.Item("Unit", i).Value.ToUpper
                                Dim disc_val As Double
                                Dim disc_rate As Double
                                Dim SGST_val As Double
                                Dim SGST_rate As Double
                                Dim CGST_val As Double
                                Dim CGST_rate As Double
                                Dim CESS_rate As Double
                                Dim CESS_val As Double
                                Dim IGST_rate As Double
                                Dim IGST_val As Double
                                If DataGridView1.Rows.Count > 2 Then
                                    'MsgBox("call")
                                    Dim ind As Integer
                                    ind = DataGridView1.CurrentCell.RowIndex
                                    Dim cnt As Integer = DataGridView1.Rows.Count - 3
                                    Dim fr As Integer = -1
                                    For t As Integer = 0 To cnt
                                        If DataGridView1.Rows(t).Cells("ProductName").Value = DataGridView1.Item("ProductName", i).Value Then
                                            'MsgBox(p_unit)
                                            '..................................................................................
                                            'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
                                            '    DataGridView1.Rows(t).Cells("meters").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("meters").Value)
                                            'Else
                                            '    DataGridView1.Rows(t).Cells("QTY").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("QTY").Value)
                                            'End If
                                            'Dim InvoiceDetails1 As DataGridView = DirectCast(sender, DataGridView)
                                            'i = DataGridView1.CurrentRow.Index
                                            DataGridView1.Rows(t).Cells("QTY").Value = Convert.ToString(1 + DataGridView1.Rows(t).Cells("QTY").Value)
                                            Dim qty As String
                                            'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
                                            '    qty = DataGridView1.Rows(t).Cells("meters").Value
                                            'Else
                                            '    qty = DataGridView1.Rows(t).Cells("QTY").Value
                                            'End If
                                            qty = DataGridView1.Rows(t).Cells("QTY").Value
                                            '..................................................................................
                                            Dim rate As String = DataGridView1.Rows(t).Cells("Rate").Value
                                            Dim disc_rate1 As String = DataGridView1.Rows(t).Cells("Discount").Value
                                            Dim disc_val1 As String = DataGridView1.Rows(t).Cells("DiscValue").Value
                                            Dim SGST_rate1 As Double
                                            Dim SGST_val1 As String
                                            Dim CGST_rate1 As Double
                                            Dim CESS_rate1 As Double
                                            Dim IGST_rate1 As Double
                                            If company_GSTIN = client_GSTIN Then
                                                SGST_rate1 = DataGridView1.Rows(t).Cells("SGST").Value
                                                CGST_rate1 = DataGridView1.Rows(t).Cells("CGST").Value
                                                IGST_rate1 = 0
                                            Else
                                                SGST_rate1 = 0
                                                CGST_rate1 = 0
                                                IGST_rate1 = DataGridView1.Rows(t).Cells("IGST").Value
                                            End If
                                            CESS_rate1 = DataGridView1.Rows(t).Cells("CESS").Value
                                            Dim after_disc1 As String
                                            If DiscValue.Visible = True And discount.Visible = False Then
                                                after_disc1 = qty * rate - disc_val1
                                                DataGridView1.Rows(t).Cells("DiscValue").Value = disc_val1
                                            Else
                                                after_disc1 = qty * rate - qty * rate / 100 * disc_rate1
                                                DataGridView1.Rows(t).Cells("DiscValue").Value = Math.Round(qty * rate / 100 * disc_rate1, 2)
                                            End If
                                            'Dim a As Double = qty * rate - qty * rate / 100 * disc_rate1 + qty * rate / 100 * SGST_rate1
                                            DataGridView1.Rows(t).Cells("Amount").Value = qty * rate
                                            If tax = "Inclusive" Then
                                                DataGridView1.Rows(t).Cells("TotAmount").Value = after_disc1
                                                Dim all As Double = after_disc1 * (SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1) / (100 + (SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1))
                                                Dim alltx As Double = SGST_rate1 + CGST_rate1 + CESS_rate1 + IGST_rate1
                                                DataGridView1.Rows(t).Cells("Amount").Value = Math.Round(after_disc1 - all, 2)
                                                If SGST_rate1 > 0 Then
                                                    DataGridView1.Rows(t).Cells("SGSTVal").Value = Math.Round((all * SGST_rate1 / alltx), 2)
                                                End If
                                                If CGST_rate1 > 0 Then
                                                    DataGridView1.Rows(t).Cells("CGSTVal").Value = Math.Round((all * CGST_rate1) / alltx, 2)
                                                End If
                                                If CESS_rate1 > 0 Then
                                                    DataGridView1.Rows(t).Cells("CESSVal").Value = Math.Round((all * CESS_rate1) / alltx, 2)
                                                End If
                                                If IGST_rate1 > 0 Then
                                                    DataGridView1.Rows(t).Cells("IGSTVal").Value = Math.Round((all * IGST_rate1) / alltx, 2)
                                                End If
                                            Else
                                                DataGridView1.Rows(t).Cells("TotAmount").Value = Math.Round(after_disc1 + after_disc1 / 100 * SGST_rate1 + after_disc1 / 100 * CGST_rate1 + after_disc1 / 100 * CESS_rate1 + after_disc1 / 100 * IGST_rate1, 2)
                                                If company_GSTIN = client_GSTIN Then
                                                    DataGridView1.Rows(t).Cells("SGSTVal").Value = Math.Round(after_disc1 / 100 * SGST_rate1, 2)
                                                    DataGridView1.Rows(t).Cells("CGSTVal").Value = Math.Round(after_disc1 / 100 * CGST_rate1, 2)
                                                Else
                                                    DataGridView1.Rows(t).Cells("IGSTVal").Value = Math.Round(after_disc1 / 100 * IGST_rate1, 2)
                                                    DataGridView1.Rows(t).Cells("SGSTVal").Value = 0
                                                    DataGridView1.Rows(t).Cells("CGSTVal").Value = 0
                                                End If
                                            End If
                                            DataGridView1.Rows(t).Cells("CESSVal").Value = Math.Round(after_disc1 / 100 * CESS_rate1, 2)
                                            DataGridView1.Rows(t).Cells("DiscValue").Value = Math.Round(qty * rate / 100 * disc_rate1, 2)
                                            ok = True
                                            Try
                                                DataGridView1.Rows.RemoveAt(ind)
                                            Catch ex As Exception
                                            End Try
                                            SendKeys.Send("{down}")
                                            SendKeys.Send("{left}")
                                            GoTo Init
                                            Exit Sub
                                        End If
                                    Next t

                                End If
                                Dim cm4 As SQLiteCommand
                                cm4 = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where products='" & DataGridView1.Item("ProductName", i).Value & "' ", cn)
                                If cn.State = ConnectionState.Closed Then
                                    cn.Open()
                                End If
                                Dim adapter1 As New SQLiteDataAdapter(cm4)
                                Dim table1 As New DataTable()
                                adapter1.Fill(table1)
                                Dim bal_stk As Integer
                                If Not IsDBNull(table1.Rows(0)(1).ToString()) Then
                                    If table1.Rows(0)(1).ToString() = "" Then
                                        bal_stk = 0
                                    Else
                                        bal_stk = table1.Rows(0)(1).ToString()
                                    End If
                                End If
                                DataGridView1.Item(5, i).Value = bal_stk
                                adapter1.Dispose()
                                table1.Dispose()
                                cm4.Dispose()
                                If bal_stk <= 0 Then
                                    If al_stock = "No" Then
                                        Dim ind As Integer
                                        ind = DataGridView1.CurrentCell.RowIndex
                                        Dim yn As Integer
                                        yn = MsgBox("Out Of stock product.Did Still add it?", MsgBoxStyle.YesNo)
                                        If yn = 6 Then
                                        Else
                                            ok = True
                                            Try
                                                DataGridView1.Rows.RemoveAt(ind)
                                            Catch ex As Exception
                                            End Try
                                            SendKeys.Send("{down}")
                                            SendKeys.Send("{left}")
                                            GoTo Init
                                            Exit Sub
                                        End If
                                    End If
                                End If
                                Dim enr_qty As Decimal = 1
                                DataGridView1.Item("HSN", i).Value = table.Rows(0)("HSN").ToString()
                                DataGridView1.Item("QTY", i).Value = 1

                                DataGridView1.Item("ProductName", i).Value = table.Rows(0)("product_name").ToString()
                                DataGridView1.Item("Rate", i).Value = table.Rows(0)("sale_rate").ToString()
                                DataGridView1.Item("ProductID", i).Value = table.Rows(0)("Product_ID").ToString()
                                DataGridView1.Item("HSN", i).Value = table.Rows(0)("HSN").ToString()
                                DataGridView1.Item("MRP", i).Value = table.Rows(0)("MRP").ToString()
                                If discount.Visible = True Then
                                    DataGridView1.Item("discount", i).Value = table.Rows(0)("discount_percent").ToString()
                                    disc_rate = table.Rows(0)("discount_percent").ToString()
                                Else
                                    DataGridView1.Item("discount", i).Value = 0
                                    disc_rate = 0
                                End If
                                'MsgBox
                                If company_GSTIN = client_GSTIN Then
                                    If SGST.Visible = True Then
                                        DataGridView1.Item("SGST", i).Value = table.Rows(0)("SGST").ToString()
                                        SGST_rate = table.Rows(0)("SGST").ToString()
                                    Else
                                        DataGridView1.Item("SGST", i).Value = 0
                                        SGST_rate = 0
                                    End If
                                    If CGST.Visible = True Then
                                        DataGridView1.Item("CGST", i).Value = table.Rows(0)("CGST").ToString()
                                        CGST_rate = table.Rows(0)("CGST").ToString()
                                    Else
                                        DataGridView1.Item("CGST", i).Value = 0
                                        CGST_rate = 0
                                    End If
                                    IGST_rate = 0
                                    DataGridView1.Item("IGST", i).Value = 0
                                Else
                                    CGST_rate = 0
                                    DataGridView1.Item("CGST", i).Value = 0
                                    DataGridView1.Item("SGST", i).Value = 0
                                    SGST_rate = 0
                                    If IGST.Visible Then
                                        DataGridView1.Item("IGST", i).Value = table.Rows(0)("IGST").ToString()
                                        IGST_rate = table.Rows(0)("IGST").ToString()
                                    Else
                                        DataGridView1.Item("IGST", i).Value = 0
                                        IGST_rate = 0
                                    End If

                                End If
                                If CESS.Visible = True Then
                                    DataGridView1.Item("CESS", i).Value = table.Rows(0)("CESS").ToString()
                                    CESS_rate = table.Rows(0)("CESS").ToString()
                                Else
                                    DataGridView1.Item("CESS", i).Value = 0
                                    CESS_rate = 0
                                End If
                                Dim after_disc As Double
                                DataGridView1.Item("Amount", i).Value = 1 * table.Rows(0)("sale_rate").ToString()
                                If DiscValue.Visible = True Then
                                    DataGridView1.Item("DiscValue", i).Value = Math.Round(1 * table.Rows(0)("sale_rate").ToString() / 100 * table.Rows(0)("discount_percent").ToString(), 2)
                                    after_disc = 1 * table.Rows(0)("sale_rate").ToString() - DataGridView1.Item("DiscValue", i).Value
                                    disc_val = DataGridView1.Item("discount", i).Value
                                    If company_GSTIN = client_GSTIN Then
                                        DataGridView1.Item("SGSTVal", i).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                                    Else
                                        DataGridView1.Item("SGSTVal", i).Value = 0
                                    End If
                                Else
                                    after_disc = 1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate
                                    'MsgBox(after_disc)
                                    DataGridView1.Item("DiscValue", i).Value = 0
                                    disc_val = 0
                                End If
                                'MsgBox(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate)
                                If SGSTVal.Visible = True Then
                                    If company_GSTIN = client_GSTIN Then
                                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("SGST").ToString(), 2)
                                        SGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("SGST").ToString(), 2)
                                    Else
                                        DataGridView1.Item("SGSTVal", i).Value = 0
                                        SGST_val = 0
                                    End If
                                Else
                                    DataGridView1.Item("SGSTVal", i).Value = 0
                                    SGST_val = 0
                                End If
                                If CGSTVal.Visible = True Then
                                    If company_GSTIN = client_GSTIN Then
                                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CGST").ToString(), 2)
                                        CGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CGST").ToString(), 2)
                                    Else
                                        DataGridView1.Item("CGSTVal", i).Value = 0
                                        CGST_val = 0
                                    End If
                                    '....................................................................................
                                    If CESSVal.Visible = True Then
                                        DataGridView1.Item("CESSVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CESS").ToString(), 2)
                                        CESS_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("CESS").ToString(), 2)
                                    Else
                                        DataGridView1.Item("CESSVal", i).Value = 0
                                        CESS_val = 0
                                    End If
                                    DataGridView1.Item("CESSVal", i).Value = 0
                                    CESS_val = 0
                                End If
                                If IGSTVal.Visible = True Then
                                    If company_GSTIN <> client_GSTIN Then
                                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("IGST").ToString(), 2)
                                        IGST_val = Math.Round((1 * table.Rows(0)("sale_rate").ToString() - 1 * table.Rows(0)("sale_rate").ToString() / 100 * disc_rate) / 100 * table.Rows(0)("IGST").ToString(), 2)
                                    Else
                                        DataGridView1.Item("IGSTVal", i).Value = 0
                                        IGST_val = 0
                                    End If
                                Else
                                    DataGridView1.Item("IGSTVal", i).Value = 0
                                    IGST_val = 0
                                End If
                                If tax = "Inclusive" Then
                                    DataGridView1.Item("TotAmount", i).Value = Math.Round(after_disc, 2)
                                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                                    If company_GSTIN = client_GSTIN Then
                                        If SGST_rate > 0 Then
                                            DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                                        End If
                                        If CGST_rate > 0 Then
                                            DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                                        End If
                                    End If
                                    If CESS_rate > 0 Then
                                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                                    End If
                                    If company_GSTIN <> client_GSTIN Then
                                        If IGST_rate > 0 Then
                                            DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                                        End If
                                    End If
                                Else
                                    DataGridView1.Item("TotAmount", i).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                                End If
                                If IGST_rate = 0 Then
                                    DataGridView1.Item("IGSTVal", i).Value = 0
                                End If
                                assign()
                                adapter.Dispose()
                                table.Dispose()
                                'c3.Text = table.Rows(0)(3).ToString()
                                cm.Dispose()
                                'Catch ex As Exception
                                '    MsgBox(ex.Message)
                                'Finally
                                If cn.State = ConnectionState.Open Then
                                    cn.Close()
                                End If
                                'End Try
                            End If
                        Catch ex As Exception
                            MsgBox(ex.Message)
                        Finally
                            If cn.State = ConnectionState.Open Then
                                cn.Close()
                            End If
                        End Try
                        'dr3.Close()
                        cmd.Dispose()
                    End If
                    'dr3.Close()
                    cmd.Dispose()
                Finally
                End Try
            End If
        End If
        '.....................................................................................................................................
outer:
        flag_cell_edited = True
        currentColumn = e.ColumnIndex
        currentRow = e.RowIndex
        'Dim i As Integer
        Dim InvoiceDetails As DataGridView = DirectCast(sender, DataGridView)
        i = DataGridView1.CurrentRow.Index
        If Not IsDBNull(DataGridView1.Item("ProductName", i).Value) And Not IsDBNull(DataGridView1.Item("Rate", i).Value) And Not IsDBNull(DataGridView1.Item("QTY", i).Value) Then
            If IsDBNull(DataGridView1.Item("QTY", i).Value) Then
                DataGridView1.Item("QTY", i).Value = 1
            End If
            'DataGridView1.Item("QTY", i).Value = 1
            If IsDBNull(DataGridView1.Item("discount", i).Value) Then
                DataGridView1.Item("discount", i).Value = 0
            End If
            'If DataGridView1.Item("discount", i).Value = " " Then
            '    DataGridView1.Item("discount", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("DiscValue", i).Value) Then
                DataGridView1.Item("DiscValue", i).Value = 0
            End If
            'If DataGridView1.Item("DiscValue", i).Value = "" Then
            '        DataGridView1.Item("DiscValue", i).Value = 0
            '    End If
            Dim p_unit As String = InvoiceDetails("Unit", e.RowIndex).Value.ToUpper
            Dim qty As String
            qty = InvoiceDetails("QTY", e.RowIndex).Value
            'If (p_unit = "MTRS" Or p_unit = "MTR" Or p_unit = "METER" Or p_unit = "METERS") Then
            '    qty = InvoiceDetails("meters", e.RowIndex).Value
            'Else
            '    qty = InvoiceDetails("QTY", e.RowIndex).Value
            'End If
            Dim rate As String = InvoiceDetails("Rate", e.RowIndex).Value
            Dim disc_rate As String = InvoiceDetails("Discount", e.RowIndex).Value
            Dim disc_val As String = InvoiceDetails("DiscValue", e.RowIndex).Value
            Dim SGST_rate As Double
            Dim SGST_val As String
            Dim CGST_rate As Double
            Dim CESS_rate As Double
            Dim IGST_rate As Double
            If IsDBNull(DataGridView1.Item("SGST", i).Value) Then
                SGST_rate = 0
                DataGridView1.Item("SGST", i).Value = 0
            End If
            'If DataGridView1.Item("SGST", i).Value = " " Then
            '    SGST_rate = 0
            '    DataGridView1.Item("SGST", i).Value = 0
            'End If
            'Dim a As String = " "
            If IsDBNull(DataGridView1.Item("SGSTVal", i).Value) Then
                'MsgBox("no valueqqqqqq")
                SGST_val = 0
                DataGridView1.Item("SGSTVal", i).Value = 0
            End If
            'If DataGridView1.Item("SGSTVal", i).Value = " " Then
            '    SGST_val = 0
            '    DataGridView1.Item("SGSTVal", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("CGST", i).Value) Then
                DataGridView1.Item("CGST", i).Value = 0
            End If
            'If DataGridView1.Item("CGST", i).Value = " " Then
            '    DataGridView1.Item("CGST", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("CGSTVal", i).Value) Then
                DataGridView1.Item("CGSTVal", i).Value = 0
            End If
            'MsgBox(DataGridView1.Item("CGSTVal", i).Value)
            'If DataGridView1.Item("CGSTVal", i).Value = " " Then
            '    DataGridView1.Item("CGSTVal", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("CESS", i).Value) Then
                DataGridView1.Item("CESS", i).Value = 0
            End If
            'If DataGridView1.Item("CESS", i).Value = " " Then
            '    DataGridView1.Item("CESS", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("CESSVal", i).Value) Then
                DataGridView1.Item("CESSVal", i).Value = 0
            End If
            'If DataGridView1.Item("CESSVal", i).Value = " " Then
            '    DataGridView1.Item("CESSVal", i).Value = 0
            'End If
            'If IsDBNull(DataGridView1.Item("IGST", i).Value.Value) Then
            '    DataGridView1.Item("IGST", i).Value.Value = 0
            'End If
            'If DataGridView1.Item("IGST", i).Value.Value = " " Then
            '    DataGridView1.Item("IGST", i).Value.Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("IGSTVal", i).Value) Then
                DataGridView1.Item("IGSTVal", i).Value = 0
            End If
            'MsgBox(DataGridView1.Item("IGSTVal", i).Value)
            'If DataGridView1.Item("IGSTVal", i).Value = " " Then
            '    DataGridView1.Item("IGSTVal", i).Value = 0
            'End If
            If IsDBNull(DataGridView1.Item("FreeQTY", i).Value) Then
                DataGridView1.Item("FreeQTY", i).Value = 0
            End If
            'If DataGridView1.Item("FreeQTY", i).Value = " " Then
            '    DataGridView1.Item("FreeQTY", i).Value = 0
            'End If
            '............................................................................................................
            SGST_rate = InvoiceDetails("SGST", e.RowIndex).Value
            CGST_rate = InvoiceDetails("CGST", e.RowIndex).Value
            CESS_rate = InvoiceDetails("CESS", e.RowIndex).Value
            IGST_rate = InvoiceDetails("IGST", e.RowIndex).Value
            'If IsDBNull(InvoiceDetails("Amount", e.RowIndex).Value) Then
            '    Dim amount As String = InvoiceDetails("Amount", e.RowIndex).Value
            'End If
            Dim after_disc As String
            'InvoiceDetails("Amount", e.RowIndex).Value = qty * rate
            'InvoiceDetails("DiscValueDataGridViewTextBoxColumn", e.RowIndex).Value = qty * rate / 100 * disc_rate / qty * rate * 100
            '...................................................................................................................
            If sender.columns(e.ColumnIndex).headercell.value = "Unit" Then
                If DiscValue.Visible = True And discount.Visible = False Then
                    after_disc = qty * rate - disc_val
                    InvoiceDetails("DiscValue", e.RowIndex).Value = disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                    InvoiceDetails("DiscValue", e.RowIndex).Value = Math.Round(qty * rate / 100 * disc_rate, 2)
                End If
                Dim a As Double = qty * rate - qty * rate / 100 * disc_rate + qty * rate / 100 * SGST_rate
                'InvoiceDetails("DiscValueDataGridViewTextBoxColumn", e.RowIndex).Value = disc_val
                InvoiceDetails("Amount", e.RowIndex).Value = qty * rate
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                    InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                End If
                GoTo Init
                Exit Sub
            End If
            '....................................................................................................................
            If sender.columns(e.ColumnIndex).headercell.value = "Rate" Then
                If DiscValue.Visible = True And discount.Visible = False Then
                    after_disc = qty * rate - disc_val
                    InvoiceDetails("DiscValue", e.RowIndex).Value = disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                    InvoiceDetails("DiscValue", e.RowIndex).Value = Math.Round(qty * rate / 100 * disc_rate, 2)
                End If
                If tax = "Inclusive" Then
                    'InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(qty * rate - qty * rate / 100 * disc_rate, 2)
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("Amount", e.RowIndex).Value = qty * rate
                    InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                End If
                GoTo Init
                Exit Sub
            End If
            '.............................................................................................
            If sender.columns(e.ColumnIndex).headercell.value = "QTY" Or sender.columns(e.ColumnIndex).headercell.value = "Meters" Then
                If DiscValue.Visible = True And discount.Visible = False Then
                    after_disc = qty * rate - disc_val
                    InvoiceDetails("DiscValue", e.RowIndex).Value = disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                    InvoiceDetails("DiscValue", e.RowIndex).Value = Math.Round(qty * rate / 100 * disc_rate, 2)
                End If
                Dim a As Double = qty * rate - qty * rate / 100 * disc_rate + qty * rate / 100 * SGST_rate
                'InvoiceDetails("DiscValueDataGridViewTextBoxColumn", e.RowIndex).Value = disc_val
                InvoiceDetails("Amount", e.RowIndex).Value = qty * rate
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                    InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                End If
                GoTo Init
                Exit Sub
            End If
            '..............................................................................................
            If sender.columns(e.ColumnIndex).headercell.value = "Disc Value" Then
                after_disc = qty * rate - InvoiceDetails("DiscValue", e.RowIndex).Value
                'after_disc = qty * rate - qty * rate / 100 * disc_rate
                InvoiceDetails("Discount", e.RowIndex).Value = Math.Round(disc_val / (qty * rate) * 100, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                    InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                End If
                GoTo Init
            End If
            '..............................................................................................
            If sender.columns(e.ColumnIndex).headercell.value = "Disc %" Then
                after_disc = qty * rate - qty * rate / 100 * disc_rate
                InvoiceDetails("DiscValue", e.RowIndex).Value = Math.Round(qty * rate / 100 * disc_rate, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                    InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                End If
                GoTo Init
            End If
            'InvoiceDetails("TotAmountDataGridViewTextBoxColumn", e.RowIndex).Value = after_disc + after_disc / 100 * SGST_rate
            If sender.columns(e.ColumnIndex).headercell.value = "SGST %" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                InvoiceDetails("IGST", e.RowIndex).Value = 0
                InvoiceDetails("IGSTVal", e.RowIndex).Value = 0
                InvoiceDetails("SGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "SGST Val" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                InvoiceDetails("IGST", e.RowIndex).Value = 0
                InvoiceDetails("IGSTVal", e.RowIndex).Value = 0
                Dim sgstval As Double = InvoiceDetails("SGSTVal", e.RowIndex).Value
                'InvoiceDetails("SGSTValDataGridViewTextBoxColumn", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                InvoiceDetails("SGST", e.RowIndex).Value = Math.Round(sgstval / after_disc * 100, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + sgstval + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate, 2)
                    InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "CGST %" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                InvoiceDetails("IGST", e.RowIndex).Value = 0
                InvoiceDetails("IGSTVal", e.RowIndex).Value = 0
                InvoiceDetails("CGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CGST_rate, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "CGST Val" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                InvoiceDetails("IGST", e.RowIndex).Value = 0
                InvoiceDetails("IGSTVal", e.RowIndex).Value = 0
                Dim sgstval As Double = InvoiceDetails("SGSTVal", e.RowIndex).Value
                Dim cgstval As Double = InvoiceDetails("CGSTVal", e.RowIndex).Value
                Dim cessval As Double = InvoiceDetails("CESSVal", e.RowIndex).Value
                'Dim igstval As Double = InvoiceDetails("IGSTVal", e.RowIndex).Value
                'InvoiceDetails("SGSTValDataGridViewTextBoxColumn", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                InvoiceDetails("CGST", e.RowIndex).Value = Math.Round(cgstval / after_disc * 100, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + sgstval + cgstval + cessval, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "CESS %" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                InvoiceDetails("CESSVal", e.RowIndex).Value = Math.Round(after_disc / 100 * CESS_rate, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * SGST_rate + after_disc / 100 * CGST_rate + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "CESS Val" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                Dim sgstval As Double = InvoiceDetails("SGSTVal", e.RowIndex).Value
                Dim cgstval As Double = InvoiceDetails("CGSTVal", e.RowIndex).Value
                Dim cessval As Double = InvoiceDetails("CESSVal", e.RowIndex).Value
                Dim igstval As Double = InvoiceDetails("IGSTVal", e.RowIndex).Value
                'InvoiceDetails("SGSTValDataGridViewTextBoxColumn", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                InvoiceDetails("CESS", e.RowIndex).Value = Math.Round(cessval / after_disc * 100, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + sgstval + cgstval + cessval + igstval, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "IGST %" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                'InvoiceDetails("CGST", e.RowIndex).Value = 0
                'InvoiceDetails("CGSTVal", e.RowIndex).Value = 0
                'InvoiceDetails("SGSTVal", e.RowIndex).Value = 0
                'InvoiceDetails("SGST", e.RowIndex).Value = 0
                InvoiceDetails("IGSTVal", e.RowIndex).Value = Math.Round(after_disc / 100 * IGST_rate, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + after_disc / 100 * CESS_rate + after_disc / 100 * IGST_rate, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "IGST Val" Then
                If DiscValue.Visible = True Then
                    after_disc = qty * rate - disc_val
                Else
                    after_disc = qty * rate - qty * rate / 100 * disc_rate
                End If
                'InvoiceDetails("CGST", e.RowIndex).Value = 0
                'InvoiceDetails("CGSTVal", e.RowIndex).Value = 0
                'InvoiceDetails("SGSTVal", e.RowIndex).Value = 0
                'InvoiceDetails("SGST", e.RowIndex).Value = 0
                'Dim sgstval As Double = InvoiceDetails("SGSTVal", e.RowIndex).Value
                'Dim cgstval As Double = InvoiceDetails("CGSTVal", e.RowIndex).Value
                Dim cessval As Double = InvoiceDetails("CESSVal", e.RowIndex).Value
                Dim igstval As Double = InvoiceDetails("IGSTVal", e.RowIndex).Value
                'InvoiceDetails("SGSTValDataGridViewTextBoxColumn", e.RowIndex).Value = Math.Round(after_disc / 100 * SGST_rate, 2)
                InvoiceDetails("IGST", e.RowIndex).Value = Math.Round(igstval / after_disc * 100, 2)
                If tax = "Inclusive" Then
                    DataGridView1.Item("TotAmount", i).Value = after_disc
                    Dim all As Double = after_disc * (SGST_rate + CGST_rate + CESS_rate + IGST_rate) / (100 + (SGST_rate + CGST_rate + CESS_rate + IGST_rate))
                    Dim alltx As Double = SGST_rate + CGST_rate + CESS_rate + IGST_rate
                    DataGridView1.Item("Amount", i).Value = Math.Round(after_disc - all, 2)
                    If SGST_rate > 0 Then
                        DataGridView1.Item("SGSTVal", i).Value = Math.Round((all * SGST_rate / alltx), 2)
                    End If
                    If CGST_rate > 0 Then
                        DataGridView1.Item("CGSTVal", i).Value = Math.Round((all * CGST_rate) / alltx, 2)
                    End If
                    If CESS_rate > 0 Then
                        DataGridView1.Item("CESSVal", i).Value = Math.Round((all * CESS_rate) / alltx, 2)
                    End If
                    If IGST_rate > 0 Then
                        DataGridView1.Item("IGSTVal", i).Value = Math.Round((all * IGST_rate) / alltx, 2)
                    End If
                Else
                    InvoiceDetails("TotAmount", e.RowIndex).Value = Math.Round(after_disc + cessval + igstval, 2)
                End If
                GoTo Init
            End If
            If sender.columns(e.ColumnIndex).headercell.value = "Free QTY" Then
                GoTo Init
            End If
        End If
        If (e.ColumnIndex = 5 Or e.ColumnIndex = 9 Or e.ColumnIndex = 12 Or e.ColumnIndex = 13 Or e.ColumnIndex = 14 Or e.ColumnIndex = 15) And InvoiceDetails.Rows.Count > 0 Then
Init:
            txt_gross.Text = gross().ToString
            txt_qty.Text = quantity().ToString
            TextBox16.Text = Total().ToString
            TextBox14.Text = disc().ToString
            TextBox15.Text = GST().ToString
            txt_free_qty.Text = freeQtys().ToString
            'Dim q As Double = String.Format("{0:0.00}", net().ToString)
            'MsgBox(q)
            Dim r As Double = net().ToString
            Dim a As Double = r - Math.Truncate(r)
            Dim round As Double = Math.Round(a, 2)
            If round <= 0.49 Then
                'MsgBox("less than 0.5")
                'MsgBox(Math.Round(r, 0))
                TextBox20.Text = Math.Round(r, 0)
                TextBox19.Text = "- " & round
            Else
                'MsgBox("greater than 0.5")
                'MsgBox(round)
                'MsgBox(Math.Round(r, 0) + 1)
                If round = 0.5 Then
                    TextBox20.Text = Math.Round(r, 0) + 1
                    TextBox19.Text = round
                Else
                    TextBox20.Text = Math.Round(r, 0)
                    TextBox19.Text = round
                End If
            End If
        End If
        outer_controls()
    End Sub

    Public Sub assign()
        txt_gross.Text = gross().ToString
        txt_qty.Text = quantity().ToString
        TextBox16.Text = Total().ToString
        TextBox14.Text = disc().ToString
        'TextBox12.Text = freeQtys().ToString
        'TextBox20.Text = net().ToString
        Dim r As Double = net().ToString
        Dim a As Double = r - Math.Truncate(r)
        Dim round As Double = Math.Round(a, 2)
        If round <= 0.49 Then
            'MsgBox("less than 0.5")
            'MsgBox(Math.Round(r, 0))
            TextBox20.Text = Math.Round(r, 0)
            TextBox19.Text = "-" & round
        Else
            'MsgBox("greater than 0.5")
            'MsgBox(round)
            'MsgBox(Math.Round(r, 0) + 1)
            If round = 0.5 Then
                TextBox20.Text = Math.Round(r, 0) + 1
                TextBox19.Text = round
            Else
                TextBox20.Text = Math.Round(r, 0)
                TextBox19.Text = round
            End If
        End If
        outer_controls()
        TextBox15.Text = GST().ToString
    End Sub
    Public Function cols(ByVal c As Integer) As Integer
        Dim col As Integer = c
        Return col
    End Function
    Public Function recs(ByVal r As Integer) As Integer
        Dim rec As Integer = r
        Return rec
    End Function
    Private Sub DataGridView1_SelectionChanged(sender As Object, e As EventArgs) Handles DataGridView1.SelectionChanged
        If flag_cell_edited Then
            If nofound = True Then
                'DataGridView1.CurrentCell = DataGridView1(3, currentRow)
                'DataGridView1.BeginEdit(True)
                'nofound = False
                flag_cell_edited = False
            Else
                DataGridView1.CurrentCell = DataGridView1(currentColumn, currentRow)
                flag_cell_edited = False
            End If
        End If
    End Sub
    Public Event CurrentRowChanged()
    Private Sub DataGridView1_CurrentCellChanged(sender As Object, e As EventArgs) Handles DataGridView1.CurrentCellChanged
        'Try
        '    Static nPrevLineIndex As Integer = -1
        '    Try
        '        If nPrevLineIndex <> Me.DataGridView1.CurrentRow.Index Then
        '            nPrevLineIndex = Me.DataGridView1.CurrentRow.Index
        '            RaiseEvent CurrentRowChanged()
        '        End If
        '    Catch ex As Exception

        '    End Try

        'Catch
        '    'MsgBox("no record inserted")
        'End Try
    End Sub
    Public Sub TextBox2_Leave(sender As Object, e As EventArgs) Handles TextBox2.Leave
        If sale_l Then
            sale_l = False
            TextBox2.Text = bill_number
        End If
        TextBox2.Enabled = False
        Dim tm As Boolean
        If TextBox2.Text = "" Then
            TextBox2.Text = bill_no
            btn_edit.Enabled = False
            btn_print.Enabled = False
            btn_search.Enabled = False
            btn_delete.Enabled = False
            btn_save.Enabled = True
            btn_save_print.Enabled = True
            Exit Sub
        Else
            Dim dr3 As SQLiteDataReader
            Try
                cmd = New SQLiteCommand("select * from outer_sale where Bill_No ='" & TextBox2.Text & "' ", cn)
                cn.Close()
                cn.Open()
                dr3 = cmd.ExecuteReader()
                If dr3.HasRows = False Then
                    btn_edit.Enabled = False
                    btn_print.Enabled = False
                    btn_search.Enabled = False
                    btn_delete.Enabled = False
                    btn_save.Enabled = True
                    btn_save_print.Enabled = True
                    dr3.Close()
                Else
                    Try
                        dr3.Close()
                        Try
                            cmd = New SQLiteCommand("select * from outer_sale where Bill_No ='" & TextBox2.Text & "' ", cn)
                            If cn.State = ConnectionState.Closed Then
                                cn.Open()
                            End If
                            Dim adapter As New SQLiteDataAdapter(cmd)
                            Dim table As New DataTable()
                            adapter.Fill(table)
                            client_name.Text = table.Rows(0)(1).ToString()
                            Dim abs As String
                            Dim ns As String
                            Dim my As String
                            Dim y As String
                            Dim mn As String
                            Dim day As Integer
                            abs = "/"
                            ns = Replace(table.Rows(0)(2).ToString(), abs, "")
                            my = ns.Remove(0, 2)
                            y = my.Remove(0, 2)
                            mn = my.Substring(0, 2)
                            day = ns.Substring(0, 2)
                            bill_date.Value = New Date(y, mn, day)
                            due_days.Text = table.Rows(0)(3).ToString()
                            abs = "/"
                            ns = Replace(table.Rows(0)(4).ToString(), abs, "")
                            my = ns.Remove(0, 2)
                            y = my.Remove(0, 2)
                            mn = my.Substring(0, 2)
                            day = ns.Substring(0, 2)
                            due_date.Value = New Date(y, mn, day)
                            Box1.Text = table.Rows(0)(5).ToString()

                            If Box2.Visible Then
                                ns = Replace(table.Rows(0)(6).ToString(), abs, "")
                                my = ns.Remove(0, 2)
                                y = my.Remove(0, 2)
                                mn = my.Substring(0, 2)
                                day = ns.Substring(0, 2)
                                Box2.Value = New Date(y, mn, day)
                            End If
                            Box3.Text = table.Rows(0)(7).ToString()

                            If Box4.Visible Then
                                ns = Replace(table.Rows(0)(8).ToString(), abs, "")
                                my = ns.Remove(0, 2)
                                y = my.Remove(0, 2)
                                mn = my.Substring(0, 2)
                                day = ns.Substring(0, 2)
                                Box4.Value = New Date(y, mn, day)
                            End If
                            Box5.Text = table.Rows(0)(9).ToString()

                            If Box6.Visible Then
                                ns = Replace(table.Rows(0)(10).ToString(), abs, "")
                                my = ns.Remove(0, 2)
                                y = my.Remove(0, 2)
                                mn = my.Substring(0, 2)
                                day = ns.Substring(0, 2)
                                Box6.Value = New Date(y, mn, day)
                            End If

                            Box7.Text = table.Rows(0)(11).ToString()

                            If Box8.Visible Then
                                ns = Replace(table.Rows(0)(12).ToString(), abs, "")
                                my = ns.Remove(0, 2)
                                y = my.Remove(0, 2)
                                mn = my.Substring(0, 2)
                                day = ns.Substring(0, 2)
                                Box8.Value = New Date(y, mn, day)
                            End If

                            Box11.Text = table.Rows(0)(13).ToString()
                            Box12.Text = table.Rows(0)(14).ToString()
                            Box9.Text = table.Rows(0)(15).ToString()
                            Box10.Text = table.Rows(0)(16).ToString()
                            Box13.Text = table.Rows(0)(17).ToString()
                            Box14.Text = table.Rows(0)(18).ToString()
                            Dim Payment As String = table.Rows(0)(19).ToString()
                            If Payment = "Cash" Then
                                cash.Checked = True
                            Else
                                credit.Checked = True
                            End If
                            txt_qty.Text = table.Rows(0)(20).ToString()
                            txt_free_qty.Text = table.Rows(0)(21).ToString()
                            txt_gross.Text = table.Rows(0)(22).ToString()
                            TextBox14.Text = table.Rows(0)(23).ToString()
                            TextBox18.Text = table.Rows(0)(24).ToString()
                            TextBox17.Text = table.Rows(0)(25).ToString()
                            TextBox15.Text = table.Rows(0)(27).ToString()
                            TextBox16.Text = table.Rows(0)(28).ToString()
                            TextBox19.Text = table.Rows(0)(29).ToString()
                            TextBox20.Text = table.Rows(0)(30).ToString()
                            salesman.Text = table.Rows(0)(51).ToString()
                            txt_com.Text = table.Rows(0)(52).ToString()
                            comp.Text = table.Rows(0)(53).ToString()
                            profitamt.Text = table.Rows(0)(54).ToString()
                            profitp.Text = table.Rows(0)(54).ToString()
                            lbl_old_amt.Text = table.Rows(0)(30).ToString()

                            txt_remark.Text = table.Rows(0)(32).ToString()
                            If table.Rows(0)("fright_added").ToString() = "Paid" Then
                                add_less = False
                                btn_add_less.Text = "Less"
                            Else
                                add_less = True
                                btn_add_less.Text = "Add"
                            End If
                        Catch ex As Exception
                            MsgBox(ex.Message)
                        Finally
                            If cn.State = ConnectionState.Open Then
                                cn.Close()
                            End If
                        End Try
                        dt.Clear()
                        da = New SQLiteDataAdapter("select * from inner_sale where Bill_No ='" & TextBox2.Text & "' ", cn)
                        da.Fill(dt)
                        DataGridView1.DataSource = dt
                        da.Dispose()
                        '..................................................................................................
                        'If cn.State = ConnectionState.Closed Then
                        '    cn.Open()
                        'End If

                        'Dim cmdz As New SQLiteCommand("select * from inner_sale where Bill_No ='" & TextBox2.Text & "' ", cn)
                        'Dim drz As SQLiteDataReader = cmdz.ExecuteReader()

                        'DataGridView1.Rows.Clear()

                        'While drz.Read()
                        '    MsgBox(drz("ProductName").ToString)
                        '    DataGridView1.Rows.Add(drz("Bill_No").ToString,
                        '                           drz("Sr").ToString,
                        '                           drz("ProductID").ToString,
                        '                           drz("ProductName").ToString,
                        '                           drz("HSN").ToString,
                        '                           drz("Bal_Stock").ToString,
                        '                           drz("QTY").ToString,
                        '                           drz("FreeQTY").ToString,
                        '                           drz("pack").ToString,
                        '                           drz("Unit").ToString,
                        '                           drz("Rate").ToString,
                        '                           drz("net_rate").ToString,
                        '                           drz("MRP").ToString,
                        '                           drz("Amount").ToString,
                        '                           drz("Disc").ToString,
                        '                           drz("DiscValue").ToString,
                        '                           drz("SGST").ToString,
                        '                           drz("SGSTVal").ToString,
                        '                           drz("CGST").ToString,
                        '                           drz("CGSTVal").ToString,
                        '                           drz("CESS").ToString,
                        '                           drz("CESSVal").ToString,
                        '                           drz("IGST").ToString,
                        '                           drz("IGSTVal").ToString,
                        '                           drz("TotAmount").ToString,
                        '                           drz("product_desc").ToString()
                        '                           )
                        'End While
                        'drz.Close()
                        'If cn.State = ConnectionState.Open Then
                        '    cn.Close()
                        'End If
                        ''...........................................................................................
                        DataGridView1.ReadOnly = True
                        'DataGridView1.Enabled = False
                        tm = True
                        Dim matches2() As Control
                        For i As Integer = 1 To 14
                            matches2 = Me.Controls.Find("Box" & i, True)
                            If matches2.Length > 0 AndAlso TypeOf matches2(0) Is TextBox Then
                                Dim cb As TextBox = DirectCast(matches2(0), TextBox)
                                cb.Enabled = False
                            End If
                        Next
                        Dim matches3() As Control
                        For i As Integer = 1 To 14
                            matches3 = Me.Controls.Find("Box" & i, True)
                            If matches3.Length > 0 AndAlso TypeOf matches3(0) Is DateTimePicker Then
                                Dim cb As DateTimePicker = DirectCast(matches3(0), DateTimePicker)
                                cb.Enabled = False
                            End If
                        Next
                        client_name.Enabled = False
                        salesman.Enabled = False
                        comp.Enabled = False
                        txt_com.Enabled = False
                        profitp.Enabled = False
                        profitamt.Enabled = False
                        cash.Enabled = False
                        credit.Enabled = False
                        TextBox17.Enabled = False
                        TextBox18.Enabled = False
                        bill_date.Enabled = False
                        due_date.Enabled = False
                        due_days.Enabled = False
                        btn_print.Enabled = True
                        btn_edit.Enabled = True
                        btn_search.Enabled = True
                        btn_delete.Enabled = True
                        btn_save.Enabled = False
                        btn_save_print.Enabled = False
                        txt_remark.Enabled = False
                        btn_save_print.Focus()
                        dr3.Close()
                        If sale_l2 Then
                            Button5_Click(e, e)
                        End If
                        If sale_l3 Then
                            Button8_Click(e, e)
                        End If
                    Catch ex As Exception
                        'MsgBox(ex.Message)
                    Finally
                        If cn.State = ConnectionState.Open Then
                            cn.Close()
                        End If
                    End Try
                    Button3.Focus()
                End If
                dr3.Close()
                If tm = True Then
                Else
                    dr3.Close()
                End If
            Catch ex As Exception
                'MsgBox(ex.Message)
            End Try
            cn.Close()
        End If
    End Sub
    Private Sub TextBox2_KeyPress(sender As Object, e As KeyPressEventArgs) Handles TextBox2.KeyPress, Box5.KeyPress, Box3.KeyPress
        If Not Char.IsNumber(e.KeyChar) AndAlso Not Char.IsControl(e.KeyChar) Then
            e.Handled = True
        End If
    End Sub
    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Me.Close()
    End Sub
    Private Sub due_days_Leave(sender As Object, e As EventArgs) Handles due_days.Leave
        If due_days.Text = "" Then
            due_date.Value = bill_date.Value
            Exit Sub
        Else
            Dim due_d As Integer = due_days.Text
            due_date.Value = bill_date.Value.AddDays(due_d)
        End If
    End Sub
    Private Sub due_days_KeyPress(sender As Object, e As KeyPressEventArgs) Handles due_days.KeyPress
    End Sub
    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles btn_edit.Click
        lbl_old_amt.Text = TextBox20.Text
        edit = True
        DataGridView1.ReadOnly = False
        DataGridView1.Enabled = True
        Amount.ReadOnly = True
        Bal_Stock.ReadOnly = True
        TotAmount.ReadOnly = True
        Dim matches2() As Control
        For i As Integer = 1 To 14
            matches2 = Me.Controls.Find("Box" & i, True)
            If matches2.Length > 0 AndAlso TypeOf matches2(0) Is TextBox Then
                Dim cb As TextBox = DirectCast(matches2(0), TextBox)
                cb.Enabled = True
            End If
        Next
        Dim matches3() As Control
        For i As Integer = 1 To 14
            matches3 = Me.Controls.Find("Box" & i, True)
            If matches3.Length > 0 AndAlso TypeOf matches3(0) Is DateTimePicker Then
                Dim cb As DateTimePicker = DirectCast(matches3(0), DateTimePicker)
                cb.Enabled = True
            End If
        Next
        client_name.Enabled = True
        salesman.Enabled = True
        comp.Enabled = True
        txt_com.Enabled = True
        profitp.Enabled = True
        profitamt.Enabled = True
        cash.Enabled = True
        credit.Enabled = True
        TextBox17.Enabled = True
        TextBox18.Enabled = True
        bill_date.Enabled = True
        due_date.Enabled = True
        due_days.Enabled = True
        btn_edit.Enabled = False
        btn_print.Enabled = False
        btn_search.Enabled = False
        btn_delete.Enabled = False
        btn_save.Enabled = True
        btn_save_print.Enabled = True
        txt_remark.Enabled = True
        owntext.Focus()
        If sale_l2 Then
            sale_l2 = False
        End If
    End Sub
    Private Sub DataGridView1_CellValidating(sender As Object, e As DataGridViewCellValidatingEventArgs) Handles DataGridView1.CellValidating
        '    Dim headerText As String =
        ' DataGridView1.Columns(e.ColumnIndex).HeaderText
        '    ' Abort validation if cell is not in the CompanyName column.
        '    If Not headerText.Equals("Product Name") Then Return
        '    ' Confirm that the cell is not empty.
        '    If (String.IsNullOrEmpty(e.FormattedValue.ToString())) Then
        '        MsgBox("not selected")
        '        DataGridView1.Rows(e.RowIndex).ErrorText =
        '            "Product Name must not be empty"
        '        e.Cancel = True
        '    End If
    End Sub
    Private Sub Box13_KeyPress(sender As Object, e As KeyPressEventArgs) Handles Box13.KeyPress, TextBox18.KeyPress, TextBox17.KeyPress, Box14.KeyPress
        If IsNumeric(e.KeyChar.ToString()) _
           Or e.KeyChar = ChrW(Keys.Back) _
           Or e.KeyChar = "." Then
            'MessageBox.Show("KeyPress number")
            e.Handled = False 'if numeric display
        Else
            'MessageBox.Show("enter numbers only")
            e.Handled = True  'if non numeric don't display
        End If
    End Sub
    Private Sub outer_controls()
        Dim hamali As Double
        Dim other As Double
        Dim disc_rate As Double
        Dim disc_val As Double
        Dim r As Double
        Dim commission As Double
        Dim total As Double
        Dim profit As Double
        If Not IsDBNull(TextBox16.Text) Then
            If TextBox16.Text = "" Then
                outer_disc_rate = False
                outer_disc_val = False
                Exit Sub
            Else
                If TextBox16.Text = "" Then
                    TextBox16.Text = 0
                Else
                    total = TextBox16.Text
                End If
                If profitamt.Text = "" Then
                    profitamt.Text = 0
                Else
                    profit = profitamt.Text
                End If
                If txt_com.Text = "" Then
                    txt_com.Text = 0
                Else
                    commission = txt_com.Text
                End If
                If Box13.Text = "" Then
                    Box13.Text = 0
                Else
                    hamali = Box13.Text
                End If
                If Box14.Text = "" Then
                    Box14.Text = 0
                Else
                    If add_less Then
                        other = 0
                    Else
                        other = Box14.Text
                    End If
                End If
                If TextBox18.Text = "" Then
                    TextBox18.Text = 0
                Else
                    disc_rate = TextBox18.Text
                End If
                If TextBox17.Text = "" Or TextBox17.Text = 0 Then
                    TextBox17.Text = 0
                    disc_val = 0
                Else
                    disc_val = TextBox17.Text
                End If
                r = (total + hamali + commission + profit + other) - (total + hamali + commission + profit + other) / 100 * disc_rate
                'disc_val = (total + hamali + other) / 100 * disc_rate
                TextBox17.Text = (total + hamali + other) / 100 * disc_rate
                If outer_disc_rate Then
                    outer_disc_rate = False
                    r = (total + hamali + other) - (total + hamali + other) / 100 * disc_rate
                    TextBox17.Text = Math.Round((total + hamali + other) / 100 * disc_rate, 2)
                    disc_val = (total + hamali + other) / 100 * disc_rate
                End If
                If outer_disc_val Then
                    outer_disc_val = False
                    r = (total + hamali + commission + profit + other) - disc_val
                    'MsgBox(r)
                    Dim nan As String = Math.Round(disc_val / (total + hamali + other) * 100, 2)
                    If nan = "NaN" Then
                        TextBox18.Text = 0
                    Else
                        TextBox18.Text = Math.Round(disc_val / (total + hamali + commission + profit + other) * 100, 2)
                    End If
                    TextBox17.Text = disc_val
                    disc_rate = (total + hamali + commission + profit + other) / 100 * disc_rate
                    'MsgBox(disc_rate)
                    GoTo a
                End If
                r = (total + hamali + commission + profit + other) - (total + hamali + commission + profit + other) / 100 * disc_rate
a:
                Dim a As Double = r - Math.Truncate(r)
                Dim round As Double = Math.Round(a, 2)
                If round <= 0.49 Then
                    'MsgBox("less than 0.5")
                    'MsgBox(Math.Round(r, 0))
                    TextBox20.Text = Math.Round(r, 0)
                    TextBox19.Text = "-" & round
                Else
                    'MsgBox("greater than 0.5")
                    'MsgBox(round)
                    'MsgBox(Math.Round(r, 0) + 1)
                    If round = 0.5 Then
                        TextBox20.Text = Math.Round(r, 0)
                        TextBox19.Text = round
                    Else
                        TextBox20.Text = Math.Round(r, 0)
                        TextBox19.Text = round
                    End If
                End If
            End If
        End If
    End Sub
    Private Sub Box13_Leave(sender As Object, e As EventArgs) Handles Box13.Leave, Box14.Leave
        outer_controls()
    End Sub
    Private Sub DataGridView1_CellBeginEdit(sender As Object, e As DataGridViewCellCancelEventArgs) Handles DataGridView1.CellBeginEdit
        'MsgBox("editing")
        If TextBox2.Enabled Then
            TextBox2_Leave(e, e)
        End If
        Dim i As Integer
        i = DataGridView1.CurrentRow.Index
        If Not sender.columns(e.ColumnIndex).headercell.value = "Product Name" And Not sender.columns(e.ColumnIndex).headercell.value = "Prod. ID" Then
            If IsDBNull(DataGridView1.Item("ProductName", i).Value) Then
                MsgBox("No product selected", MsgBoxStyle.Information)
                e.Cancel = True
            End If
        End If
    End Sub
    Private Sub DataGridView1_RowLeave(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.RowLeave
        'MsgBox("roe changed")
        ''Me.DataGridView1.AllowUserToAddRows = False
        'DataGridView1.CurrentCell = DataGridView1(currentColumn, currentRow - 1)
    End Sub
    Private Sub due_date_lostfocus(sender As Object, e As EventArgs) Handles due_date.LostFocus
        Dim d1 As DateTime = bill_date.Value
        Dim d2 As DateTime = due_date.Value
        Dim result As TimeSpan = d2.Subtract(d1)
        Dim days As Integer = result.TotalDays
        'MsgBox(days)
        due_days.Text = ""
        due_days.Text = days
    End Sub
    Private Sub a()
        Dim ind As Integer
        ind = DataGridView1.CurrentCell.RowIndex
        DataGridView1.Rows.RemoveAt(ind)
        SendKeys.Send("{left}")
    End Sub
    Private Sub DataGridView1_KeyUp(sender As Object, e As KeyEventArgs) Handles DataGridView1.KeyUp
        If e.KeyCode = Keys.Up Or e.KeyCode = Keys.Left Then
            'MsgBox("1")
            up = True
        End If
        If e.KeyCode = Keys.Escape Then
            Me.Close()
        End If
        'If e.KeyCode = Keys.E AndAlso e.Modifiers = Keys.Alt Then
        '    MsgBox("alt+e")
        'End If
    End Sub
    Private Sub DataGridView1_DataError(sender As Object, e As DataGridViewDataErrorEventArgs) Handles DataGridView1.DataError
        'MsgBox("error")
    End Sub
    Private Sub due_days_TextChanged(sender As Object, e As EventArgs) Handles due_days.TextChanged
        If due_days.Text = "" Then
            due_date.Value = bill_date.Value
            Exit Sub
        Else
            'due_date.Text = bill_date.Text.AddDays(due_days.Text)
            'due_date.CustomFormat = "dd/MM/yyyy"
            'Dim abs As String = "-"
            'Dim ns As String = Replace(bill_date.Text, abs, "")
            'Dim my As String = ns.Remove(0, 2)
            'Dim y As String = my.Remove(0, 2)
            'Dim mn As String = my.Substring(0, 2)
            'Dim day As Integer = ns.Substring(0, 2)
            Dim due_d As Integer = due_days.Text
            'Dim dd As Integer = due_d + day
            'MsgBox(dd)
            'due_date.Value = New Date(y, mn, dd)
            due_date.Value = bill_date.Value.AddDays(due_d)
        End If
    End Sub
    Private Sub Box13_TextChanged(sender As Object, e As EventArgs) Handles Box13.TextChanged
        outer_controls()
    End Sub
    Private Sub Box14_TextChanged(sender As Object, e As EventArgs) Handles Box14.TextChanged
        outer_controls()
    End Sub
    Private Sub TextBox18_TextChanged(sender As Object, e As EventArgs) Handles TextBox18.TextChanged
        'outer_disc_val = True
        outer_controls()
    End Sub
    Private Sub TextBox18_Leave(sender As Object, e As EventArgs) Handles TextBox18.Leave
        outer_disc_rate = True
        outer_controls()
    End Sub
    Private Sub TextBox17_Leave(sender As Object, e As EventArgs) Handles TextBox17.Leave
        outer_disc_val = True
        outer_controls()
    End Sub
    Private Sub Label1_Click(sender As Object, e As EventArgs) Handles Label1.Click
        Dim abs As String = "-"
        Dim ns As String = Replace(bill_date.Text, abs, "")
        Dim my As String = ns.Remove(0, 2)
        Dim y As String = my.Remove(0, 2)
        Dim mn As String = my.Substring(0, 2)
        Dim day As String = ns.Substring(0, 2)
        Dim all As String = y + mn + day
        MsgBox(all)
    End Sub
    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles btn_delete.Click
        If sale_l3 Then
            GoTo Direct
        End If
        Dim yn As Integer
        yn = MsgBox("Are You Sure To Deleting this Sale Bill?", MsgBoxStyle.YesNo)
        If yn = 6 Then
Direct:
            Dim i As Integer
            Dim source1 As String = "SALE"
            Dim pre_qty As String
            Dim pre_bal_qty As String
            Dim cm1 As SQLiteCommand
            cm1 = New SQLiteCommand("select max(Sr_no),Debit_amount from party_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source1 & "' and party_name='" & client_name.Text & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter1 As New SQLiteDataAdapter(cm1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)
            pre_qty = table1.Rows(0)(1).ToString()
            Dim sr_no As String = table1.Rows(0)(0).ToString()
            adapter1.Dispose()
            'MsgBox("get pre qty")
            '...............................................................................................
            ' pre_bal_qty'...
            Dim cm2 As SQLiteCommand
            cm2 = New SQLiteCommand("select max(Sr_no),Balance from party_ledger where Sr_no<'" & sr_no & "'  AND  party_name='" & client_name.Text & "'", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter2 As New SQLiteDataAdapter(cm2)
            Dim table2 As New DataTable()
            adapter2.Fill(table2)
            'MsgBox(table2.Rows(0)(1).ToString())
            pre_bal_qty = table2.Rows(0)(1).ToString()
            ' MsgBox(pre_bal_qty)
            'MsgBox("get bal qty")
            If pre_bal_qty = "" Then
                pre_bal_qty = 0
            End If
            Dim abs As String = "-"
            Dim ns As String = Replace(bill_date.Text, abs, "")
            Dim my As String = ns.Remove(0, 2)
            Dim y As String = my.Remove(0, 2)
            Dim mn As String = my.Substring(0, 2)
            Dim day As String = ns.Substring(0, 2)
            Dim all As String = y + mn + day
            'MsgBox(all)
            Dim cm3 As SQLiteCommand
            cm3 = New SQLiteCommand("select count(*) from party_ledger where own_date>='" & all & "' and Sr_no>'" & sr_no & "'  and party_name='" & client_name.Text & "' ", cn)
            If cn.State = ConnectionState.Closed Then
                cn.Open()
            End If
            Dim adapter3 As New SQLiteDataAdapter(cm3)
            Dim table3 As New DataTable()
            adapter3.Fill(table3)
            Dim cnt As String
            If table3.Rows(0)(0).ToString() <> 0 Then
                cnt = table3.Rows(0)(0).ToString()
                Try
                    Dim cm4 As SQLiteCommand
                    cm4 = New SQLiteCommand("select own_date,sr_no from party_ledger where own_date>='" & all & "'  and Sr_no>'" & sr_no & "' and party_name='" & client_name.Text & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim dr As SQLiteDataReader
                    dr = cm4.ExecuteReader()
                    ComboBox5.Items.Clear()
                    ComboBox6.Items.Clear()
                    If dr.HasRows = True Then
                        While dr.Read()
                            ComboBox5.Items.Add(dr(0).ToString())
                            ComboBox6.Items.Add(dr(1).ToString())
                        End While
                        dr.Close()
                    End If
                    dr.Close()
                Catch ex As Exception
                    MsgBox(ex.Message)
                Finally
                    If cn.State = ConnectionState.Open Then
                        cn.Close()
                    End If
                End Try

                For i = 0 To cnt - 1
                    cmd = New SQLiteCommand("update party_ledger set Balance= Balance-'" & (pre_qty) & "' ,Status='Pending'  where own_date='" & ComboBox5.Items(i).ToString() & "' and sr_no='" & ComboBox6.Items(i).ToString() & "'   and Sr_no>'" & sr_no & "' and party_name='" & client_name.Text & "'", cn)
                    cn.Close()
                    cn.Open()
                    'MsgBox(pre_qty)
                    cmd.ExecuteNonQuery()
                    'MsgBox("update other")
                    cn.Close()
                    cn.Open()
aa:
                Next i
            End If
            cmd = New SQLiteCommand("delete from party_ledger where  Bill_No='" & TextBox2.Text & "' AND Source='" & source1 & "' and party_name='" & client_name.Text & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            '.....................................................end party ledger.........................................
            '.....................................................cash balance updating....................................
            If cash.Checked = True Then
                cmd = New SQLiteCommand("update cash_account set balance=balance- '" & TextBox20.Text & "'", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                cmd.ExecuteNonQuery()
                cmd.Dispose()
                cn.Close()
            End If
            '.................................................end cash account balance................
            '.................................................updating product stock.........................
            ComboBox4.Items.Clear()
            For Each row1 As DataGridViewRow In DataGridView1.Rows
                Try
                    If IsDBNull(row1.Cells("ProductName").Value) Then
                        GoTo nx
                    Else
                        If row1.Cells("ProductName").Value = "" Then
                            GoTo nx
                        End If
                    End If
                    ComboBox4.Items.Add(row1.Cells("ProductName").Value)
                Catch ex As Exception
                End Try
nx:
            Next
            Dim i1 As Integer
            Dim source As String = "SALE"
            Dim pre_qty1 As String
            Dim pre_bal_qty1 As String
            Dim a1 As Integer
            For a1 = 0 To ComboBox4.Items.Count.ToString - 1
                'MsgBox("in remv")
                Dim cm6 As SQLiteCommand
                cm6 = New SQLiteCommand("select max(Sr_no),out_qty from stock_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source & "' and products='" & ComboBox4.Items(a1).ToString() & "'", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adapter6 As New SQLiteDataAdapter(cm6)
                Dim table6 As New DataTable()
                adapter6.Fill(table6)
                'MsgBox(table1.Rows(0)(1).ToString())
                pre_qty1 = table6.Rows(0)(1).ToString()
                'MsgBox(table1.Rows(0)(0).ToString())
                Dim sr_no1 As String = table6.Rows(0)(0).ToString()
                adapter6.Dispose()
                'MsgBox("get pre qty")
                '...............................................................................................
                ' pre_bal_qty'...
                Dim cm5 As SQLiteCommand
                cm5 = New SQLiteCommand("select max(Sr_no),bal_qty from stock_ledger where Sr_no<'" & sr_no1 & "'  AND  products='" & ComboBox4.Items(a1).ToString() & "'", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adapter4 As New SQLiteDataAdapter(cm5)
                Dim table4 As New DataTable()
                adapter4.Fill(table4)
                'MsgBox(table2.Rows(0)(1).ToString())
                pre_bal_qty1 = table4.Rows(0)(1).ToString()
                'MsgBox(pre_bal_qty)
                'MsgBox("get bal qty")
                If pre_bal_qty1 = "" Then
                    pre_bal_qty1 = 0
                End If
                Dim abs1 As String = "/"
                Dim ns1 As String = Replace(bill_date.Text, abs1, "")
                Dim my1 As String = ns1.Remove(0, 2)
                Dim y1 As String = my1.Remove(0, 2)
                Dim mn1 As String = my1.Substring(0, 2)
                Dim day1 As String = ns1.Substring(0, 2)
                Dim all1 As String = y + mn + day
                'MsgBox(all)
                Dim cm As SQLiteCommand
                cm = New SQLiteCommand("select count(*) from stock_ledger where date>='" & all & "' and Sr_no>'" & sr_no1 & "'  and products='" & ComboBox4.Items(a1).ToString() & "' ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adapter As New SQLiteDataAdapter(cm)
                Dim table As New DataTable()
                adapter.Fill(table)
                Dim cnt1 As String
                If table.Rows(0)(0).ToString() <> 0 Then
                    cnt1 = table.Rows(0)(0).ToString()
                    Try
                        Dim cm4 As SQLiteCommand
                        cm4 = New SQLiteCommand("select date,sr_no from stock_ledger where date>='" & all & "'  and Sr_no>'" & sr_no1 & "' and products='" & ComboBox4.Items(a1).ToString() & "' ", cn)
                        If cn.State = ConnectionState.Closed Then
                            cn.Open()
                        End If
                        Dim dr As SQLiteDataReader
                        dr = cm4.ExecuteReader()
                        ComboBox1.Items.Clear()
                        ComboBox2.Items.Clear()
                        If dr.HasRows = True Then
                            While dr.Read()
                                ComboBox1.Items.Add(dr(0).ToString())
                                ComboBox2.Items.Add(dr(1).ToString())
                            End While
                            dr.Close()
                        End If
                        dr.Close()
                    Catch ex As Exception
                        MsgBox(ex.Message)
                    Finally
                        If cn.State = ConnectionState.Open Then
                            cn.Close()
                        End If
                    End Try
                    For i1 = 0 To cnt1 - 1
                        cmd = New SQLiteCommand("update stock_ledger set bal_qty= bal_qty+'" & (pre_qty1) & "'   where date='" & ComboBox1.Items(i1).ToString() & "' and sr_no='" & ComboBox2.Items(i1).ToString() & "'   and Sr_no>'" & sr_no1 & "' and products='" & ComboBox4.Items(a1).ToString() & "' ", cn)
                        cn.Close()
                        cn.Open()
                        'MsgBox(pre_qty)
                        cmd.ExecuteNonQuery()
                        'MsgBox("update other")
                        cn.Close()
                        cn.Open()
aa1:
                    Next i1
                End If
                cmd = New SQLiteCommand("delete from stock_ledger where  Bill_No='" & TextBox2.Text & "' AND source='" & source & "' and products='" & ComboBox4.Items(a1).ToString() & "'", cn)
                cn.Close()
                cn.Open()
                cmd.ExecuteNonQuery()
                cmd.Dispose()
                cn.Close()
                cn.Open()
            Next
            '.................................................end product stock updation.......................
            cmd = New SQLiteCommand("delete from inner_sale where  Bill_No='" & TextBox2.Text & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            cn.Close()
            cn.Open()
            '.........................................................
            cmd = New SQLiteCommand("delete from outer_sale where  Bill_No='" & TextBox2.Text & "'", cn)
            cn.Close()
            cn.Open()
            cmd.ExecuteNonQuery()
            cmd.Dispose()
            LogDetails(Module1.User, "Deleted Sale No. " & TextBox2.Text & ". Amount " & TextBox20.Text & ".")

            cn.Close()
            cn.Open()
            If sale_l3 Then
                GoTo st
            End If
            '........................................................................................
            MsgBox("Sucessfully Deleted", MsgBoxStyle.Information)
            cn.Close()
            Module1.new_sale()
st:
            cn.Close()
            If sale_l3 Then
                sale_l3 = False
                MsgBox("Sucessfully Deleted", MsgBoxStyle.Information)
            End If
            Me.Close()
        End If
    End Sub
    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles btn_search.Click
        Home.Panel1.Visible = True
        sale_ledger.MdiParent = Me.MdiParent
        If sale_ledger.WindowState = FormWindowState.Minimized Then
            sale_ledger.WindowState = FormWindowState.Normal
        End If
        sale_ledger.Show()
        sale_ledger.BringToFront()
    End Sub
    Public Function openfo(ByVal ThisOne As Form) As Form
        Return CType(Activator.CreateInstance(ThisOne.GetType()), Form)
    End Function
    Private Sub print(e, se)
        If client_name.Text = "" Then
            MsgBox("Please Select client first", MsgBoxStyle.Exclamation)
            owntext.Focus()
            Exit Sub
        Else
            If lbl_GSTINs <> "" Then
                client_GSTIN = lbl_GSTINs
            End If
        End If
        company.lbl_db_path.Text = "edit"
        company.company_Load(e, se)
        If company.c6.Text <> "" Then
            company_GSTIN = company.c6.Text
        End If
        '..........SMS..............
        If sms_setting = "Yes" Then
            Dim msg As String = ""
            Dim mob_no As Integer = 0
            Try
                cmd = New SQLiteCommand("select Value from SMS_Setting ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adaptert As New SQLiteDataAdapter(cmd)
                Dim tablet As New DataTable()
                adaptert.Fill(tablet)
                link = tablet.Rows(0)(0).ToString()
                '..................................
                '.....................................................
                cmd = New SQLiteCommand("select Text from SMS_Text ", cn)
                If cn.State = ConnectionState.Closed Then
                    cn.Open()
                End If
                Dim adapter As New SQLiteDataAdapter(cmd)
                Dim table As New DataTable()
                adapter.Fill(table)
                msg = table.Rows(0)(0).ToString()
                '..................................
                'cmd = New SQLiteCommand("select Mobile_No from client where name='" & client_name.Text & "' ", cn)
                'If cn.State = ConnectionState.Closed Then
                '    cn.Open()
                'End If
                'Dim adapter22 As New SQLiteDataAdapter(cmd)
                'Dim table22 As New DataTable()
                'adapter22.Fill(table22)
                'mob_no = table22.Rows(0)(0).ToString()
                ''..................................
            Catch ex As Exception
                MsgBox(ex.Message)
            Finally
            End Try
            Dim st As String
            Dim webapi As String
            Dim request As HttpWebRequest
            Dim responce As HttpWebResponse
            Dim url As String
            Dim st1 As Integer
            webapi = link
            webapi = webapi.Replace("@Mobile", client_contact).Replace("@Message", msg)
            url = webapi
            ' url = link & "&username=" & username & "&password=" & password & "&sender=" & senderid & "&to=" + row.Cells("Mob").Value.ToString() & "&message=" + (msg.Text) & ""
            ' MsgBox(url)
            ' st3 = st3.Replace("@MobileNo", st1).Replace("@Message", st2)
            Try
                request = DirectCast(WebRequest.Create(url), HttpWebRequest)
                responce = DirectCast(request.GetResponse(), HttpWebResponse)
                MsgBox("SMS Sent")
            Catch ex As Exception
                MsgBox("Sms Not Send")
                MsgBox("Please Chack Your Web API")
            End Try
        End If
        '..........................End SMS............................
        Cursor = Cursors.WaitCursor
        Timer1.Enabled = True
        Dim rpt As New ReportDocument
        'rpt.Load("Reports\CrystalReport1.rpt")
        If company_GSTIN = client_GSTIN Then
            If EWB_print = "Yes" Then
                If A5_print = "Yes" Then
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_A5.rpt")
                ElseIf th_print = "Yes" Then
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_Thermal.rpt")
                Else
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_A4.rpt")
                End If
            Else
                If A5_print = "Yes" Then
                    rpt.Load("Reports\rpt_sale_general_A5_state.rpt")
                ElseIf th_print = "Yes" Then
                    rpt.Load("Reports\rpt_sale_general_Thermal_state.rpt")
                Else
                    rpt.Load("Reports\rpt_sale_general_A4_state.rpt")
                End If
            End If
        Else
            If EWB_print = "Yes" Then
                If A5_print = "Yes" Then
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_A5.rpt")
                ElseIf th_print = "Yes" Then
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_Thermal.rpt")
                Else
                    rpt.Load("Reports\EWB_Format\rpt_sale_eway_A4.rpt")
                End If
            Else
                If A5_print = "Yes" Then
                    rpt.Load("Reports\rpt_sale_general_A5.rpt")
                ElseIf th_print = "Yes" Then
                    rpt.Load("Reports\rpt_sale_general_Thermal.rpt")
                Else
                    rpt.Load("Reports\rpt_sale_general_A4.rpt")
                End If
            End If
        End If


        '---------------------------------------------------------------------------------------------
        'Dim rpt As New CrystalReport1 'The report you created.
        Dim cmpt As String = Home.lbl_cmp.Text
        Dim dir As String = cmpt + "\LOGO\"
        'Dim dir As String = "LOGO\"
        'Dim di As DirectoryInfo = New DirectoryInfo(dir)
        Dim di As New IO.DirectoryInfo(dir)
        Dim diar1 As IO.FileInfo() = di.GetFiles()
        Dim dra As IO.FileInfo
        Dim logo_path As String = ""
        If di.Exists Then
            'Dim files() As String = IO.Directory.GetFiles(dir)
            For Each dra In diar1
                logo_path = dir + dra.ToString
            Next
        Else
            logo_path = ""
        End If
        Dim appPath As String = Application.StartupPath
        'Dim a As String = appPath + "\" + logo_path
        Dim a As String = logo_path
        cmd = New SQLiteCommand("select direct from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter2 As New SQLiteDataAdapter(cmd)
        Dim table2 As New DataTable()
        adapter2.Fill(table2)
        Dim direct As String
        direct = table2.Rows(0)(0).ToString()
        '...........................
        cmd = New SQLiteCommand("select original from print", cn)
        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If
        Dim adapter3 As New SQLiteDataAdapter(cmd)
        Dim table3 As New DataTable()
        adapter3.Fill(table3)
        Dim original As String
        original = table3.Rows(0)(0).ToString()
        '...................................................
        If original_duplicate = "No" Then
            If direct = "Yes" And original = "Yes" Then
                For i As Integer = 1 To 4
                    Try

                        Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                        Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                        Dim myDS As New dataset_eway 'The DataSet you created.
                        'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                        Dim cnt As Integer = DataGridView1.Rows.Count - 2
                        Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                        myDS.hsn_gst.Rows.Clear()
                        DataGridView2.Rows.Clear()

                        Dim ct As Integer = 0

                        For t As Integer = 0 To cnt
                            ct = ct + 1
                            Dim ctt As Integer = 0
                            Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                            Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                            Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                            Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                            Dim sgstval As Double = 0
                            Dim cgstval As Double = 0
                            Dim igstval As Double = 0
                            Dim taxable As Double = 0
                            taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                            sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                            cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                            igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                            DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                        Next t
                        Dim intI, intJ As Integer
                        For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                            For intJ = intI - 1 To 0 Step -1

                                If company_GSTIN = client_GSTIN Then
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                        DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                Else
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                        DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                End If


                            Next
                        Next

                        For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                            myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                        Next
                        'Exit Sub

                        MyCommand.Connection = cn
                        MyCommand1.Connection = cn
                        MyCommand2.Connection = cn
                        MyCommand3.Connection = cn
                        MyCommand4.Connection = cn

                        'MyCommand4.Connection = cn
                        MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                        MyCommand1.CommandText = "SELECT * from Company"
                        MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                        MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                        MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' where is_print='True'"

                        'MyCommand4.CommandText = "select * from bank_account"
                        'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                        ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                        MyCommand.CommandType = CommandType.Text
                        MyCommand1.CommandType = CommandType.Text
                        MyCommand2.CommandType = CommandType.Text
                        ' MsgBox(client_name.Text)
                        MyCommand3.CommandType = CommandType.Text
                        MyCommand4.CommandType = CommandType.Text

                        'Dim new1 As New 
                        myDA.SelectCommand = MyCommand
                        myDA1.SelectCommand = MyCommand1
                        myDA2.SelectCommand = MyCommand2
                        myDA3.SelectCommand = MyCommand3
                        myDA4.SelectCommand = MyCommand4

                        'myDA4.SelectCommand = MyCommand3
                        myDA.Fill(myDS, "outer_sale")
                        myDA3.Fill(myDS, "client")
                        myDA2.Fill(myDS, "inner_sale")
                        myDA1.Fill(myDS, "Company")
                        myDA4.Fill(myDS, "bank_account")
                        rpt.SetDataSource(myDS)
                        If myDS.bank_account.Rows.Count > 0 Then
                            rpt.SetParameterValue("is_bank", 0)
                        Else
                            rpt.SetParameterValue("is_bank", 1)
                        End If
                        If i = 1 Then
                            rpt.SetParameterValue("original_duplicate", "Original For Recipient")
                        End If
                        If i = 2 Then
                            rpt.SetParameterValue("original_duplicate", "Duplicate For Transporter")
                        End If
                        If i = 3 Then
                            rpt.SetParameterValue("original_duplicate", "Triplicate For Transporter")
                        End If
                        If i = 4 Then
                            rpt.SetParameterValue("original_duplicate", "Quadruplicate")
                        End If
                        rpt.SetParameterValue("logo", a)
                        rpt.SetParameterValue("gst5", gst5())
                        rpt.SetParameterValue("gst12", gst12())
                        rpt.SetParameterValue("gst18", gst18())
                        rpt.SetParameterValue("gst28", gst28())
                        rpt.SetParameterValue("igst5", igst5())
                        rpt.SetParameterValue("igst12", igst12())
                        rpt.SetParameterValue("igst18", igst18())
                        rpt.SetParameterValue("igst28", igst28())
                        rpt.SetParameterValue("tot_GST", total_gst())
                        rpt.SetParameterValue("tot_IGST", total_igst())
                        rpt.SetParameterValue("tot_CESS", total_cess())
                        rpt.SetParameterValue("taxable_5", taxable_5())
                        rpt.SetParameterValue("taxable_12", taxable_12())
                        rpt.SetParameterValue("taxable_18", taxable_18())
                        rpt.SetParameterValue("taxable_28", taxable_28())
                        rpt.SetParameterValue("tax", tax)
                        If Home.lbl_logo.Text = "No" Then
                            rpt.SetParameterValue("logo_sup", 1)
                        Else
                            rpt.SetParameterValue("logo_sup", 0)
                        End If
                        rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                        'rpt.SetParameterValue("p3", Today)
                        frmPrint.CrystalReportViewer1.ReportSource = rpt
                        'frmPrint.ShowDialog()
                        Dim docprint As System.Drawing.Printing.PrintDocument
                        docprint = New System.Drawing.Printing.PrintDocument
                        Dim dfdPrinter As String = docprint.PrinterSettings.PrinterName
                        rpt.PrintOptions.PrinterName = dfdPrinter
                        rpt.PrintToPrinter(1, False, 0, 0)
                    Catch ex As Exception
                        MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                    End Try
                Next
            End If
            If direct = "Yes" And original = "No" Then
                Try
                    'Dim rpt As New ReportDocument
                    ''Dim rpt As New rptSale 'The report you created.
                    'rpt.Load("Reports\rptSale.rpt")
                    ' Dim myConnection As SqlConnection
                    Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                    Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                    Dim myDS As New dataset_eway 'The DataSet you created.
                    'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                    Dim cnt As Integer = DataGridView1.Rows.Count - 2
                    Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                    myDS.hsn_gst.Rows.Clear()
                    DataGridView2.Rows.Clear()

                    Dim ct As Integer = 0

                    For t As Integer = 0 To cnt
                        ct = ct + 1
                        Dim ctt As Integer = 0
                        Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                        Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                        Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                        Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                        Dim sgstval As Double = 0
                        Dim cgstval As Double = 0
                        Dim igstval As Double = 0
                        Dim taxable As Double = 0
                        taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                        sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                        cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                        igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                        DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                    Next t
                    Dim intI, intJ As Integer
                    For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                        For intJ = intI - 1 To 0 Step -1

                            If company_GSTIN = client_GSTIN Then
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                    DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            Else
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                    DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            End If


                        Next
                    Next

                    For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                        myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                    Next
                    'Exit Sub

                    MyCommand.Connection = cn
                    MyCommand1.Connection = cn
                    MyCommand2.Connection = cn
                    MyCommand3.Connection = cn
                    MyCommand4.Connection = cn

                    'MyCommand4.Connection = cn
                    MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                    MyCommand1.CommandText = "SELECT * from Company"
                    MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                    MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                    MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                    'MyCommand4.CommandText = "select * from bank_account"
                    'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                    ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                    MyCommand.CommandType = CommandType.Text
                    MyCommand1.CommandType = CommandType.Text
                    MyCommand2.CommandType = CommandType.Text
                    ' MsgBox(client_name.Text)
                    MyCommand3.CommandType = CommandType.Text
                    MyCommand4.CommandType = CommandType.Text

                    'Dim new1 As New 
                    myDA.SelectCommand = MyCommand
                    myDA1.SelectCommand = MyCommand1
                    myDA2.SelectCommand = MyCommand2
                    myDA3.SelectCommand = MyCommand3
                    myDA4.SelectCommand = MyCommand4

                    'myDA4.SelectCommand = MyCommand3
                    myDA.Fill(myDS, "outer_sale")
                    myDA3.Fill(myDS, "client")
                    myDA2.Fill(myDS, "inner_sale")
                    myDA1.Fill(myDS, "Company")
                    myDA4.Fill(myDS, "bank_account")
                    'myDA4.Fill(myDS, "bank_account")
                    rpt.SetDataSource(myDS)
                    If myDS.bank_account.Rows.Count > 0 Then
                        rpt.SetParameterValue("is_bank", 0)
                    Else
                        rpt.SetParameterValue("is_bank", 1)
                    End If
                    rpt.SetParameterValue("original_duplicate", "")
                    rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                    rpt.SetParameterValue("logo", a)
                    rpt.SetParameterValue("gst5", gst5())
                    rpt.SetParameterValue("gst12", gst12())
                    rpt.SetParameterValue("gst18", gst18())
                    rpt.SetParameterValue("gst28", gst28())
                    rpt.SetParameterValue("igst5", igst5())
                    rpt.SetParameterValue("igst12", igst12())
                    rpt.SetParameterValue("igst18", igst18())
                    rpt.SetParameterValue("igst28", igst28())
                    rpt.SetParameterValue("tot_GST", total_gst())
                    rpt.SetParameterValue("tot_IGST", total_igst())
                    rpt.SetParameterValue("tot_CESS", total_cess())
                    rpt.SetParameterValue("taxable_5", taxable_5())
                    rpt.SetParameterValue("taxable_12", taxable_12())
                    rpt.SetParameterValue("taxable_18", taxable_18())
                    rpt.SetParameterValue("taxable_28", taxable_28())
                    rpt.SetParameterValue("tax", tax)
                    If Home.lbl_logo.Text = "No" Then
                        rpt.SetParameterValue("logo_sup", 1)
                    Else
                        rpt.SetParameterValue("logo_sup", 0)
                    End If
                    frmPrint.CrystalReportViewer1.ReportSource = rpt
                    'frmPrint.ShowDialog()
                    Dim docprint As System.Drawing.Printing.PrintDocument
                    docprint = New System.Drawing.Printing.PrintDocument
                    Dim dfdPrinter As String = docprint.PrinterSettings.PrinterName
                    rpt.PrintOptions.PrinterName = dfdPrinter
                    rpt.PrintToPrinter(1, False, 0, 0)
                Catch ex As Exception
                    MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
            If direct = "No" And original = "No" Then
                'Try

                ' Dim myConnection As SqlConnection
                Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                Dim myDS As New dataset_eway 'The DataSet you created.
                'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                Dim cnt As Integer = DataGridView1.Rows.Count - 2
                Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                myDS.hsn_gst.Rows.Clear()
                DataGridView2.Rows.Clear()

                Dim ct As Integer = 0

                For t As Integer = 0 To cnt
                    ct = ct + 1
                    Dim ctt As Integer = 0
                    Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                    Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                    Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                    Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                    Dim sgstval As Double = 0
                    Dim cgstval As Double = 0
                    Dim igstval As Double = 0
                    Dim taxable As Double = 0
                    taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                    sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                    cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                    igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                    DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                Next t
                Dim intI, intJ As Integer
                For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                    For intJ = intI - 1 To 0 Step -1

                        If company_GSTIN = client_GSTIN Then
                            If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                DataGridView2.Rows.RemoveAt(intI)

                                Exit For
                            End If
                        Else
                            If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                DataGridView2.Rows.RemoveAt(intI)

                                Exit For
                            End If
                        End If


                    Next
                Next

                For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                    myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                Next
                'Exit Sub

                MyCommand.Connection = cn
                MyCommand1.Connection = cn
                MyCommand2.Connection = cn
                MyCommand3.Connection = cn
                MyCommand4.Connection = cn

                'MyCommand4.Connection = cn
                MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                MyCommand1.CommandText = "SELECT * from Company"
                MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                'MyCommand4.CommandText = "select * from bank_account"
                'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                MyCommand.CommandType = CommandType.Text
                MyCommand1.CommandType = CommandType.Text
                MyCommand2.CommandType = CommandType.Text
                ' MsgBox(client_name.Text)
                MyCommand3.CommandType = CommandType.Text
                MyCommand4.CommandType = CommandType.Text

                'Dim new1 As New 
                myDA.SelectCommand = MyCommand
                myDA1.SelectCommand = MyCommand1
                myDA2.SelectCommand = MyCommand2
                myDA3.SelectCommand = MyCommand3
                myDA4.SelectCommand = MyCommand4

                'myDA4.SelectCommand = MyCommand3
                myDA.Fill(myDS, "outer_sale")
                myDA3.Fill(myDS, "client")
                myDA2.Fill(myDS, "inner_sale")
                myDA1.Fill(myDS, "Company")
                myDA4.Fill(myDS, "bank_account")
                'MsgBox(myDS.bank_account.Rows.Count)
                'myDA4.Fill(myDS, "bank_account")
                rpt.SetDataSource(myDS)
                If myDS.bank_account.Rows.Count > 0 Then
                    rpt.SetParameterValue("is_bank", 0)
                Else
                    rpt.SetParameterValue("is_bank", 1)
                End If
                rpt.SetParameterValue("original_duplicate", "")
                rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                rpt.SetParameterValue("logo", a)
                rpt.SetParameterValue("gst5", gst5())
                rpt.SetParameterValue("gst12", gst12())
                rpt.SetParameterValue("gst18", gst18())
                rpt.SetParameterValue("gst28", gst28())
                rpt.SetParameterValue("igst5", igst5())
                rpt.SetParameterValue("igst12", igst12())
                rpt.SetParameterValue("igst18", igst18())
                rpt.SetParameterValue("igst28", igst28())
                rpt.SetParameterValue("tot_GST", total_gst())
                rpt.SetParameterValue("tot_IGST", total_igst())
                rpt.SetParameterValue("tot_CESS", total_cess())
                rpt.SetParameterValue("taxable_5", taxable_5())
                rpt.SetParameterValue("taxable_12", taxable_12())
                rpt.SetParameterValue("taxable_18", taxable_18())
                rpt.SetParameterValue("taxable_28", taxable_28())
                rpt.SetParameterValue("tax", tax)

                If Home.lbl_logo.Text = "No" Then
                    rpt.SetParameterValue("logo_sup", 1)
                Else
                    rpt.SetParameterValue("logo_sup", 0)
                End If

                frmPrint.CrystalReportViewer1.ReportSource = rpt
                frmPrint.ShowDialog()
                'Catch ex As Exception
                '    MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                'End Try
            End If
            If direct = "No" And original = "Yes" Then
                For i As Integer = 1 To 4
                    Try
                        ' Dim myConnection As SqlConnection
                        Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                        Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                        Dim myDS As New dataset_eway 'The DataSet you created.
                        'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                        Dim cnt As Integer = DataGridView1.Rows.Count - 2
                        Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                        myDS.hsn_gst.Rows.Clear()
                        DataGridView2.Rows.Clear()

                        Dim ct As Integer = 0

                        For t As Integer = 0 To cnt
                            ct = ct + 1
                            Dim ctt As Integer = 0
                            Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                            Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                            Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                            Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                            Dim sgstval As Double = 0
                            Dim cgstval As Double = 0
                            Dim igstval As Double = 0
                            Dim taxable As Double = 0
                            taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                            sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                            cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                            igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                            DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                        Next t
                        Dim intI, intJ As Integer
                        For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                            For intJ = intI - 1 To 0 Step -1

                                If company_GSTIN = client_GSTIN Then
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                        DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                Else
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                        DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                End If


                            Next
                        Next

                        For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                            myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                        Next
                        'Exit Sub

                        MyCommand.Connection = cn
                        MyCommand1.Connection = cn
                        MyCommand2.Connection = cn
                        MyCommand3.Connection = cn
                        MyCommand4.Connection = cn

                        'MyCommand4.Connection = cn
                        MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                        MyCommand1.CommandText = "SELECT * from Company"
                        MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                        MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                        MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                        'MyCommand4.CommandText = "select * from bank_account"
                        'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                        ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                        MyCommand.CommandType = CommandType.Text
                        MyCommand1.CommandType = CommandType.Text
                        MyCommand2.CommandType = CommandType.Text
                        ' MsgBox(client_name.Text)
                        MyCommand3.CommandType = CommandType.Text
                        MyCommand4.CommandType = CommandType.Text

                        'Dim new1 As New 
                        myDA.SelectCommand = MyCommand
                        myDA1.SelectCommand = MyCommand1
                        myDA2.SelectCommand = MyCommand2
                        myDA3.SelectCommand = MyCommand3
                        myDA4.SelectCommand = MyCommand4

                        'myDA4.SelectCommand = MyCommand3
                        myDA.Fill(myDS, "outer_sale")
                        myDA3.Fill(myDS, "client")
                        myDA2.Fill(myDS, "inner_sale")
                        myDA1.Fill(myDS, "Company")
                        myDA4.Fill(myDS, "bank_account")
                        'myDA4.Fill(myDS, "bank_account")
                        rpt.SetDataSource(myDS)
                        If myDS.bank_account.Rows.Count > 0 Then
                            rpt.SetParameterValue("is_bank", 0)
                        Else
                            rpt.SetParameterValue("is_bank", 1)
                        End If
                        'rpt.SetParameterValue("p1", dtpDateFrom.Value.Date)
                        'rpt.SetParameterValue("p2", dtpDateTo.Value.Date)
                        'rpt.SetParameterValue("p3", Today)
                        If i = 1 Then
                            rpt.SetParameterValue("original_duplicate", "Original For Recipient")
                        End If
                        If i = 2 Then
                            rpt.SetParameterValue("original_duplicate", "Duplicate For Transporter")
                        End If
                        If i = 3 Then
                            rpt.SetParameterValue("original_duplicate", "Triplicate For Transporter")
                        End If
                        If i = 4 Then
                            rpt.SetParameterValue("original_duplicate", "Quadruplicate")
                        End If
                        rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                        rpt.SetParameterValue("logo", a)
                        rpt.SetParameterValue("gst5", gst5())
                        rpt.SetParameterValue("gst12", gst12())
                        rpt.SetParameterValue("gst18", gst18())
                        rpt.SetParameterValue("gst28", gst28())
                        rpt.SetParameterValue("igst5", igst5())
                        rpt.SetParameterValue("igst12", igst12())
                        rpt.SetParameterValue("igst18", igst18())
                        rpt.SetParameterValue("igst28", igst28())
                        rpt.SetParameterValue("tot_GST", total_gst())
                        rpt.SetParameterValue("tot_IGST", total_igst())
                        rpt.SetParameterValue("tot_CESS", total_cess())
                        rpt.SetParameterValue("taxable_5", taxable_5())
                        rpt.SetParameterValue("taxable_12", taxable_12())
                        rpt.SetParameterValue("taxable_18", taxable_18())
                        rpt.SetParameterValue("taxable_28", taxable_28())
                        rpt.SetParameterValue("tax", tax)
                        If Home.lbl_logo.Text = "No" Then
                            rpt.SetParameterValue("logo_sup", 1)
                        Else
                            rpt.SetParameterValue("logo_sup", 0)
                        End If
                        Dim myForm4 As New frmPrint
                        myForm4.CrystalReportViewer1.ReportSource = rpt
                        myForm4.ShowDialog()
                    Catch ex As Exception
                        MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                    End Try
                Next
            End If
        Else
            If direct = "Yes" And original_duplicate = "Yes" Then
                For i As Integer = 1 To 2
                    Try
                        'Dim rpt As New ReportDocument
                        ''Dim rpt As New rptSale 'The report you created.
                        'rpt.Load("Reports\rptSale.rpt")
                        ' Dim myConnection As SqlConnection
                        Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                        Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                        Dim myDS As New dataset_eway 'The DataSet you created.
                        'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                        Dim cnt As Integer = DataGridView1.Rows.Count - 2
                        Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                        myDS.hsn_gst.Rows.Clear()
                        DataGridView2.Rows.Clear()

                        Dim ct As Integer = 0

                        For t As Integer = 0 To cnt
                            ct = ct + 1
                            Dim ctt As Integer = 0
                            Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                            Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                            Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                            Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                            Dim sgstval As Double = 0
                            Dim cgstval As Double = 0
                            Dim igstval As Double = 0
                            Dim taxable As Double = 0
                            taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                            sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                            cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                            igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                            DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                        Next t
                        Dim intI, intJ As Integer
                        For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                            For intJ = intI - 1 To 0 Step -1

                                If company_GSTIN = client_GSTIN Then
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                        DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                Else
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                        DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                End If


                            Next
                        Next

                        For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                            myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                        Next
                        'Exit Sub

                        MyCommand.Connection = cn
                        MyCommand1.Connection = cn
                        MyCommand2.Connection = cn
                        MyCommand3.Connection = cn
                        MyCommand4.Connection = cn

                        'MyCommand4.Connection = cn
                        MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                        MyCommand1.CommandText = "SELECT * from Company"
                        MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                        MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                        MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                        'MyCommand4.CommandText = "select * from bank_account"
                        'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                        ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                        MyCommand.CommandType = CommandType.Text
                        MyCommand1.CommandType = CommandType.Text
                        MyCommand2.CommandType = CommandType.Text
                        ' MsgBox(client_name.Text)
                        MyCommand3.CommandType = CommandType.Text
                        MyCommand4.CommandType = CommandType.Text

                        'Dim new1 As New 
                        myDA.SelectCommand = MyCommand
                        myDA1.SelectCommand = MyCommand1
                        myDA2.SelectCommand = MyCommand2
                        myDA3.SelectCommand = MyCommand3
                        myDA4.SelectCommand = MyCommand4

                        'myDA4.SelectCommand = MyCommand3
                        myDA.Fill(myDS, "outer_sale")
                        myDA3.Fill(myDS, "client")
                        myDA2.Fill(myDS, "inner_sale")
                        myDA1.Fill(myDS, "Company")
                        myDA4.Fill(myDS, "bank_account")
                        'myDA4.Fill(myDS, "bank_account")
                        rpt.SetDataSource(myDS)
                        If myDS.bank_account.Rows.Count > 0 Then
                            rpt.SetParameterValue("is_bank", 0)
                        Else
                            rpt.SetParameterValue("is_bank", 1)
                        End If
                        If i = 1 Then
                            rpt.SetParameterValue("original_duplicate", "Original For Recipient")
                        End If
                        If i = 2 Then
                            rpt.SetParameterValue("original_duplicate", "Duplicate For Transporter")
                        End If
                        rpt.SetParameterValue("logo", a)
                        rpt.SetParameterValue("gst5", gst5())
                        rpt.SetParameterValue("gst12", gst12())
                        rpt.SetParameterValue("gst18", gst18())
                        rpt.SetParameterValue("gst28", gst28())
                        rpt.SetParameterValue("igst5", igst5())
                        rpt.SetParameterValue("igst12", igst12())
                        rpt.SetParameterValue("igst18", igst18())
                        rpt.SetParameterValue("igst28", igst28())
                        rpt.SetParameterValue("tot_GST", total_gst())
                        rpt.SetParameterValue("tot_IGST", total_igst())
                        rpt.SetParameterValue("tot_CESS", total_cess())
                        rpt.SetParameterValue("taxable_5", taxable_5())
                        rpt.SetParameterValue("taxable_12", taxable_12())
                        rpt.SetParameterValue("taxable_18", taxable_18())
                        rpt.SetParameterValue("taxable_28", taxable_28())
                        rpt.SetParameterValue("tax", tax)
                        If Home.lbl_logo.Text = "No" Then
                            rpt.SetParameterValue("logo_sup", 1)
                        Else
                            rpt.SetParameterValue("logo_sup", 0)
                        End If
                        rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                        'rpt.SetParameterValue("p3", Today)
                        frmPrint.CrystalReportViewer1.ReportSource = rpt
                        'frmPrint.ShowDialog()
                        Dim docprint As System.Drawing.Printing.PrintDocument
                        docprint = New System.Drawing.Printing.PrintDocument
                        Dim dfdPrinter As String = docprint.PrinterSettings.PrinterName
                        rpt.PrintOptions.PrinterName = dfdPrinter
                        rpt.PrintToPrinter(1, False, 0, 0)
                    Catch ex As Exception
                        MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                    End Try
                Next
            End If
            If direct = "Yes" And original_duplicate = "No" Then
                Try
                    'Dim rpt As New ReportDocument
                    ''Dim rpt As New rptSale 'The report you created.
                    'rpt.Load("Reports\rptSale.rpt")
                    ' Dim myConnection As SqlConnection
                    Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                    Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                    Dim myDS As New dataset_eway 'The DataSet you created.
                    'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                    Dim cnt As Integer = DataGridView1.Rows.Count - 2
                    Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                    myDS.hsn_gst.Rows.Clear()
                    DataGridView2.Rows.Clear()

                    Dim ct As Integer = 0

                    For t As Integer = 0 To cnt
                        ct = ct + 1
                        Dim ctt As Integer = 0
                        Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                        Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                        Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                        Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                        Dim sgstval As Double = 0
                        Dim cgstval As Double = 0
                        Dim igstval As Double = 0
                        Dim taxable As Double = 0
                        taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                        sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                        cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                        igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                        DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                    Next t
                    Dim intI, intJ As Integer
                    For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                        For intJ = intI - 1 To 0 Step -1

                            If company_GSTIN = client_GSTIN Then
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                    DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            Else
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                    DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            End If


                        Next
                    Next

                    For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                        myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                    Next
                    'Exit Sub

                    MyCommand.Connection = cn
                    MyCommand1.Connection = cn
                    MyCommand2.Connection = cn
                    MyCommand3.Connection = cn
                    MyCommand4.Connection = cn

                    'MyCommand4.Connection = cn
                    MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                    MyCommand1.CommandText = "SELECT * from Company"
                    MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                    MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                    MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                    'MyCommand4.CommandText = "select * from bank_account"
                    'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                    ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                    MyCommand.CommandType = CommandType.Text
                    MyCommand1.CommandType = CommandType.Text
                    MyCommand2.CommandType = CommandType.Text
                    ' MsgBox(client_name.Text)
                    MyCommand3.CommandType = CommandType.Text
                    MyCommand4.CommandType = CommandType.Text

                    'Dim new1 As New 
                    myDA.SelectCommand = MyCommand
                    myDA1.SelectCommand = MyCommand1
                    myDA2.SelectCommand = MyCommand2
                    myDA3.SelectCommand = MyCommand3
                    myDA4.SelectCommand = MyCommand4

                    'myDA4.SelectCommand = MyCommand3
                    myDA.Fill(myDS, "outer_sale")
                    myDA3.Fill(myDS, "client")
                    myDA2.Fill(myDS, "inner_sale")
                    myDA1.Fill(myDS, "Company")
                    myDA4.Fill(myDS, "bank_account")
                    'myDA4.Fill(myDS, "bank_account")
                    rpt.SetDataSource(myDS)
                    If myDS.bank_account.Rows.Count > 0 Then
                        rpt.SetParameterValue("is_bank", 0)
                    Else
                        rpt.SetParameterValue("is_bank", 1)
                    End If
                    'rpt.SetParameterValue("p1", dtpDateFrom.Value.Date)
                    'rpt.SetParameterValue("p2", dtpDateTo.Value.Date)
                    'rpt.SetParameterValue("p3", Today)
                    rpt.SetParameterValue("original_duplicate", "")
                    rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                    rpt.SetParameterValue("logo", a)
                    rpt.SetParameterValue("gst5", gst5())
                    rpt.SetParameterValue("gst12", gst12())
                    rpt.SetParameterValue("gst18", gst18())
                    rpt.SetParameterValue("gst28", gst28())
                    rpt.SetParameterValue("igst5", igst5())
                    rpt.SetParameterValue("igst12", igst12())
                    rpt.SetParameterValue("igst18", igst18())
                    rpt.SetParameterValue("igst28", igst28())
                    rpt.SetParameterValue("tot_GST", total_gst())
                    rpt.SetParameterValue("tot_IGST", total_igst())
                    rpt.SetParameterValue("tot_CESS", total_cess())
                    rpt.SetParameterValue("taxable_5", taxable_5())
                    rpt.SetParameterValue("taxable_12", taxable_12())
                    rpt.SetParameterValue("taxable_18", taxable_18())
                    rpt.SetParameterValue("taxable_28", taxable_28())
                    rpt.SetParameterValue("tax", tax)
                    If Home.lbl_logo.Text = "No" Then
                        rpt.SetParameterValue("logo_sup", 1)
                    Else
                        rpt.SetParameterValue("logo_sup", 0)
                    End If
                    frmPrint.CrystalReportViewer1.ReportSource = rpt
                    'frmPrint.ShowDialog()
                    Dim docprint As System.Drawing.Printing.PrintDocument
                    docprint = New System.Drawing.Printing.PrintDocument
                    Dim dfdPrinter As String = docprint.PrinterSettings.PrinterName
                    rpt.PrintOptions.PrinterName = dfdPrinter
                    rpt.PrintToPrinter(1, False, 0, 0)
                Catch ex As Exception
                    MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
            If direct = "No" And original_duplicate = "No" Then
                Try
                    ' Dim myConnection As SqlConnection
                    Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                    Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                    Dim myDS As New dataset_eway 'The DataSet you created.
                    'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                    Dim cnt As Integer = DataGridView1.Rows.Count - 2
                    Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                    myDS.hsn_gst.Rows.Clear()
                    DataGridView2.Rows.Clear()

                    Dim ct As Integer = 0

                    For t As Integer = 0 To cnt
                        ct = ct + 1
                        Dim ctt As Integer = 0
                        Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                        Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                        Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                        Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                        Dim sgstval As Double = 0
                        Dim cgstval As Double = 0
                        Dim igstval As Double = 0
                        Dim taxable As Double = 0
                        taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                        sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                        cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                        igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                        DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                    Next t
                    Dim intI, intJ As Integer
                    For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                        For intJ = intI - 1 To 0 Step -1

                            If company_GSTIN = client_GSTIN Then
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                    DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            Else
                                If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                    DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                    DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                    'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                    DataGridView2.Rows.RemoveAt(intI)

                                    Exit For
                                End If
                            End If


                        Next
                    Next

                    For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                        myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                    Next
                    'Exit Sub

                    MyCommand.Connection = cn
                    MyCommand1.Connection = cn
                    MyCommand2.Connection = cn
                    MyCommand3.Connection = cn
                    MyCommand4.Connection = cn

                    'MyCommand4.Connection = cn
                    MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                    MyCommand1.CommandText = "SELECT * from Company"
                    MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                    MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                    MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                    'MyCommand4.CommandText = "select * from bank_account"
                    'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                    ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                    MyCommand.CommandType = CommandType.Text
                    MyCommand1.CommandType = CommandType.Text
                    MyCommand2.CommandType = CommandType.Text
                    ' MsgBox(client_name.Text)
                    MyCommand3.CommandType = CommandType.Text
                    MyCommand4.CommandType = CommandType.Text

                    'Dim new1 As New 
                    myDA.SelectCommand = MyCommand
                    myDA1.SelectCommand = MyCommand1
                    myDA2.SelectCommand = MyCommand2
                    myDA3.SelectCommand = MyCommand3
                    myDA4.SelectCommand = MyCommand4

                    'myDA4.SelectCommand = MyCommand3
                    myDA.Fill(myDS, "outer_sale")
                    myDA3.Fill(myDS, "client")
                    myDA2.Fill(myDS, "inner_sale")
                    myDA1.Fill(myDS, "Company")
                    myDA4.Fill(myDS, "bank_account")
                    'myDA4.Fill(myDS, "bank_account")
                    rpt.SetDataSource(myDS)
                    If myDS.bank_account.Rows.Count > 0 Then
                        rpt.SetParameterValue("is_bank", 0)
                    Else
                        rpt.SetParameterValue("is_bank", 1)
                    End If
                    'rpt.SetParameterValue("p1", dtpDateFrom.Value.Date)
                    'rpt.SetParameterValue("p2", dtpDateTo.Value.Date)
                    'rpt.SetParameterValue("p3", Today)
                    rpt.SetParameterValue("original_duplicate", "")
                    rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                    rpt.SetParameterValue("logo", a)
                    rpt.SetParameterValue("gst5", gst5())
                    rpt.SetParameterValue("gst12", gst12())
                    rpt.SetParameterValue("gst18", gst18())
                    rpt.SetParameterValue("gst28", gst28())
                    rpt.SetParameterValue("igst5", igst5())
                    rpt.SetParameterValue("igst12", igst12())
                    rpt.SetParameterValue("igst18", igst18())
                    rpt.SetParameterValue("igst28", igst28())
                    rpt.SetParameterValue("tot_GST", total_gst())
                    rpt.SetParameterValue("tot_IGST", total_igst())
                    rpt.SetParameterValue("tot_CESS", total_cess())
                    rpt.SetParameterValue("taxable_5", taxable_5())
                    rpt.SetParameterValue("taxable_12", taxable_12())
                    rpt.SetParameterValue("taxable_18", taxable_18())
                    rpt.SetParameterValue("taxable_28", taxable_28())
                    rpt.SetParameterValue("tax", tax)
                    If Home.lbl_logo.Text = "No" Then
                        rpt.SetParameterValue("logo_sup", 1)
                    Else
                        rpt.SetParameterValue("logo_sup", 0)
                    End If
                    frmPrint.CrystalReportViewer1.ReportSource = rpt
                    frmPrint.ShowDialog()
                Catch ex As Exception
                    MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
            If direct = "No" And original_duplicate = "Yes" Then
                For i As Integer = 1 To 2
                    Try
                        ' Dim myConnection As SqlConnection
                        Dim MyCommand, MyCommand1, MyCommand2, MyCommand3, MyCommand4 As New SQLiteCommand()
                        Dim myDA, myDA1, myDA2, myDA3, myDA4 As New SQLiteDataAdapter()
                        Dim myDS As New dataset_eway 'The DataSet you created.
                        'myDS.hsn_gst.Rows.Add("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1")
                        Dim cnt As Integer = DataGridView1.Rows.Count - 2
                        Dim cnt2 As Integer = DataGridView1.Rows.Count - 2

                        myDS.hsn_gst.Rows.Clear()
                        DataGridView2.Rows.Clear()

                        Dim ct As Integer = 0

                        For t As Integer = 0 To cnt
                            ct = ct + 1
                            Dim ctt As Integer = 0
                            Dim sgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGST").Value)
                            Dim cgst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGST").Value)
                            Dim igst As Double = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGST").Value)

                            Dim hsn As String = DataGridView1.Rows(t).Cells("HSN").Value
                            Dim sgstval As Double = 0
                            Dim cgstval As Double = 0
                            Dim igstval As Double = 0
                            Dim taxable As Double = 0
                            taxable = (Convert.ToDouble(DataGridView1.Rows(t).Cells("QTY").Value) * Convert.ToDouble(DataGridView1.Rows(t).Cells("Rate").Value)) - Convert.ToDouble(DataGridView1.Rows(t).Cells("DiscValue").Value)
                            sgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("SGSTVal").Value)
                            cgstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("CGSTVal").Value)
                            igstval = Convert.ToDouble(DataGridView1.Rows(t).Cells("IGSTVal").Value)

                            DataGridView2.Rows.Add(hsn, ct, sgst, sgstval, cgst, cgstval, igst, igstval, "1", "1", taxable)
                        Next t
                        Dim intI, intJ As Integer
                        For intI = DataGridView2.Rows.Count - 1 To 0 Step -1
                            For intJ = intI - 1 To 0 Step -1

                                If company_GSTIN = client_GSTIN Then
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("SGST1").Value = DataGridView2.Rows(intJ).Cells("SGST1").Value Then
                                        DataGridView2.Rows(intJ).Cells("sgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("sgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("sgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("cgstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("cgstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("cgstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)

                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                Else
                                    If DataGridView2.Rows(intI).Cells("HSN1").Value = DataGridView2.Rows(intJ).Cells("HSN1").Value AndAlso DataGridView2.Rows(intI).Cells("igst1").Value = DataGridView2.Rows(intJ).Cells("igst1").Value Then

                                        DataGridView2.Rows(intJ).Cells("igstval1").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("igstval1").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("igstval1").Value)

                                        DataGridView2.Rows(intJ).Cells("taxable").Value = Convert.ToDouble(DataGridView2.Rows(intJ).Cells("taxable").Value) + Convert.ToDouble(DataGridView2.Rows(intI).Cells("taxable").Value)
                                        'MsgBox(DataGridView2.Rows(intI).Cells("Column2").Value)
                                        DataGridView2.Rows.RemoveAt(intI)

                                        Exit For
                                    End If
                                End If


                            Next
                        Next

                        For Each dgr As DataGridViewRow In Me.DataGridView2.Rows
                            myDS.hsn_gst.Rows.Add(dgr.Cells(0).Value, dgr.Cells(1).Value, dgr.Cells(2).Value, dgr.Cells(3).Value, dgr.Cells(4).Value, dgr.Cells(5).Value, dgr.Cells(6).Value, dgr.Cells(7).Value, dgr.Cells(8).Value, dgr.Cells(9).Value, dgr.Cells(10).Value)
                        Next
                        'Exit Sub

                        MyCommand.Connection = cn
                        MyCommand1.Connection = cn
                        MyCommand2.Connection = cn
                        MyCommand3.Connection = cn
                        MyCommand4.Connection = cn

                        'MyCommand4.Connection = cn
                        MyCommand.CommandText = "select * from outer_sale where Bill_No ='" & TextBox2.Text & "' "
                        MyCommand1.CommandText = "SELECT * from Company"
                        MyCommand2.CommandText = "select * from inner_sale where Bill_No ='" & TextBox2.Text & "' order by Sr"
                        MyCommand3.CommandText = "select * from client where name='" & client_name.Text & "' "
                        MyCommand4.CommandText = "select account_name,account_number,IFSC,branch_name,bank_name,current_bal as Mobile_No from bank_account where is_print='True' "

                        'MyCommand4.CommandText = "select * from bank_account"
                        'MyCommand.Parameters.Add("@d1", SqlDbType.DateTime, 30, "Date").Value = dtpDateFrom.Value.Date
                        ' MyCommand.Parameters.Add("@d2", SqlDbType.DateTime, 30, "Date").Value = dtpDateTo.Value.Date
                        MyCommand.CommandType = CommandType.Text
                        MyCommand1.CommandType = CommandType.Text
                        MyCommand2.CommandType = CommandType.Text
                        ' MsgBox(client_name.Text)
                        MyCommand3.CommandType = CommandType.Text
                        MyCommand4.CommandType = CommandType.Text

                        'Dim new1 As New 
                        myDA.SelectCommand = MyCommand
                        myDA1.SelectCommand = MyCommand1
                        myDA2.SelectCommand = MyCommand2
                        myDA3.SelectCommand = MyCommand3
                        myDA4.SelectCommand = MyCommand4

                        'myDA4.SelectCommand = MyCommand3
                        myDA.Fill(myDS, "outer_sale")
                        myDA3.Fill(myDS, "client")
                        myDA2.Fill(myDS, "inner_sale")
                        myDA1.Fill(myDS, "Company")
                        myDA4.Fill(myDS, "bank_account")
                        'myDA4.Fill(myDS, "bank_account")
                        rpt.SetDataSource(myDS)
                        If myDS.bank_account.Rows.Count > 0 Then
                            rpt.SetParameterValue("is_bank", 0)
                        Else
                            rpt.SetParameterValue("is_bank", 1)
                        End If
                        'rpt.SetParameterValue("p1", dtpDateFrom.Value.Date)
                        'rpt.SetParameterValue("p2", dtpDateTo.Value.Date)
                        'rpt.SetParameterValue("p3", Today)
                        If i = 1 Then
                            rpt.SetParameterValue("original_duplicate", "Original For Recipient")
                        End If
                        If i = 2 Then
                            rpt.SetParameterValue("original_duplicate", "Duplicate For Transporter")
                        End If
                        rpt.SetParameterValue("in_word", RupeesToWord(TextBox20.Text))
                        rpt.SetParameterValue("logo", a)
                        rpt.SetParameterValue("gst5", gst5())
                        rpt.SetParameterValue("gst12", gst12())
                        rpt.SetParameterValue("gst18", gst18())
                        rpt.SetParameterValue("gst28", gst28())
                        rpt.SetParameterValue("igst5", igst5())
                        rpt.SetParameterValue("igst12", igst12())
                        rpt.SetParameterValue("igst18", igst18())
                        rpt.SetParameterValue("igst28", igst28())
                        rpt.SetParameterValue("tot_GST", total_gst())
                        rpt.SetParameterValue("tot_IGST", total_igst())
                        rpt.SetParameterValue("tot_CESS", total_cess())
                        rpt.SetParameterValue("taxable_5", taxable_5())
                        rpt.SetParameterValue("taxable_12", taxable_12())
                        rpt.SetParameterValue("taxable_18", taxable_18())
                        rpt.SetParameterValue("taxable_28", taxable_28())
                        rpt.SetParameterValue("tax", tax)
                        If Home.lbl_logo.Text = "No" Then
                            rpt.SetParameterValue("logo_sup", 1)
                        Else
                            rpt.SetParameterValue("logo_sup", 0)
                        End If
                        Dim myForm4 As New frmPrint
                        myForm4.CrystalReportViewer1.ReportSource = rpt
                        myForm4.ShowDialog()
                    Catch ex As Exception
                        MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error)
                    End Try
                Next
            End If
        End If
        Cursor = Cursors.Default
        Timer1.Enabled = False
    End Sub
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles btn_save_print.Click
        'MsgBox(RupeesToWord(Val(TextBox20.Text)))
        Button4_Click(e, e)
        '.................................................................
        print(e, e)
    End Sub
    Function gst5() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst5val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)
            If gst51 = 5 Then
                gst5val = gst5val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGSTVal").Value) + gst5val2 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGSTVal").Value)
            End If
        Next ii
        Return gst5val
    End Function
    Function gst12() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst12val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)
            If gst51 = 12 Then
                gst12val = gst12val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGSTVal").Value) + gst5val2 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGSTVal").Value)
            End If
        Next ii
        Return gst12val
    End Function
    Function gst18() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst18val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)
            If gst51 = 18 Then
                gst18val = gst18val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGSTVal").Value) + gst5val2 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGSTVal").Value)
            End If
        Next ii
        Return gst18val
    End Function
    Function gst28() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst28val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)
            If gst51 = 28 Then
                gst28val = gst28val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGSTVal").Value) + gst5val2 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGSTVal").Value)
            End If
        Next ii
        Return gst28val
    End Function
    Function igst5() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst5val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            Try
                gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGST").Value)
                If gst51 = 5 Then
                    gst5val = gst5val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGSTVal").Value)
                End If
            Catch ex As Exception
                gst51 = 0
            End Try

        Next ii
        Return gst5val
    End Function
    Function igst12() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst12val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            Try
                gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGST").Value)
                If gst51 = 12 Then
                    gst12val = gst12val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGSTVal").Value)
                End If
            Catch ex As Exception
                gst51 = 0
            End Try

        Next ii
        Return gst12val
    End Function
    Function igst18() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst18val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            Try
                gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGST").Value)
                If gst51 = 18 Then
                    gst18val = gst18val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGSTVal").Value)
                End If
            Catch ex As Exception
                gst51 = 0
            End Try

        Next ii
        Return gst18val
    End Function
    Function igst28() As Double
        Dim gst51 As Double = 0
        Dim gst52 As Double = 0
        Dim ii As Integer = 0
        Dim gst28val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst51 = Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGST").Value)
            If gst51 = 28 Then
                gst28val = gst28val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGSTVal").Value)
            End If
        Next ii
        Return gst28val
    End Function
    Function total_gst() As Double
        Dim ii As Integer = 0
        Dim gst5val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst5val = gst5val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGSTVal").Value) + gst5val2 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGSTVal").Value)
        Next ii
        Return gst5val
    End Function
    '.................
    Function taxable_5() As Double
        Dim ii As Integer = 0
        Dim tax_5 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            If (Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)) = 5 Then
                tax_5 = tax_5 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("Amount").Value) - Convert.ToDouble(DataGridView1.Rows(ii).Cells("DiscValue").Value)
            End If
        Next ii
        Return tax_5
    End Function
    Function taxable_12() As Double
        Dim ii As Integer = 0
        Dim tax_12 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            If (Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)) = 12 Then
                tax_12 = tax_12 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("Amount").Value) - Convert.ToDouble(DataGridView1.Rows(ii).Cells("DiscValue").Value)
            End If
        Next ii
        Return tax_12
    End Function
    Function taxable_18() As Double
        Dim ii As Integer = 0
        Dim tax_18 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            If (Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)) = 18 Then
                tax_18 = tax_18 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("Amount").Value) - Convert.ToDouble(DataGridView1.Rows(ii).Cells("DiscValue").Value)
            End If
        Next ii
        Return tax_18
    End Function
    Function taxable_28() As Double
        Dim ii As Integer = 0
        Dim tax_28 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            If (Convert.ToDouble(DataGridView1.Rows(ii).Cells("SGST").Value) + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CGST").Value)) = 28 Then
                tax_28 = tax_28 + Convert.ToDouble(DataGridView1.Rows(ii).Cells("Amount").Value) - Convert.ToDouble(DataGridView1.Rows(ii).Cells("DiscValue").Value)
            End If
        Next ii
        Return tax_28
    End Function
    ' .................
    Function total_igst() As Double
        Dim ii As Integer = 0
        Dim gst5val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst5val = gst5val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("IGSTVal").Value)
        Next ii
        Return gst5val
    End Function
    Function total_cess() As Double
        Dim ii As Integer = 0
        Dim gst5val As Double = 0
        Dim gst5val2 As Double = 0
        For ii = 0 To DataGridView1.Rows.Count - 1
            gst5val = gst5val + Convert.ToDouble(DataGridView1.Rows(ii).Cells("CESSVal").Value)
        Next ii
        Return gst5val
    End Function
    Private Sub btn_print_Click(sender As Object, e As EventArgs) Handles btn_print.Click
        'MsgBox(taxable_5())
        'MsgBox(taxable_12())
        'MsgBox(taxable_18())
        'MsgBox(taxable_28())
        print(e, e)
    End Sub
    Private Sub New_Invoice_FormClosed(sender As Object, e As FormClosedEventArgs) Handles MyBase.FormClosed
        Home.Home_Load(e, e)

        For Each frmForm As Form In My.Application.OpenForms
            If frmForm.WindowState <> FormWindowState.Minimized Then
                If frmForm.Name <> "Home" Then
                    Home.Panel1.Visible = False
                Else
                    Home.Panel1.Visible = True
                End If
            End If
        Next
    End Sub
    Protected Overrides Sub OnResize(ByVal e As System.EventArgs)
        MyBase.OnResize(e)
        Select Case Me.WindowState
            Case FormWindowState.Normal
                Home.Panel1.Visible = False
            Case FormWindowState.Minimized
                For Each frmForm As Form In My.Application.OpenForms
                    If frmForm.WindowState <> FormWindowState.Minimized Then
                        If frmForm.Name <> "Home" Then
                            Home.Panel1.Visible = False
                        Else
                            Home.Panel1.Visible = True
                        End If
                    End If
                Next
            Case FormWindowState.Maximized
                Home.Panel1.Visible = False
        End Select
    End Sub

    Private Sub info_Draw(Sender As Object, e As System.Windows.Forms.DrawToolTipEventArgs) Handles info.Draw
        e.DrawBackground()
        e.DrawBorder()
        e.DrawText()
    End Sub
    Private Sub DataGridView1_KeyPress(sender As Object, e As KeyPressEventArgs) Handles DataGridView1.KeyPress
        Dim i As Integer
        Dim c As Integer
        i = DataGridView1.CurrentRow.Index
        c = DataGridView1.CurrentCell.ColumnIndex
        If Not IsDBNull(DataGridView1.Item("ProductName", i).Value) Then
            Dim yn As Integer
            cmd = New SQLiteCommand("select * from outer_quatation where Bill_No ='" & Box5.Text & "' ", cn)
            cn.Close()
            cn.Open()
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                dr3.Close()
                yn = MsgBox("Data Found of Quatation,Do you want Load it?", MsgBoxStyle.YesNo)
                If yn = 6 Then
                    'MsgBox("load")
                    cn.Close()
                    cn.Open()
                    dt.Clear()
                    da = New SQLiteDataAdapter("select * from inner_quatation where Bill_No ='" & Box5.Text & "' ", cn)
                    da.Fill(dt)
                    DataGridView1.DataSource = dt
                    da.Dispose()
                    cn.Close()
                    '.......................................................................................................
                    cmd = New SQLiteCommand("select * from outer_quatation where Bill_No ='" & Box5.Text & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim adapter As New SQLiteDataAdapter(cmd)
                    Dim table As New DataTable()
                    adapter.Fill(table)
                    client_name.Text = table.Rows(0)(1).ToString()
                    Dim abs As String
                    Dim ns As String
                    Dim my As String
                    Dim y As String
                    Dim mn As String
                    Dim day As Integer
                    abs = "-"
                    ns = Replace(table.Rows(0)(2).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    bill_date.Value = New Date(y, mn, day)
                    due_days.Text = table.Rows(0)(3).ToString()
                    abs = "-"
                    ns = Replace(table.Rows(0)(4).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    due_date.Value = New Date(y, mn, day)
                    Box1.Text = table.Rows(0)(5).ToString()
                    ns = Replace(table.Rows(0)(6).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    Box2.Value = New Date(y, mn, day)
                    Box3.Text = table.Rows(0)(7).ToString()
                    ns = Replace(table.Rows(0)(8).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    Box4.Value = New Date(y, mn, day)
                    'Box5.Text = table.Rows(0)(9).ToString()
                    ns = Replace(table.Rows(0)(10).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    Box6.Value = New Date(y, mn, day)
                    Box7.Text = table.Rows(0)(11).ToString()
                    ns = Replace(table.Rows(0)(12).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    Box8.Value = New Date(y, mn, day)
                    Box11.Text = table.Rows(0)(13).ToString()
                    Box12.Text = table.Rows(0)(14).ToString()
                    Box9.Text = table.Rows(0)(15).ToString()
                    Box10.Text = table.Rows(0)(16).ToString()
                    Box13.Text = table.Rows(0)(17).ToString()
                    Box14.Text = table.Rows(0)(18).ToString()
                    txt_qty.Text = table.Rows(0)(19).ToString()
                    txt_free_qty.Text = table.Rows(0)(20).ToString()
                    txt_gross.Text = table.Rows(0)(21).ToString()
                    TextBox14.Text = table.Rows(0)(22).ToString()
                    TextBox18.Text = table.Rows(0)(23).ToString()
                    TextBox17.Text = table.Rows(0)(24).ToString()
                    TextBox15.Text = table.Rows(0)(26).ToString()
                    TextBox16.Text = table.Rows(0)(27).ToString()
                    TextBox19.Text = table.Rows(0)(28).ToString()
                    TextBox20.Text = table.Rows(0)(29).ToString()
                    txt_remark.Text = table.Rows(0)(31).ToString()
                End If
            Else
                dr3.Close()
            End If
        End If
    End Sub
    Private Sub Box3_Leave(sender As Object, e As EventArgs) Handles Box3.Leave
        If Box3.Text = "" Then
        Else
            Dim dr3 As SQLiteDataReader
            Dim yn As Integer
            cmd = New SQLiteCommand("select * from outer_delivery_note where Bill_No ='" & Box3.Text & "' ", cn)
            cn.Close()
            cn.Open()
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                dr3.Close()
                yn = MsgBox("Data Found of Delivery Note,Do you want Load it?", MsgBoxStyle.YesNo)
                If yn = 6 Then
                    deli_status = True
                    Box3.Enabled = False
                    cn.Close()
                    cn.Open()
                    dt.Clear()
                    da = New SQLiteDataAdapter("select * from inner_delivery_note where Bill_No ='" & Box3.Text & "' ", cn)
                    da.Fill(dt)
                    DataGridView1.DataSource = dt
                    da.Dispose()
                    cn.Close()
                    '.......................................................................................................
                    cmd = New SQLiteCommand("select * from outer_delivery_note where Bill_No ='" & Box3.Text & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim adapter As New SQLiteDataAdapter(cmd)
                    Dim table As New DataTable()
                    adapter.Fill(table)
                    client_name.Text = table.Rows(0)(1).ToString()
                    Dim abs As String
                    Dim ns As String
                    Dim my As String
                    Dim y As String
                    Dim mn As String
                    Dim day As Integer
                    abs = "/"
                    'ns = Replace(table.Rows(0)(2).ToString(), abs, "")
                    'my = ns.Remove(0, 2)
                    'y = my.Remove(0, 2)
                    'mn = my.Substring(0, 2)
                    'day = ns.Substring(0, 2)
                    'bill_date.Value = New Date(y, mn, day)
                    'due_days.Text = table.Rows(0)(3).ToString()
                    'abs = "-"

                    ns = Replace(table.Rows(0)(4).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        due_date.Value = New Date(y, mn, day)

                        Box1.Text = table.Rows(0)(5).ToString()
                    If Box2.Visible Then
                        ns = Replace(table.Rows(0)(6).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box2.Value = New Date(y, mn, day)
                    End If
                    If Box4.Visible Then
                        ns = Replace(table.Rows(0)(8).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box4.Value = New Date(y, mn, day)
                    End If
                    Box5.Text = table.Rows(0)(9).ToString()

                    If Box6.Visible Then
                        ns = Replace(table.Rows(0)(10).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box6.Value = New Date(y, mn, day)
                    End If

                    Box7.Text = table.Rows(0)(11).ToString()

                    If Box8.Visible Then
                        ns = Replace(table.Rows(0)(12).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box8.Value = New Date(y, mn, day)
                    End If
                    Box11.Text = table.Rows(0)(13).ToString()
                        Box12.Text = table.Rows(0)(14).ToString()
                        Box9.Text = table.Rows(0)(15).ToString()
                        Box10.Text = table.Rows(0)(16).ToString()
                        Box13.Text = table.Rows(0)(17).ToString()
                        Box14.Text = table.Rows(0)(18).ToString()
                        txt_qty.Text = table.Rows(0)(19).ToString()
                        txt_free_qty.Text = table.Rows(0)(20).ToString()
                        txt_gross.Text = table.Rows(0)(21).ToString()
                        TextBox14.Text = table.Rows(0)(22).ToString()
                        TextBox18.Text = table.Rows(0)(23).ToString()
                        TextBox17.Text = table.Rows(0)(24).ToString()
                        TextBox15.Text = table.Rows(0)(26).ToString()
                        TextBox16.Text = table.Rows(0)(27).ToString()
                        TextBox19.Text = table.Rows(0)(28).ToString()
                        TextBox20.Text = table.Rows(0)(29).ToString()
                        txt_remark.Text = table.Rows(0)(31).ToString()
                    Else
                        deli_status = False
                    Box3.Enabled = True
                End If
            Else
                dr3.Close()
                deli_status = False
                Box3.Enabled = True
                MsgBox("No Data found of Delivery Note.", MsgBoxStyle.Information)
            End If
        End If
    End Sub
    Private Sub bill_date_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txt_remark.KeyPress, TextBox18.KeyPress, TextBox17.KeyPress, due_days.KeyPress, due_date.KeyPress, DataGridView1.KeyPress, Box8.KeyPress, Box7.KeyPress, Box6.KeyPress, Box5.KeyPress, Box4.KeyPress, Box3.KeyPress, Box2.KeyPress, Box14.KeyPress, Box13.KeyPress, Box12.KeyPress, Box11.KeyPress, Box1.KeyPress, bill_date.KeyPress
        If TextBox2.Enabled Then
            TextBox2_Leave(e, e)
        End If
    End Sub
    Private Sub btn_add_less_Click(sender As Object, e As EventArgs) Handles btn_add_less.Click
        'MsgBox(btn_add_less.Text)
        'txt_remark.Text = btn_add_less.Text
        If add_less Then
            btn_add_less.Text = "Less"
            add_less = False
        Else
            btn_add_less.Text = "Add"
            add_less = True
        End If
        outer_controls()
    End Sub

    Private Sub Box5_Leave(sender As Object, e As EventArgs) Handles Box5.Leave
        If Box5.Text = "" Then
        Else
            Dim dr3 As SQLiteDataReader
            Dim yn As Integer
            cmd = New SQLiteCommand("select * from outer_quatation where Bill_No ='" & Box5.Text & "' ", cn)
            cn.Close()
            cn.Open()
            dr3 = cmd.ExecuteReader()
            If dr3.HasRows = True Then
                dr3.Close()
                yn = MsgBox("Data Found of Quatation, Do you want Load it?", MsgBoxStyle.YesNo)
                If yn = 6 Then
                    deli_status = True
                    Box3.Enabled = False
                    cn.Close()
                    cn.Open()
                    dt.Clear()
                    da = New SQLiteDataAdapter("select * from inner_quatation where Bill_No ='" & Box5.Text & "' ", cn)
                    da.Fill(dt)
                    DataGridView1.DataSource = dt
                    da.Dispose()
                    cn.Close()
                    '.......................................................................................................
                    cmd = New SQLiteCommand("select * from outer_quatation where Bill_No ='" & Box5.Text & "' ", cn)
                    If cn.State = ConnectionState.Closed Then
                        cn.Open()
                    End If
                    Dim adapter As New SQLiteDataAdapter(cmd)
                    Dim table As New DataTable()
                    adapter.Fill(table)
                    client_name.Text = table.Rows(0)(1).ToString()
                    Dim abs As String
                    Dim ns As String
                    Dim my As String
                    Dim y As String
                    Dim mn As String
                    Dim day As Integer
                    abs = "-"
                    'ns = Replace(table.Rows(0)(2).ToString(), abs, "")
                    'my = ns.Remove(0, 2)
                    'y = my.Remove(0, 2)
                    'mn = my.Substring(0, 2)
                    'day = ns.Substring(0, 2)
                    'bill_date.Value = New Date(y, mn, day)
                    'due_days.Text = table.Rows(0)(3).ToString()
                    'abs = "-"
                    ns = Replace(table.Rows(0)(4).ToString(), abs, "")
                    my = ns.Remove(0, 2)
                    y = my.Remove(0, 2)
                    mn = my.Substring(0, 2)
                    day = ns.Substring(0, 2)
                    due_date.Value = New Date(y, mn, day)
                    Box1.Text = table.Rows(0)(5).ToString()

                    If Box2.Visible Then
                        ns = Replace(table.Rows(0)(6).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box2.Value = New Date(y, mn, day)
                    End If

                    If Box4.Visible Then
                        ns = Replace(table.Rows(0)(8).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box4.Value = New Date(y, mn, day)
                    End If
                    'Box5.Text = table.Rows(0)(9).ToString()
                    If Box6.Visible Then
                        ns = Replace(table.Rows(0)(10).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box6.Value = New Date(y, mn, day)
                    End If
                    Box7.Text = table.Rows(0)(11).ToString()
                    If Box8.Visible Then
                        ns = Replace(table.Rows(0)(12).ToString(), abs, "")
                        my = ns.Remove(0, 2)
                        y = my.Remove(0, 2)
                        mn = my.Substring(0, 2)
                        day = ns.Substring(0, 2)
                        Box8.Value = New Date(y, mn, day)
                    End If
                    Box11.Text = table.Rows(0)(13).ToString()
                        Box12.Text = table.Rows(0)(14).ToString()
                        Box9.Text = table.Rows(0)(15).ToString()
                        Box10.Text = table.Rows(0)(16).ToString()
                        Box13.Text = table.Rows(0)(17).ToString()
                        Box14.Text = table.Rows(0)(18).ToString()
                        txt_qty.Text = table.Rows(0)(19).ToString()
                        txt_free_qty.Text = table.Rows(0)(20).ToString()
                        txt_gross.Text = table.Rows(0)(21).ToString()
                        TextBox14.Text = table.Rows(0)(22).ToString()
                        TextBox18.Text = table.Rows(0)(23).ToString()
                        TextBox17.Text = table.Rows(0)(24).ToString()
                        TextBox15.Text = table.Rows(0)(26).ToString()
                        TextBox16.Text = table.Rows(0)(27).ToString()
                        TextBox19.Text = table.Rows(0)(28).ToString()
                        TextBox20.Text = table.Rows(0)(29).ToString()
                        txt_remark.Text = table.Rows(0)(31).ToString()
                        'Else
                        '    Box5.Enabled = True
                    End If
                Else
                dr3.Close()

                MsgBox("No Data found of Quatation.", MsgBoxStyle.Information)
            End If
        End If
    End Sub

    Private Sub Box1_Leave(sender As Object, e As EventArgs) Handles Box1.Leave
        'If Box1.Text = "" Then
        'Else
        '    Dim dr3 As SQLiteDataReader
        '    Dim yn As Integer
        '    cmd = New SQLiteCommand("select * from outer_receipt_note where Bill_No ='" & Box1.Text & "' ", cn)
        '    cn.Close()
        '    cn.Open()
        '    dr3 = cmd.ExecuteReader()
        '    If dr3.HasRows = True Then
        '        dr3.Close()
        '        yn = MsgBox("Data Found of receipt note , Do you want Load it?", MsgBoxStyle.YesNo)
        '        If yn = 6 Then
        '            deli_status = True
        '            Box3.Enabled = False
        '            cn.Close()
        '            cn.Open()
        '            dt.Clear()
        '            da = New SQLiteDataAdapter("select * from inner_receipt_note where Bill_No ='" & Box1.Text & "' ", cn)
        '            da.Fill(dt)
        '            DataGridView1.DataSource = dt
        '            da.Dispose()
        '            cn.Close()
        '            '.......................................................................................................
        '            cmd = New SQLiteCommand("select * from outer_receipt_note where Bill_No ='" & Box1.Text & "' ", cn)
        '            If cn.State = ConnectionState.Closed Then
        '                cn.Open()
        '            End If
        '            Dim adapter As New SQLiteDataAdapter(cmd)
        '            Dim table As New DataTable()
        '            adapter.Fill(table)
        '            client_name.Text = table.Rows(0)(1).ToString()
        '            Dim abs As String
        '            Dim ns As String
        '            Dim my As String
        '            Dim y As String
        '            Dim mn As String
        '            Dim day As Integer
        '            abs = "-"
        '            'ns = Replace(table.Rows(0)(2).ToString(), abs, "")
        '            'my = ns.Remove(0, 2)
        '            'y = my.Remove(0, 2)
        '            'mn = my.Substring(0, 2)
        '            'day = ns.Substring(0, 2)
        '            'bill_date.Value = New Date(y, mn, day)
        '            'due_days.Text = table.Rows(0)(3).ToString()
        '            'abs = "-"
        '            ns = Replace(table.Rows(0)(4).ToString(), abs, "")
        '            my = ns.Remove(0, 2)
        '            y = my.Remove(0, 2)
        '            mn = my.Substring(0, 2)
        '            day = ns.Substring(0, 2)
        '            due_date.Value = New Date(y, mn, day)
        '            Box1.Text = table.Rows(0)(5).ToString()
        '            ns = Replace(table.Rows(0)(6).ToString(), abs, "")
        '            my = ns.Remove(0, 2)
        '            y = my.Remove(0, 2)
        '            mn = my.Substring(0, 2)
        '            day = ns.Substring(0, 2)
        '            Box2.Value = New Date(y, mn, day)
        '            ns = Replace(table.Rows(0)(8).ToString(), abs, "")
        '            my = ns.Remove(0, 2)
        '            y = my.Remove(0, 2)
        '            mn = my.Substring(0, 2)
        '            day = ns.Substring(0, 2)
        '            Box4.Value = New Date(y, mn, day)
        '            'Box5.Text = table.Rows(0)(9).ToString()
        '            ns = Replace(table.Rows(0)(10).ToString(), abs, "")
        '            my = ns.Remove(0, 2)
        '            y = my.Remove(0, 2)
        '            mn = my.Substring(0, 2)
        '            day = ns.Substring(0, 2)
        '            Box6.Value = New Date(y, mn, day)
        '            Box7.Text = table.Rows(0)(11).ToString()
        '            ns = Replace(table.Rows(0)(12).ToString(), abs, "")
        '            my = ns.Remove(0, 2)
        '            y = my.Remove(0, 2)
        '            mn = my.Substring(0, 2)
        '            day = ns.Substring(0, 2)
        '            Box8.Value = New Date(y, mn, day)
        '            Box11.Text = table.Rows(0)(13).ToString()
        '            Box12.Text = table.Rows(0)(14).ToString()
        '            Box9.Text = table.Rows(0)(15).ToString()
        '            Box10.Text = table.Rows(0)(16).ToString()
        '            Box13.Text = table.Rows(0)(17).ToString()
        '            Box14.Text = table.Rows(0)(18).ToString()
        '            txt_qty.Text = table.Rows(0)(19).ToString()
        '            txt_free_qty.Text = table.Rows(0)(20).ToString()
        '            txt_gross.Text = table.Rows(0)(21).ToString()
        '            TextBox14.Text = table.Rows(0)(22).ToString()
        '            TextBox18.Text = table.Rows(0)(23).ToString()
        '            TextBox17.Text = table.Rows(0)(24).ToString()
        '            TextBox15.Text = table.Rows(0)(26).ToString()
        '            TextBox16.Text = table.Rows(0)(27).ToString()
        '            TextBox19.Text = table.Rows(0)(28).ToString()
        '            TextBox20.Text = table.Rows(0)(29).ToString()
        '            txt_remark.Text = table.Rows(0)(31).ToString()
        '            'Else
        '            '    Box5.Enabled = True
        '        End If
        '    Else
        '        dr3.Close()
        '        MsgBox("No Data found of receipt note.", MsgBoxStyle.Information)
        '    End If
        'End If
    End Sub

    Private Sub DataGridView1_RowsRemoved(sender As Object, e As DataGridViewRowsRemovedEventArgs) Handles DataGridView1.RowsRemoved
        If DataGridView1.Rows.Count >= 1 Then
            assign()
        End If
    End Sub

    Private Sub PopulateSalesman()
        Dim cmd As New SQLiteCommand("SELECT Name FROM client WHERE Type = 'Salesman'", cn)

        If cn.State = ConnectionState.Closed Then
            cn.Open()
        End If

        Dim adapter As New SQLiteDataAdapter(cmd)
        Dim table As New DataTable()
        adapter.Fill(table)

        salesman.DataSource = table
        salesman.DisplayMember = "Name"
    End Sub

    Private Sub txt_com_TextChanged(sender As Object, e As EventArgs) Handles txt_com.TextChanged
        outer_controls()
    End Sub

    Private Sub txt_com_Leave(sender As Object, e As EventArgs) Handles txt_com.Leave
        outer_controls()
    End Sub

    Private Sub comp_TextChanged(sender As Object, e As EventArgs) Handles comp.TextChanged
        Dim result As Double = Val(TextBox16.Text) * Val(comp.Text) / 100
        txt_com.Text = result.ToString("0.00")
    End Sub

    Private Sub comp_KeyPress(sender As Object, e As KeyPressEventArgs) Handles comp.KeyPress
        If IsNumeric(e.KeyChar.ToString()) _
       Or e.KeyChar = ChrW(Keys.Back) _
       Or e.KeyChar = "." Then
            'MessageBox.Show("KeyPress number")
            e.Handled = False 'if numeric display
        Else
            'MessageBox.Show("enter numbers only")
            e.Handled = True  'if non numeric don't display
        End If
    End Sub

    Private Sub profitamt_TextChanged(sender As Object, e As EventArgs) Handles profitamt.TextChanged
        outer_controls()
    End Sub

    Private Sub profitp_TextChanged(sender As Object, e As EventArgs) Handles profitp.TextChanged
        'profitamt.Text = Val(TextBox16.Text) * Val(profitp.Text) / 100

        Dim result As Double = Val(TextBox16.Text) * Val(profitp.Text) / 100
        profitamt.Text = result.ToString("0.00")
    End Sub

    Private Sub DataGridView1_CellContentClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.CellContentClick

    End Sub
End Class
